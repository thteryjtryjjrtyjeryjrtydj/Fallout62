<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KRYPTA 62 - TERMINAL ZARZĄDCY v11.0 [WERSJA OSTATECZNA]</title>
    <!-- CSS JEST JUŻ W KODZIE I NIE WYMAGA EDYCJI -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet"> 
</head>
<style>
    :root {
        --main-color: #00FF41;
        --bg-color: #000;
        --shadow-color: rgba(0, 255, 65, 0.2);
        --red-color: #FF4141;
    }
    html, body {
        height: 100%; margin: 0; padding: 0;
        background-color: var(--bg-color);
        color: var(--main-color);
        font-family: 'VT323', monospace;
        font-size: 22px;
        overflow: hidden;
        display: flex; align-items: center; justify-content: center;
    }
    .screen {
        padding: 20px; box-sizing: border-box;
        border: 3px solid var(--main-color);
        box-shadow: 0 0 30px var(--shadow-color), inset 0 0 15px rgba(0, 255, 65, 0.1);
        display: none;
        flex-direction: column;
        aspect-ratio: 16 / 10;
        border-radius: 20px;
        overflow: hidden;
        height: 98vh;
        max-height: 900px; max-width: 95vw;
    }
    .screen.active { display: flex; }
    #boot-screen, #ending-screen { align-items: center; justify-content: center; font-size: 24px; text-align: center;}
    pre { white-space: pre-wrap; word-wrap: break-word; margin: 0; }
    .crt-glow, #scanline-overlay {
        position: fixed; top: 0; left: 0;
        width: 100%; height: 100%;
        pointer-events: none; z-index: 150;
    }
    .crt-glow { box-shadow: inset 0 0 100px 50px var(--bg-color); }
    #scanline-overlay { background: repeating-linear-gradient(0deg, #0000 0, #0000 2px, #0003 3px, #0003 4px); z-index: 151; animation: flicker 0.15s infinite; }
    @keyframes flicker { 0%, 100% { opacity: 0.95; } 50% { opacity: 1; } }
    #game-screen { text-shadow: 0 0 5px var(--main-color), 0 0 10px var(--main-color), 0 0 15px var(--shadow-color); animation: text-flicker 3s linear infinite; }
    @keyframes text-flicker { 0%, 8%, 12%, 70%, 72%, 98%, 100% { opacity: .98 } 9%, 99% { opacity: .8 } }
    input, select, button {
        background-color: var(--bg-color); color: var(--main-color);
        border: 1px solid var(--main-color);
        font-family: inherit; font-size: inherit;
        padding: 5px 10px; margin: 5px;
        box-shadow: 0 0 5px var(--main-color);
    }
    button:hover:not(:disabled) { background-color: var(--main-color); color: var(--bg-color); cursor: pointer; }
    button:disabled { color: #555; border-color: #555; box-shadow: none; cursor: not-allowed; opacity: 0.6; }
    button:disabled span { text-decoration: none !important; }
    button.disabled-skill-check { text-decoration: line-through; opacity: 0.5; }
    input { width: 80%; text-align: center; }
    header { flex-shrink: 0; }
    #status-bar { display: flex; justify-content: space-around; border-bottom: 1px solid var(--main-color); padding: 5px 0; flex-wrap: wrap; font-size: 16px; }
    .resource-status { font-size: 14px; opacity: 0.8; }
    nav { border-bottom: 1px solid var(--main-color); padding: 5px 0; text-align: center; }
    nav .nav-btn { font-size: 18px; }
    nav .nav-btn.active { background-color: var(--main-color); color: var(--bg-color); }
    #main-display { flex-grow: 1; overflow-y: auto; padding: 10px; border-bottom: 1px solid var(--main-color); }
    #main-display::-webkit-scrollbar { width: 8px; }
    #main-display::-webkit-scrollbar-track { background: var(--bg-color); }
    #main-display::-webkit-scrollbar-thumb { background-color: var(--main-color); border: 1px solid var(--bg-color); }
    .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 10px; }
    .dweller-entry, .warehouse-item { border: 1px solid var(--main-color); padding: 10px; }
    .log-wrapper { grid-column: 1 / -1; margin-top: 15px; } /* Poprawka dla dziennika */
    footer { flex-shrink: 0; padding: 10px 0; text-align: center; }
    #modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); z-index: 100; display: flex; align-items: center; justify-content: center; }
    #modal-overlay.hidden { display: none; }
#modal-content {
    background-color: var(--bg-color);
    border: 3px solid var(--main-color);
    border-radius: 15px;
    box-shadow: 0 0 40px var(--shadow-color);
    padding: 25px;
    width: 90%;
    max-width: 1100px; /* ZWIĘKSZONA SZEROKOŚĆ */
    text-align: center;
    position: relative;
}
    #modal-image { max-width: 150px; max-height: 150px; margin-bottom: 15px; border: 2px solid var(--main-color); border-radius: 5px; }
    #modal-content h3 { margin-top: 0; }
    #modal-buttons { margin-top: 20px; display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }
    .event-desc { font-size: 20px; padding: 10px; border: 1px dotted var(--shadow-color); margin: 15px 0; }
    .log-container { height: 300px; overflow-y: auto; text-align: left; padding: 5px; border: 1px solid var(--shadow-color); }
    .log-entry { margin: 2px 0; font-size: 16px; }
    .log-entry.bad { color: var(--red-color); }
    .log-entry.good { color: #8effa8; }
    .log-entry.info { opacity: 0.7; }
    #map-container {
        width: 100%;
        height: 550px;
        display: flex; /* Używamy flexboxa do wyśrodkowania */
        justify-content: center;
        align-items: center;
    }
    #map-aspect-ratio-holder {
        position: relative; /* Kluczowe dla pozycjonowania kropek */
        width: 100%;
        height: 100%;
        max-width: 100%; /* Zapobiega rozciąganiu */
        max-height: 100%;
        aspect-ratio: 1536 / 1024; /* ZMUSZA KONTENER DO ZACHOWANIA PROPORCJI OBRAZKA */
    }
    .map-image {
        position: absolute; /* Rozciąga obrazek na cały wrapper */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: contain; /* Gwarantuje, że obrazek się mieści */
    }
    .map-point {
        position: absolute; /* Pozycjonowanie względem #map-aspect-ratio-holder */
        width: 12px;
        height: 12px;
        background-color: var(--main-color);
        border: 2px solid var(--bg-color);
        border-radius: 50%;
        cursor: pointer;
        transform: translate(-50%, -50%);
        box-shadow: 0 0 8px var(--main-color);
        animation: pulse-map-point 2s infinite;
    }
    .map-point:hover {
        transform: translate(-50%, -50%) scale(1.5);
        animation-play-state: paused;
    }
    @keyframes pulse-map-point { 0%, 100% { box-shadow: 0 0 8px var(--main-color); } 50% { box-shadow: 0 0 18px var(--main-color); } }
    .character-select-container { position: relative; display: flex; justify-content: center; align-items: center; min-height: 400px; }
    .char-select-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.15; z-index: -1; border-radius: 10px; }
    .char-options { display: flex; flex-direction: column; gap: 15px; width: 80%; }
    .char-select-btn { text-align: left; padding: 15px; }
    .char-select-btn h4 { margin: 0 0 5px 0; }
    .char-select-btn p { margin: 0; font-size: 16px; opacity: 0.8; }
    @keyframes glitch { 0% { text-shadow: .05em 0 0 #ff0000, -.025em -.05em 0 #00ff00, .025em .05em 0 #0000ff; } 15% { text-shadow: .05em 0 0 #ff0000, -.025em -.05em 0 #00ff00, .025em .05em 0 #0000ff; } 16% { text-shadow: -.05em -.025em 0 #ff0000, .025em .025em 0 #00ff00, -.05em -.05em 0 #0000ff; } 49% { text-shadow: -.05em -.025em 0 #ff0000, .025em .025em 0 #00ff00, -.05em -.05em 0 #0000ff; } 50% { text-shadow: .025em .05em 0 #ff0000, .05em 0 0 #00ff00, 0 -.05em 0 #0000ff; } 99% { text-shadow: .025em .05em 0 #ff0000, .05em 0 0 #00ff00, 0 -.05em 0 #0000ff; } 100% { text-shadow: -.025em 0 0 #ff0000, -.025em -.025em 0 #00ff00, -.025em -.05em 0 #0000ff; }}
    .glitch-text { animation: glitch 500ms infinite; }
    .blinking-cursor { animation: blink 1s step-end infinite; }
    @keyframes blink { from, to { color: transparent; } 50% { color: var(--main-color); } }
    .trade-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: left;}
    .trade-section h4 { text-align: center; border-bottom: 1px solid var(--main-color); padding-bottom: 5px; }
    .trade-item { margin-bottom: 10px; }

    /* === NOWE STYLE DLA PASKÓW MASZYN === */
    .machine-status {
        display: flex;
        align-items: center;
        gap: 15px;
        border: 1px solid var(--main-color); 
        padding: 10px;
    }
    .machine-details {
        flex-grow: 1;
    }
    .vertical-progress-bar {
        width: 30px;
        height: 120px;
        border: 2px solid var(--main-color);
        background-color: #111;
        padding: 2px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column-reverse; /* To sprawia, że pasek "rośnie" od dołu */
        position: relative; /* Potrzebne do pozycjonowania podziałek */
    }
    .vertical-progress-bar-fill {
        width: 100%;
        background-color: var(--main-color);
        transition: height 0.5s ease-out;
    }
    .progress-threshold {
        position: absolute;
        width: 100%;
        height: 1px;
        background-color: var(--main-color);
        opacity: 0.3;
        left: 0;
    }
    .threshold-75 { bottom: 75%; }
    .threshold-50 { bottom: 50%; }
    .threshold-25 { bottom: 25%; }

    /* Styl dla przewijanego okna w modalu */
    .scrollable-modal-body {
        max-height: 60vh; /* Maksymalna wysokość to 60% wysokości ekranu */
        overflow-y: auto; /* Dodaj pionowy suwak, gdy tekst się nie mieści */
        padding: 10px;
        margin-right: -10px; /* Mały trik, by suwak nie nachodził na tekst */
        padding-right: 20px; /* Daje miejsce na suwak */
        text-align: left;
        border: 1px dotted var(--shadow-color);
    }
</style>
<body>

    <!-- Efekty wizualne i dźwiękowe -->
    <div class="crt-glow"></div>
    <div id="scanline-overlay"></div>
   <div id="audio-container" style="display: none;">
    <audio id="audio-type" src="type.mp3" preload="auto"></audio>
    <audio id="audio-click" src="click.mp3" preload="auto"></audio>
    <audio id="audio-startup" src="system_startup.mp3" preload="auto" loop></audio>
    <audio id="audio-victory" src="victory.mp3" preload="auto"></audio> <!-- NOWY DŹWIĘK -->
    <audio id="audio-failure" src="failure.mp3" preload="auto"></audio> <!-- NOWY DŹWIĘK -->
</div>

    <!-- Ekran Bootowania -->
    <div id="boot-screen" class="screen active">
        <pre id="boot-text"></pre><span id="boot-cursor" class="blinking-cursor">_</span>
    </div>

    <!-- Ekran Logowania -->
    <div id="login-screen" class="screen">
        <h3>SYSTEM OPERACYJNY VAULT-TEC (c) 2077</h3>
        <p>Wersja oprogramowania: 8.0</p>
        <p>Proszę wprowadzić dane uwierzytelniające.</p>
        <input type="text" id="username" placeholder="NAZWA UŻYTKOWNIKA" autocomplete="off">
        <input type="password" id="password" placeholder="HASŁO">
        <div style="margin-top: 15px;">
             <button id="login-btn">KONTYNUUJ KAMPANIĘ</button>
             <button id="new-game-btn">NOWA KAMPANIA</button>
        </div>
        <p id="login-error" style="color: var(--red-color); display: none; margin-top: 10px;"></p>
    </div>
    
    <!-- Ekran Epilogu (po przegranej/wygranej) -->
    <div id="epilogue-screen" class="screen">
        <h2 id="epilogue-title"></h2>
        <pre id="epilogue-text" style="text-align: left; white-space: pre-wrap; width: 90%; margin: 20px auto; font-size: 20px;"></pre>
        <button id="epilogue-new-game-btn" style="margin-top: 20px;">ROZPOCZNIJ OD NOWA</button>
    </div>

    <!-- Ekran Wprowadzenia -->
    <div id="intro-screen" class="screen">
        <h3>Dziennik Zastępcy, Wpis #1</h3>
        <pre id="intro-text" style="text-align: left; white-space: pre-wrap; width: 90%; margin: 20px auto;"></pre>
        <button id="continue-intro-btn" style="display: none; margin-top: 20px;">Dalej...</button>
    </div>

    <!-- Ekran Wyboru Postaci -->
    <div id="character-select-screen" class="screen">
        <h3>INICJALIZACJA PROFILU ZASTĘPCY</h3>
        <p>Twoje wcześniejsze doświadczenia ukształtowały Twój charakter. Zdefiniuj swoje kluczowe kompetencje, które wpłyną na dostępne opcje i rezultaty wielu zdarzeń.</p>
        <div class="character-select-container">
            <img src="vault_boy.jpg" alt="Vault Boy" class="char-select-bg">
            <div class="char-options">
                <button class="char-select-btn" data-class="Siłacz">
                    <h4>SIŁACZ</h4>
                    <p>Polegasz na sile i zastraszaniu. Daje dostęp do opcji dialogowych opartych na Sile.</p>
                    <p style="color: #8effa8; font-size: 16px;"><strong>Bonusy Pasywne:</strong><br>
                    - Twoja siła ataku podczas najazdów jest o 30% większa.<br>
                    - Szansa na przetrwanie Twoich zwiadowców na ekspedycji jest o 10% większa.</p>
                </button>
                <button class="char-select-btn" data-class="Naukowiec">
                    <h4>NAUKOWIEC</h4>
                    <p>Analityczny umysł pozwala Ci optymalizować działanie Krypty. Daje dostęp do opcji dialogowych opartych na Inteligencji.</p>
                     <p style="color: #8effa8; font-size: 16px;"><strong>Bonusy Pasywne:</strong><br>
                    - Koszt naprawy maszyn jest o 20% niższy (16 kapsli zamiast 20).</p>
                </button>
                <button class="char-select-btn" data-class="Dyplomata">
                    <h4>DYPLOMATA</h4>
                    <p>Charyzma to Twoja broń. Masz większe szanse na pokojowe rozwiązania. Daje dostęp do opcji dialogowych opartych na Charyzmie.</p>
                     <p style="color: #8effa8; font-size: 16px;"><strong>Bonusy Pasywne:</strong><br>
                    - Kupujesz towary o 15% taniej.<br>
                    - Sprzedajesz zasoby o 15% drożej.</p>
                </button>
            </div>
        </div>
    </div>

    <!-- Główny Ekran Gry -->
    <div id="game-screen" class="screen">
        <header>
            <div id="status-bar">
                <span>Dzień: <span id="day-counter">1</span>/60</span>
                <span>Populacja: <span id="population-counter">25</span></span>
                <span id="morale-label">Morale: <span id="morale-counter">70</span>%</span>
                <span id="food-label">Żywność: <span id="food-counter">100</span><br><span id="food-status" class="resource-status"></span></span>
                <span id="water-label">Woda: <span id="water-counter">100</span><br><span id="water-status" class="resource-status"></span></span>
                <span id="power-label">Energia (Akumulator): <span id="power-counter">100</span><br><span id="power-status" class="resource-status"></span></span>
                <span>Kapsle: <span id="caps-counter">50</span></span>
            </div>
        </header>

        <nav>
            <button class="nav-btn active" data-tab="status">STATUS KRYPTY</button>
            <button class="nav-btn" data-tab="mieszkancy">MIESZKAŃCY</button>
            <button class="nav-btn" data-tab="magazyn">MAGAZYN</button>
            <button id="expeditions-nav-btn" class="nav-btn" data-tab="ekspedycje">EKSPEDYCJE</button>
            <button id="communicator-nav-btn" class="nav-btn" data-tab="komunikator">KOMUNIKATOR</button>
        </nav>

        <main id="main-display">
            <!-- Zawartość renderowana dynamicznie przez JS -->
        </main>

        <footer>
            <div style="display: flex; align-items: center; justify-content: center;">
                <button id="next-day-btn">ROZPOCZNIJ NOWY DZIEŃ</button>
                <span id="main-cursor" class="blinking-cursor" style="margin-left: 10px;">_</span>
            </div>
        </footer>
    </div>

    <!-- Okno Modalne -->
    <div id="modal-overlay" class="hidden">
        <div id="modal-content">
            <h3 id="modal-title"></h3>
            <div id="modal-body"></div>
            <div id="modal-buttons"></div>
        </div>
    </div>
    
    <!-- Ekran Zakończenia -->
    <div id="ending-screen" class="screen">
         <h1 id="ending-text"></h1>
         <button id="restart-btn" style="margin-top: 50px;">ZAGRAJ PONOWNIE</button>
    </div>

<script>
// #############################################################################
// ###########   SILNIK I PODSTAWOWE FUNKCJE GRY   #############################
// #############################################################################

// --- SILNIK DŹWIĘKU ---
// --- SILNIK DŹWIĘKU ---
// --- SILNIK DŹWIĘKU ---
const Sound = {
    type: null, click: null, startup: null, victory: null, failure: null, // <-- DODANE victory i failure
    init() {
        this.type = document.getElementById('audio-type');
        this.click = document.getElementById('audio-click');
        this.startup = document.getElementById('audio-startup');
        this.victory = document.getElementById('audio-victory'); // <-- DODANA LINIA
        this.failure = document.getElementById('audio-failure'); // <-- DODANA LINIA
    },
    unlock() {
        const audios = [this.type, this.click, this.startup, this.victory, this.failure]; // <-- DODANE victory i failure
        if (!audios.every(a => a)) return;
        audios.forEach(audio => {
            audio.play().catch(e => {});
            audio.pause();
            audio.currentTime = 0;
        });
    },
    play(soundName) {
        const audio = this[soundName];
        if (audio) {
            if (!audio.paused) {
                audio.pause();
                audio.currentTime = 0;
            }
            audio.play().catch(e => {});
        }
    },
    stop(soundName) {
        const audio = this[soundName];
        if (audio && !audio.paused) {
            audio.pause();
            audio.currentTime = 0;
        }
    }
};

// ... (reszta kodu pozostaje bez zmian, aż do...)

let bootStarted = false; // Upewnij się, że ta zmienna jest zdefiniowana globalnie

function startBootSequence() {
    if (bootStarted) return;
    bootStarted = true;

    const bootLines = [
        "SYSTEM OPERACYJNY VAULT-TEC (c) 2077", "REJESTR BŁĘDÓW: KRYTYCZNY BŁĄD WEJŚCIA...", "...",
        "TEST PAMIĘCI: 640K OK", "...", "INICJALIZACJA INTERFEJSU ZARZĄDCY KRYPTY 62...", "ŁADOWANIE VTMGR.EXE...", "GOTOWE."
    ];

    Sound.play('startup'); // Włączamy muzykę tła
    
    // Wywołujemy pisanie z ostatnim parametrem 'false', aby WYCISZYĆ dźwięk 'type.mp3'
    typewriterEffect(DOM.bootText, bootLines, () => {
        if (Sound.startup) Sound.startup.pause(); // Wyłączamy muzykę tła na końcu
        DOM.bootCursor.style.display = 'none';
        setTimeout(() => showScreen('login-screen'), 1000);
    }, 40, 500, false); 
}

// --- GŁÓWNY OBIEKT GRY I STAN ---
let gameState = {};
let eventQueue = [];
let isEventActive = false;
let dailyReport = [];
let devMode = false;
let lastShiftPress = 0;
let shiftPressCount = 0;
let savedResources = null;
const RESOURCE_LIMITS = {
    food: 170,
    water: 170,
    power: 170,
    caps: 150,
    scrap: 100
};

// To jest nowa, uproszczona funkcja testów
function performSkillCheck(isClassSpecific) {
    const successChance = isClassSpecific ? 50 : 65; // 60 dla roli, 60% dla reszty
    const roll = Math.random() * 100;
    const success = roll < successChance;

    return { success, chance: successChance };
}

const initialGameState = {
    day: 0,
    player: { name: null, password: null, characterClass: null },
    resources: {
        population: 25, morale: 70, food: 100, water: 100, power: 100, caps: 60, stimpaks: 3, hazmatSuits: 0, scrap: 20,
        weapons: { pistol: 1, shotgun: 0, rifle: 0 }
    },
        machines: {
        hydroponics:   { nazwa: "System Hydroponiczny", wydajnosc: 100, sufitWydajnosci: 100 },
        waterPurifier: { nazwa: "Oczyszczalnia Wody", wydajnosc: 100, sufitWydajnosci: 100 },
        powerGenerator:{ nazwa: "Generator Energii",  wydajnosc: 100, sufitWydajnosci: 100 }
    },
    overseer: { health: 15 },
    dwellers: [],
    expedition: { active: false, dwellerId: null, locationName: null, returnDay: null },
    flags: {
        knowsTheTruth: false, brotherKnows: false, brotherSilenced: false, overseerKilled: false,
        traderKilled: {},
        murdersCommitted: 0,
        // <<-- NAPRAWA TUTAJ -->>
        expeditionsEnabled: false,
        communicatorEnabled: false,
        // <<-- KONIEC NAPRAWY -->>
        hasDeathclawGuardian: false,
        brotherKilledByPlayer: false,
        brotherFramed: false,
        brotherBlackmailed: false,
        brotherKilledByDeathclaw: false,
    },
    log: [],
    usedEventIds: []
};

function handleDevMode(e) {
    if (e.key !== 'Shift') return;

    const now = Date.now();
    if (now - lastShiftPress > 500) { // Resetuj licznik, jeśli minęło >0.5s
        shiftPressCount = 0;
    }

    lastShiftPress = now;
    shiftPressCount++;

    if (shiftPressCount === 5) {
        shiftPressCount = 0; // Zresetuj licznik
        devMode = !devMode; // Przełącz tryb

        if (devMode) {
            // Zapisz aktualne zasoby i włącz tryb boga
            savedResources = { ...gameState.resources };
            gameState.resources.food = 9999;
            gameState.resources.water = 9999;
            gameState.resources.power = 9999;
            gameState.resources.caps = 9999;
            gameState.resources.morale = 100;
            addLog("TRYB DEWELOPERSKI AKTYWOWANY", "good");
        } else {
            // Przywróć zapisane zasoby
            if (savedResources) gameState.resources = { ...savedResources };
            addLog("TRYB DEWELOPERSKI DEZAKTYWOWANY", "bad");
            savedResources = null;
        }
        updateUI();
    }
}

// --- DOM CACHE ---
const DOM = {};

function initDomCache() {
    const ids = ["boot-screen","boot-text","boot-cursor","login-screen","username","password","login-btn","new-game-btn","login-error","epilogue-screen","epilogue-title","epilogue-text","epilogue-new-game-btn","intro-screen","intro-text","continue-intro-btn","character-select-screen","game-screen","day-counter","population-counter","morale-label","morale-counter","food-label","food-counter","food-status","water-label","water-counter","water-status","power-label","power-counter","power-status","caps-counter","overseer-health-bar","overseer-health-value","main-display","next-day-btn","main-cursor","modal-overlay","modal-content","modal-title","modal-body","modal-buttons","expeditions-nav-btn","communicator-nav-btn","ending-screen","ending-text","restart-btn"];
    ids.forEach(id => {
        const camelCaseId = id.replace(/-(\w)/g, (_, letter) => letter.toUpperCase());
        DOM[camelCaseId] = document.getElementById(id);
    });
    DOM.navButtons = document.querySelectorAll('.nav-btn');
    DOM.charSelectButtons = document.querySelectorAll('.char-select-btn');
}

// --- INICJALIZACJA GRY ---
window.onload = function() {
    initDomCache();
    generateGameData();
    init();
    // Czekamy na kliknięcie, aby odblokować dźwięk i rozpocząć
    DOM.bootScreen.addEventListener('click', function unlockAndStart() {
        Sound.unlock();
        startBootSequence();
        // Usuwamy listener, aby nie można było uruchomić sekwencji ponownie
        DOM.bootScreen.removeEventListener('click', unlockAndStart);
    });
};

function showEpilogue(endingData, username) {
    showScreen('epilogue-screen');
    DOM.epilogueTitle.textContent = endingData.title;
    DOM.epilogueTitle.dataset.username = username; // <-- TA LINIA JEST NOWA. Zapisuje nazwę użytkownika.
    DOM.epilogueText.innerHTML = `Historia Zastępcy ${username}:<br><br>${endingData.description}`;
}

function init() {
    Sound.init();
    DOM.loginBtn.addEventListener('click', handleLogin);
    DOM.newGameBtn.addEventListener('click', handleNewGame);
     DOM.epilogueNewGameBtn.addEventListener('click', handleNewGame);
    function showEpilogue(endingData, username) {
    showScreen('epilogue-screen');
    DOM.epilogueTitle.textContent = endingData.title;
    DOM.epilogueTitle.dataset.username = username; // <-- TA LINIA JEST NOWA. Zapisuje nazwę użytkownika.
    DOM.epilogueText.innerHTML = `Historia Zastępcy ${username}:<br><br>${endingData.description}`;
}
    DOM.continueIntroBtn.addEventListener('click', () => {
    showScreen('game-screen');  // 1. Pokaż główny ekran gry
    renderTabContent('status'); // 2. NATYCHMIAST wyrenderuj zakładkę "Status"
    showTutorialModal();        // 3. DOPIERO TERAZ pokaż samouczek na wierzchu
});
    DOM.nextDayBtn.addEventListener('click', () => {
        if (DOM.nextDayBtn.textContent.includes("ZADANIE")) {
            processEventQueue();
        } else {
            startNewDaySequence();
        }
    });
    DOM.restartBtn.addEventListener('click', () => window.location.reload());

    document.querySelectorAll('button').forEach(btn => btn.addEventListener('click', () => Sound.play('click')));
    DOM.charSelectButtons.forEach(btn => btn.addEventListener('click', (e) => selectCharacter(e.currentTarget.dataset.class)));
    DOM.navButtons.forEach(btn => btn.addEventListener('click', (e) => {
        DOM.navButtons.forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        renderTabContent(e.target.dataset.tab);
    }));
    
    // === NOWY KOD DLA TRYBU DEWELOPERSKIEGO ===
    document.addEventListener('keydown', handleDevMode);
    // === KONIEC NOWEGO KODU ===

}


function handleLogin() {
    const username = DOM.username.value.trim().toUpperCase();
    const password = DOM.password.value;
    if (!username || !password) { showLoginError("NAZWA UŻYTKOWNIKA I HASŁO SĄ WYMAGANE."); return; }
    
    const epilogueData = localStorage.getItem(`vault62_epilogue_${username}`);
    if (epilogueData) {
        showEpilogue(JSON.parse(epilogueData), username);
        return;
    }

    // POPRAWIONA WERSJA
const savedGame = localStorage.getItem(`vault62_save_${username}`);
if (savedGame) {
    const parsedGame = JSON.parse(savedGame);
    if (parsedGame.player.password === btoa(password)) {
        gameState = parsedGame;

        // --- OTO KLUCZOWA POPRAWKA ---
        // Sprawdzamy, czy wczytany stan gry ma listę mieszkańców.
        // Jeśli nie, tworzymy pustą, aby uniknąć błędu.
        if (!gameState.dwellers) {
            gameState.dwellers = [];
        }
        // --- KONIEC POPRAWKI ---

        if (!gameState.usedEventIds) gameState.usedEventIds = [];
        showScreen('game-screen');
        updateUI();
        addLog("Sesja wznowiona. Witaj z powrotem, Zastępco.", "info");
    } else {
        showLoginError("BŁĘDNE HASŁO.");
    }
} else {
    showLoginError("NIE ZNALEZIONO ZAPISU DLA TEGO UŻYTKOWNIKA.");
}
}

// Dodaj tę funkcję w okolicy innych funkcji "process..." (np. pod processMachineDegradation)

// POPRAWKA SYSTEMU LIMITÓW ZASOBÓW
function processResourceGeneration() {
    const production = calculateDailyProduction();
    gameState.resources.food += production.food;
    gameState.resources.water += production.water;
    gameState.resources.power += production.power;

    if (devMode) return;

    if (gameState.resources.food > RESOURCE_LIMITS.food) {
        gameState.resources.food = RESOURCE_LIMITS.food - 30;
        addLog("Magazyn żywności przepełniony! Nadmiarowe racje zostały zutylizowane.", "bad");
    }
    if (gameState.resources.water > RESOURCE_LIMITS.water) {
        gameState.resources.water = RESOURCE_LIMITS.water - 30;
        addLog("Zbiorniki z wodą przepełnione! Nadmiar użyto do dekontaminacji.", "bad");
    }
    if (gameState.resources.power > RESOURCE_LIMITS.power) {
        gameState.resources.power = RESOURCE_LIMITS.power - 30;
        addLog("Akumulatory przeładowane! Nadmiar energii rozproszył się.", "bad");
    }
    if (gameState.resources.caps > RESOURCE_LIMITS.caps) {
        gameState.resources.caps = RESOURCE_LIMITS.caps - 30;
        addLog("Nadmiar kapsli zostanie rozdany mieszkanicom.", "bad");
    } 
    if (gameState.resources.scrap > RESOURCE_LIMITS.scrap) {
        gameState.resources.scrap = RESOURCE_LIMITS.scrap - 30;
        addLog("Nadmiar złomu zostanie zutylizowany.", "bad");
    }
}

function selectCharacter(className) {
    gameState.player.characterClass = className;
    applyCharacterBonuses(className);
    
    generateInitialDwellers(); 

    const tutorialTitle = "ZNALEZIONO: Podręcznik Przetrwania dla Nadzorcy v.2.1";
    const tutorialBody = `
        <div style="text-align: left; font-size: 18px; line-height: 1.4;">
            <p><em>[Na terminalu znajdujesz zakurzony, cyfrowy podręcznik pozostawiony przez poprzednika. Otwierasz go...]</em></p>
            <h4 style="border-bottom: 1px solid var(--main-color); padding-bottom: 5px;">ROZDZIAŁ 1: TWOI LUDZIE</h4>
            <p>Każdy mieszkaniec jest inny. Ich kluczowa cecha to <strong>Poziom Przetrwania</strong>. Jest on ustalany raz w roku na podstawie testów sprawnościowych. Im wyższy poziom, tym większa szansa, że mieszkaniec poradzi sobie na Pustkowiach i wróci z łupem.</p>
            
            <h4 style="border-bottom: 1px solid var(--main-color); padding-bottom: 5px;">ROZDZIAŁ 2: TWOJE MASZYNY</h4>
            <p>Systemy podtrzymywania życia produkują zasoby w zależności od ich <strong>wydajności</strong>. W zakładce "STATUS KRYPTY" znajdziesz informację, ile jednostek generuje każda maszyna na danym progu wydajności. Pamiętaj, maszyny psują się każdego dnia!</p>

            <h4 style="border-bottom: 1px solid var(--main-color); padding-bottom: 5px;">ROZDZIAŁ 3: TWOJE DECYZJE</h4>
            <p>Twoje doświadczenie jako <strong>${className.toUpperCase()}</strong> daje ci unikalne pomysły w sytuacjach kryzysowych. Są one potężne, ale ryzykowne. Nikt nie wie, czy zadziałają w warunkach polowych – to zawsze rzut monetą. Czasem lepiej postawić na sprawdzone, bezpieczne rozwiązanie, niż ryzykować katastrofę.</p>

            <h4 style="border-bottom: 1px solid var(--main-color); padding-bottom: 5px;">ROZDZIAŁ 4: ŚWIAT ZEWNĘTRZNY</h4>
            <p>Systemy mapowania i komunikacji działają, ale są stare. <strong>Mapa ekspedycji</strong> bazuje na przedwojennych danych – wiele lokacji może już nie istnieć. <strong>Komunikator</strong> może nawiązać kontakt z innymi Kryptami, ale pamiętaj: nie jesteście sami. Tunele serwisowe łączą wiele Krypt, ale wrota można otworzyć tylko od wewnątrz. Każdy kontakt to szansa, ale i zagrożenie.</p>
            <p class="event-desc" style="text-align: center;">Powodzenia, Nadzorco. Będzie Ci potrzebne.</p>
        </div>
    `;
    updateUI();
    saveGame();
}

// --- GŁÓWNA PĘTLA GRY ---
// NOWA, POPRAWNA WERSJA - SKOPIUJ I ZASTĄP CAŁĄ FUNKCJĘ
function startNewDaySequence() {
    DOM.nextDayBtn.disabled = true;
    DOM.nextDayBtn.textContent = "PRZETWARZANIE...";
    
    setTimeout(() => {
        gameState.day++;
        if (checkEndGameConditions()) return;

        processResourceGeneration();
        processConsumptionAndMorale();
        processDwellerStatus();
        processMachineDegradation();
        if (checkEndGameConditions()) return;

        // === KLUCZOWA ZMIANA: PRZECHWYTUJEMY RAPORT ZWRACANY PRZEZ FUNKCJĘ ===
        const expeditionReport = processExpeditionReturn();

        eventQueue = [];
        
        if (dailyReport.length > 0) {
            addLog("--- Raport Dnia Poprzedniego ---", "info");
            dailyReport.forEach(reportLine => addLog(reportLine, "info"));
            dailyReport = [];
        }
        
        eventQueue.push(...getTriggeredEvents());
        updateUI();

        // === NOWA LOGIKA: POKAZUJEMY RAPORT PRZED ZADANIAMI DNIA ===
        if (expeditionReport) {
            showModal(expeditionReport.title, `<p class="event-desc">${expeditionReport.body}</p>`, [{
                text: "Zrozumiano",
                callback: () => {
                    closeModal();
                    updateUI(); // Aktualizujemy UI po zamknięciu raportu, by odzwierciedlić zmiany
                    if (eventQueue.length > 0) {
                        processEventQueue();
                    } else {
                        finalizeDay();
                    }
                }
            }]);
        } else if (eventQueue.length > 0) {
            // Jeśli nie ma raportu, od razu przechodzimy do zadań dnia
            processEventQueue();
        } else {
            finalizeDay();
        }
    }, 1000);
}

function getTriggeredEvents() {
    const events = [];

    const mainEvent = MAIN_STORY_EVENTS[gameState.day];
    if (mainEvent && (!mainEvent.condition || mainEvent.condition(gameState))) {
        events.push({ type: 'event', data: mainEvent });
        return events;
    }
    
    const allRandomEvents = RANDOM_VAULT_EVENTS.concat(RANDOM_DOOR_EVENTS);
    const availableEvents = allRandomEvents.filter(event => !gameState.usedEventIds.includes(event.id));

    if (availableEvents.length > 0) {
        const randomEvent = availableEvents[Math.floor(Math.random() * availableEvents.length)];
        if (!randomEvent.condition || randomEvent.condition(gameState)) {
            events.push({ type: 'event', data: randomEvent });
            gameState.usedEventIds.push(randomEvent.id);
        }
    } else {
        addLog("System monitoringu nie wykrył żadnych anomalii. Dzień minął spokojnie.", "info");
    }
    
    return events;
}


function processEventQueue() {
    DOM.nextDayBtn.disabled = true;

    if (eventQueue.length === 0) {
        finalizeDay();
        return;
    }
    isEventActive = true;
    const currentEvent = eventQueue.shift();

    const callback = eventQueue.length > 0 ? () => {
        DOM.nextDayBtn.textContent = "ZOBACZ KOLEJNE ZADANIE";
        DOM.nextDayBtn.disabled = false;
    } : finalizeDay;

    if (currentEvent.type === 'report') {
        showModal(currentEvent.title, `<p>${currentEvent.description}</p>`, [{ text: "Potwierdzam", callback: () => { closeModal(); callback(); }}]);
        Sound.play('alert');
    } else if (currentEvent.type === 'event') {
        showEventModal(currentEvent.data, callback);
    }
}

// NOWA, POPRAWNA WERSJA - SKOPIUJ I ZASTĄP CAŁĄ FUNKCJĘ
function finalizeDay() {
    isEventActive = false;
    
    // <<-- KLUCZOWA POPRAWKA: Ustawiamy "Status Krypty" jako domyślną, aktywną zakładkę -->>
    DOM.navButtons.forEach(btn => btn.classList.remove('active'));
    const statusBtn = document.querySelector('.nav-btn[data-tab="status"]');
    if (statusBtn) statusBtn.classList.add('active');
    
    // Od razu renderujemy zawartość tej zakładki, aby uniknąć pustego ekranu
    renderTabContent('status'); 
    
    updateUI();
    saveGame();
    
    DOM.nextDayBtn.disabled = false;
    DOM.nextDayBtn.textContent = "ROZPOCZNIJ NOWY DZIEŃ";
    addLog(`Dzień ${gameState.day} dobiegł końca. Systemy w gotowości.`, "info");
    
    if (checkEndGameConditions()) return;
}

// --- ZARZĄDZANIE UI ---
function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(screenId).classList.add('active');
}


// OSTATECZNA WERSJA FUNKCJI PODRĘCZNIKA - SKOPIUJ I ZASTĄP
function showTutorialModal() {
    const className = gameState.player.characterClass || "Nadzorca";
    const tutorialTitle = "ZNALEZIONO: Podręcznik Przetrwania dla Nadzorcy v.2.1";
    
    const tutorialBody = `
    <div class="scrollable-modal-body">
        <p><em>[Na terminalu znajdujesz zakurzony, cyfrowy podręcznik pozostawiony przez poprzednika. Otwierasz go...]</em></p>
        
        <h4 style="border-bottom: 1px solid var(--main-color); padding-bottom: 5px;">ROZDZIAŁ 1: TWOJE MASZYNY - BIJĄCE SERCE KRYPTY</h4>
        <p>Pamiętaj, te maszyny to życie. Ich <strong>wydajność (%)</strong> spada każdego dnia o 1 do 3 punktów. To naturalne zużycie. Ignoruj je, a skażesz nas na śmierć.</p>
        <p class="event-desc" style="border-color: var(--red-color);"><strong>NAJWAŻNIEJSZA ZASADA:</strong> Jeśli pozwolisz, by wydajność maszyny spadła poniżej progu <strong>(75%, 50% lub 25%)</strong>, coś w niej pęknie na dobre. To <strong>NIEODWRACALNE USZKODZENIE</strong>. Jej maksymalny potencjał spadnie na zawsze. Regularne naprawy to nie sugestia, to rozkaz.</p>
        <p>Magazyny też mają swoje granice. Musi być przejście między półkami. Jeśli jest za dużo zapasów, alejki są blokowane, co staje się niebezpieczne. Wtedy nadmiar jest zużywany na cele porządkowe, a ty dostajesz karę.</p>
        
        <h4 style="border-bottom: 1px solid var(--main-color); padding-bottom: 5px;">ROZDZIAŁ 2: TWOI LUDZIE - TWOJA ODPOWIEDZIALNOŚĆ</h4>
        <p>Co roku nasi technicy przeprowadzają testy sprawnościowe i uśredniają wyniki do jednej, prostej oceny: <strong>Poziomu Przetrwania (1-5)</strong>. To on mówi ci, jak dobrze dana osoba radzi sobie, gdy wszystko inne zawodzi. Kieruj się tą oceną, wysyłając ludzi na Pustkowia. Pamiętaj, że Główny Technik jest kluczowy dla funkcjonowania Krypty – nie może być wysyłany na misje.</p>
        
        <h4 style="border-bottom: 1px solid var(--main-color); padding-bottom: 5px;">ROZDZIAŁ 3: TWOJE DECYZJE - RYZYKO JEST WPISANE W TĘ PRACĘ</h4>
        <p>Każdy dzień to nowe problemy. Możesz kierować się sprawdzonymi rozwiązaniami z tego podręcznika. Możesz też mieć własny pogląd na sprawę, oparty na twoim doświadczeniu jako <strong>${className.toUpperCase()}</strong>. Ale pamiętaj, człowiek średnio myli się w 40% przypadków, co oznacza, że masz tylko <strong>60% szans</strong> na powodzenie. Sprawdzone rozwiązania też mogą zawieść, ale szansa na to jest mała.</p>
        
        <h4 style="border-bottom: 1px solid var(--main-color); padding-bottom: 5px;">ROZDZIAŁ 4: ŚWIAT ZEWNĘTRZNY - NASZA PRZYSZŁOŚĆ</h4>
        <p><strong>Komunikator</strong> to nasza szansa. Handel sam powinien się rozwinąć dzięki systemowi połączeń między Kryptami. Pamiętaj, Nadzorco, zawsze bądź dobry i nie atakuj innych Krypt. Każdy taki akt to krok w tył i zmniejsza szansę na odbudowę Ameryki, która jest naszym nadrzędnym celem.</p>

        <h4 style="border-bottom: 1px solid var(--main-color); padding-bottom: 5px;">ROZDZIAŁ 5: JAK NIE DAĆ SIĘ OBALIĆ</h4>
        <p>Twoim celem jest przetrwać 60 dni. Co 60 dni odbywa się głosowanie, czy Nadzorca się sprawdza. Jeśli tak, zostaje na stanowisku. Staraj się utrzymywać dobre relacje z mieszkańcami. Wściekły tłum jest groźny, buntowniczy i nieprzewidywalny.</p>
        <p>Pamiętaj, jeśli przez twoje decyzje zginie tylu ludzi, że zostanie ich zaledwie garstka, będziesz musiał oddać się do dymisji, bo twoja rola jako Nadzorcy okaże się błędem. Jeśli zabraknie zasobów, umrzecie z głodu. A jeśli maszyny się zepsują... cóż, wtedy produkcja tlenu zostanie wstrzymana, a my zginiemy od zepsutego, promieniującego powietrza.</p>
        
        <p class="event-desc" style="text-align: center;">Powodzenia, Nadzorco. Będzie Ci potrzebne.</p>
    </div>
    `;
    
    showModal(tutorialTitle, tutorialBody, [{ text: "Zrozumiałem. Czas wziąć się do pracy.", callback: closeModal }]);
}
function updateUI() {
    DOM.dayCounter.textContent = gameState.day;
    DOM.populationCounter.textContent = gameState.resources.population;
    DOM.moraleCounter.textContent = Math.floor(gameState.resources.morale);
    DOM.capsCounter.textContent = Math.floor(gameState.resources.caps);
    
    updateResourceUI('food');
    updateResourceUI('water');
    updateResourceUI('power');

    DOM.moraleLabel.style.color = gameState.resources.morale > 60 ? 'var(--main-color)' : (gameState.resources.morale > 30 ? '#CCCC00' : 'var(--red-color)');
    
    // Usunęliśmy stąd problematyczny blok kodu.
    // Teraz tylko finalizeDay() będzie odpowiadać za renderowanie zakładki po evencie.
}

function updateResourceUI(resource) {
    const counter = DOM[resource + 'Counter'];
    const status = DOM[resource + 'Status'];
    const value = gameState.resources[resource];

    // Pobieramy FAKTYCZNĄ produkcję dzienną z maszyn
    const production = calculateDailyProduction(resource);

    // NIE MA JUŻ STAŁEGO ZUŻYCIA!
    const netChange = Math.round(production);

    counter.textContent = Math.floor(value);
    status.style.color = (netChange < 0) ? 'var(--red-color)' : 'var(--main-color)';
    status.textContent = `(${netChange >= 0 ? '+' : ''}${netChange})`;
}

function renderTabContent(tabName) {
    if (!DOM.mainDisplay) return;
    DOM.mainDisplay.innerHTML = ''; // Czyścimy ekran przed renderowaniem nowej zawartości
    switch(tabName) {
        case 'status': renderStatusTab(); break;
        case 'mieszkancy': renderMieszkancyTab(); break;
        case 'magazyn': renderMagazynTab(); break;
        case 'ekspedycje': gameState.flags.expeditionsEnabled ? renderEkspedycjeTab() : renderLockedTab("EKSPEDYCJE", "System mapowania jest niedostępny. Może uda się go naprawić?"); break;
        case 'komunikator': gameState.flags.communicatorEnabled ? renderKomunikatorTab() : renderLockedTab("KOMUNIKATOR", "Moduł komunikacji dalekiego zasięgu jest nieaktywny."); break;
    }
}

// OSTATECZNA POPRAWKA OBRAZKA - ZASTĄP CAŁĄ FUNKCJĘ
function renderLockedTab(title, message) {
    DOM.mainDisplay.innerHTML = `
        <div style="text-align: center; padding-top: 50px; opacity: 0.7;">
            <img src="vault_door_62.jpg" alt="Wrota zamknięte" style="width: 200px; height: 200px; object-fit: contain; filter: grayscale(1) brightness(0.7);">
            <h3 style="color: var(--red-color);">${title} - SYSTEM NIEDOSTĘPNY</h3>
            <p>${message}</p>
        </div>`;
}

function renderStatusTab() {
    let html = `<h3>Główny Panel Statusu</h3><p>Monitoruj kluczowe systemy podtrzymywania życia w Krypcie 62.</p><div class="grid-container">`;

    // === NOWA LOGIKA: USTALAMY KOSZT NAPRAWY PRZED WYŚWIETLENIEM ===
    let repairCost = 20; // Domyślny koszt
    if (gameState.player.characterClass === 'Naukowiec') {
        repairCost = 16; // Zniżka dla Naukowca, zgodnie z Twoją modyfikacją
    }

    for (const machineName in gameState.machines) {
        const machine = gameState.machines[machineName];
        const wydajnosc = Math.round(machine.wydajnosc);
        let color = 'var(--main-color)';
        if (wydajnosc < 75) color = '#CCCC00';
        if (wydajnosc < 50) color = '#FFA500';
        if (wydajnosc < 25) color = 'var(--red-color)';

        const isAtMax = wydajnosc >= machine.sufitWydajnosci;
        const buttonTitle = isAtMax ? 'Maszyna w optymalnym stanie' : `Napraw do ${machine.sufitWydajnosci}%`;
        
        const dailyProduction = calculateDailyProduction(
            machineName === 'hydroponics' ? 'food' : (machineName === 'waterPurifier' ? 'water' : 'power')
        );

        html += `<div class="machine-status">
                    <div class="vertical-progress-bar">
                        <div class="progress-threshold threshold-75"></div>
                        <div class="progress-threshold threshold-50"></div>
                        <div class="progress-threshold threshold-25"></div>
                        <div class="vertical-progress-bar-fill" style="height: ${wydajnosc}%; background-color: ${color};"></div>
                    </div>
                    <div class="machine-details">
                        <h4>${machine.nazwa}</h4>
                        <p>Wydajność: <strong style="color: ${color};">${wydajnosc}%</strong> / ${machine.sufitWydajnosci}%</p>
                        <p>Produkcja dzienna: <strong style="color: ${color};">${dailyProduction}</strong> jedn.</p>
                        <button class="repair-btn" data-machine="${machineName}" ${isAtMax ? 'disabled' : ''} title="${buttonTitle}">Napraw (${repairCost} kapsli)</button>
                    </div>
                 </div>`;
    }
    html += `</div>`;

    if (gameState.flags.hasDeathclawGuardian) {
        html += `<div class="dweller-entry" style="border-color: var(--red-color); margin-top: 15px;">
                    <h4 style="color: var(--red-color);">STATUS SPECJALNY: STRAŻNIK</h4>
                    <p>Oswojony Szpon Śmierci strzeże wejścia do Krypty. Zwiększa szanse na powodzenie misji, ale porażka będzie katastrofalna.</p>
                 </div>`;
    }
    
    html += `<h4 style="margin-top: 20px;">Dziennik Zdarzeń</h4><div class="log-container">${getLogHTML()}</div>`;
    
    html += `<div style="text-align: center; margin-top: 15px;">
                <button id="show-tutorial-btn">[ ? ] PODRĘCZNIK NADZORCY</button>
             </div>`;

    DOM.mainDisplay.innerHTML = html;
    document.querySelectorAll('.repair-btn').forEach(btn => btn.addEventListener('click', (e) => repairMachine(e.target.dataset.machine)));
    
    const tutorialBtn = document.getElementById('show-tutorial-btn');
    if (tutorialBtn) {
        tutorialBtn.addEventListener('click', showTutorialModal);
    }
}

function renderMieszkancyTab() {
    // Krok 1: Tworzymy nagłówek i główny kontener siatki
    let html = `<h3>Zarządzanie Mieszkańcami</h3>
                <p>Każdy mieszkaniec jest ważny. Ich umiejętności i samopoczucie wpływają na całą Kryptę.</p>
                <div class="grid-container">`; // <-- To jest kluczowy element, który tworzy siatkę

    // Krok 2: Sprawdzamy, czy są jacyś mieszkańcy do wyświetlenia
    if (gameState.dwellers && gameState.dwellers.length > 0) {
        // Krok 3: Dla każdego mieszkańca tworzymy osobny "kwadracik"
        gameState.dwellers.forEach(dweller => {
            const statusText = dweller.isBrother ? '(Twój brat) (Główny Technik)' : `(${dweller.profession})`;
            const statusStyle = dweller.isBrother ? 'style="color: #8effa8; font-weight: bold;"' : '';
            
            let currentStatusHTML = `Poziom przetrwania: ${dweller.survivalLevel}`;
            if (dweller.status === 'on_expedition') {
                currentStatusHTML = '<strong style="color: #CCCC00;">Na ekspedycji</strong>';
            } else if (dweller.status === 'injured') {
                currentStatusHTML = `<strong style="color: var(--red-color);">Ranny (Wróci za ${dweller.recoveryDay - gameState.day} dni)</strong>`;
            }

            // Każdy mieszkaniec jest opakowany w <div class="dweller-entry">, co tworzy ramkę
            html += `<div class="dweller-entry">
                        <strong ${statusStyle}>${dweller.name}</strong><br>
                        <span>${statusText}</span><br>
                        <span style="font-size: 14px; opacity: 0.8;">S:${dweller.S} P:${dweller.P} E:${dweller.E} C:${dweller.C} I:${dweller.I} A:${dweller.A} L:${dweller.L}</span><br>
                        <span>${currentStatusHTML}</span>
                    </div>`;
        });
    } else {
        // Ten komunikat pojawi się tylko, jeśli lista mieszkańców jest pusta
        html += '<p>Brak danych o mieszkańcach. Spróbuj rozpocząć nową grę.</p>';
    }
    
    // Krok 4: Zamykamy kontener siatki
    html += '</div>';
    
    // Krok 5: Wstawiamy gotowy kod na stronę
    DOM.mainDisplay.innerHTML = html;
}

// OSTATECZNA, POŁĄCZONA I POPRAWNA WERSJA
function generateInitialDwellers() {
    // Krok 1: Tworzenie mieszkańców (z pierwszej, dobrej funkcji)
    gameState.dwellers = Array.from({ length: gameState.resources.population }, (_, i) => createDweller(i));
    const brotherIndex = Math.floor(Math.random() * (gameState.dwellers.length - 1)) + 1;
    gameState.dwellers[brotherIndex].isBrother = true;
    gameState.dwellers[brotherIndex].name = "Adam";
    gameState.dwellers[brotherIndex].profession = "Główny Technik";
    gameState.dwellers[brotherIndex].C = 5; 
    gameState.dwellers[brotherIndex].I = 4;

    // Krok 2: Pokazywanie ekranu wprowadzenia (z drugiej funkcji)
    showScreen('intro-screen');
    const introLines = [
        "Huk ucichł. Teraz jest tylko smród spalenizny i stęchły zapach strachu. W ambulatorium jedynym dźwiękiem jest miarowe pikanie maszyny podtrzymującej życie. Umowa była prosta. Mieli narobić trochę hałasu, wejść w nocy, pozbyć się Nadzorcy i zniknąć z kilkoma zapasami. Czysta robota.",
        "\nAle oni... oni wpadli w szał. Zamiast jednego trupa, jest osiem. Ośmiu niewinnych ludzi, martwych w kałużach krwi, bo znaleźli się na ich drodze. Splądrowali nie tylko magazyn, ale i prywatne kwatery. A Nadzorca? Nawet tego nie potrafili zrobić dobrze. Kula podziurawiła go jak na wylot, ale serce wciąż bije. Leży tam, nieprzytomny. Uwięziony między życiem a śmiercią.",
        "\nNikt nic nie wie. Mój brat, wiecznie ufny idiota, nawet nie zauważył, kiedy skopiowałem główny klucz z jego technicznego Pip-Boya. Zapasowy terminal, na którym to zrobiłem? Wygodnie stopił się w pożarze, który wybuchł przy generatorze. Żadnych śladów.",
        "\nDopiąłem swego. Teraz ja tu dowodzę. Jestem Zastępcą i tylko krok dzieli mnie od upragnionej władzy. Muszę tylko ogarnąć ten burdel, który sam rozpętałem, zanim on się obudzi... lub umrze. Krypta jest w chaosie, ale to mój chaos.",
        "\nWięc... czas zacząć pracę."
    ];
    typewriterEffect(DOM.introText, introLines, () => {
        DOM.continueIntroBtn.style.display = 'inline-block';
        gameState.flags.knowsTheTruth = true;
    }, 50, 800);

    Sound.play('confirm');
}

function renderMagazynTab() {
    DOM.mainDisplay.innerHTML = `<h3>Magazyn</h3><p>Tutaj przechowywane są wszystkie zasoby i przedmioty.</p><div class="grid-container">
        <div class="warehouse-item"><strong>Żywność:</strong> ${Math.floor(gameState.resources.food)} / ${RESOURCE_LIMITS.food}</div>
        <div class="warehouse-item"><strong>Woda:</strong> ${Math.floor(gameState.resources.water)} / ${RESOURCE_LIMITS.water}</div>
        <div class="warehouse-item"><strong>Energia:</strong> ${Math.floor(gameState.resources.power)} / ${RESOURCE_LIMITS.power}</div>
        <div class="warehouse-item"><strong>Kapsle:</strong> ${Math.floor(gameState.resources.caps)} / ${RESOURCE_LIMITS.caps}</div>
        <div class="warehouse-item"><strong>Złom:</strong> ${Math.floor(gameState.resources.scrap)} / ${RESOURCE_LIMITS.scrap}</div>
        <div class="warehouse-item"><strong>Stimpaki:</strong> ${gameState.resources.stimpaks}</div>
        <div class="warehouse-item"><strong>Skafandry Ochronne:</strong> ${gameState.resources.hazmatSuits}</div>
        <div class="warehouse-item"><strong>Pistolety:</strong> ${gameState.resources.weapons.pistol}</div>
        <div class="warehouse-item"><strong>Strzelby:</strong> ${gameState.resources.weapons.shotgun}</div>
        <div class="warehouse-item"><strong>Karabiny:</strong> ${gameState.resources.weapons.rifle}</div>
    </div>`;
}


function renderKomunikatorTab() {
    let html = `<h3>Terminal Komunikacyjny</h3><p>Moduł dalekiego zasięgu jest aktywny. Możesz próbować nawiązać kontakt z innymi.</p><div class="grid-container">`;
    TRADING_POSTS.forEach(post => {
        const canAttack = (gameState.resources.weapons.pistol + gameState.resources.weapons.shotgun + gameState.resources.weapons.rifle) > 0;
        const relationsBroken = gameState.flags.traderKilled[post.id] || false;
        html += `<div class="dweller-entry"><h4>${post.name}</h4><p>${post.description}</p><button class="trade-btn" data-post-id="${post.id}" ${relationsBroken ? "disabled" : ""}>Handluj</button><button class="attack-btn" data-post-id="${post.id}" ${canAttack && !relationsBroken ? '' : 'disabled'}>Atakuj</button>${relationsBroken ? '<p style="font-size: 14px; color: var(--red-color);">Stosunki zerwane.</p>' : ''}</div>`;
    });
    html += `</div>`;
    DOM.mainDisplay.innerHTML = html;
    document.querySelectorAll('.trade-btn:not(:disabled)').forEach(btn => btn.addEventListener('click', e => startTrade(TRADING_POSTS.find(p => p.id == e.target.dataset.postId))));
    document.querySelectorAll('.attack-btn:not(:disabled)').forEach(btn => btn.addEventListener('click', e => planAttack(TRADING_POSTS.find(p => p.id == e.target.dataset.postId))));
}





function renderTabContent(tab) {
    if (isEventActive) return; // Nie renderuj podczas eventu
    switch (tab) {
        case 'status': renderStatusTab(); break;
        case 'mieszkancy': renderMieszkancyTab(); break;
        case 'magazyn': renderMagazynTab(); break;
        case 'ekspedycje':
            if (!gameState.flags.expeditionsEnabled) {
                renderLockedTab("EKSPEDYCJE", "System mapowania Pip-Boya jest nieaktywny. Odblokuj go w trakcie gry.");
            } else {
                renderEkspedycjeTab();
            }
            break;
        case 'komunikator':
            if (!gameState.flags.communicatorEnabled) {
                renderLockedTab("KOMUNIKATOR", "Terminal komunikacyjny jest nieaktywny. Odblokuj go w trakcie gry.");
            } else {
                renderKomunikatorTab();
            }
            break;
        default:
            renderStatusTab();
    }
}


// NOWA, POPRAWNA WERSJA - ZASTĄP CAŁĄ FUNKCJĘ
function renderMagazynTab() {
    DOM.mainDisplay.innerHTML = `<h3>Magazyn</h3><p>Tutaj przechowywane są wszystkie zasoby i przedmioty.</p><div class="grid-container">
        <div class="warehouse-item"><strong>Żywność:</strong> ${Math.floor(gameState.resources.food)} / ${RESOURCE_LIMITS.food} jedn.</div>
        <div class="warehouse-item"><strong>Woda:</strong> ${Math.floor(gameState.resources.water)} / ${RESOURCE_LIMITS.water} jedn.</div>
        <div class="warehouse-item"><strong>Energia:</strong> ${Math.floor(gameState.resources.power)} / ${RESOURCE_LIMITS.power} jedn.</div>
        <div class="warehouse-item"><strong>Kapsle:</strong> ${Math.floor(gameState.resources.caps)} / ${RESOURCE_LIMITS.caps}</div>
        <div class="warehouse-item"><strong>Złom:</strong> ${Math.floor(gameState.resources.scrap)} / ${RESOURCE_LIMITS.scrap}</div>
        <div class="warehouse-item"><strong>Stimpaki:</strong> ${gameState.resources.stimpaks}</div>
        <div class="warehouse-item"><strong>Skafandry Ochronne:</strong> ${gameState.resources.hazmatSuits}</div>
        <div class="warehouse-item"><strong>Pistolety:</strong> ${gameState.resources.weapons.pistol}</div>
        <div class="warehouse-item"><strong>Strzelby:</strong> ${gameState.resources.weapons.shotgun}</div>
        <div class="warehouse-item"><strong>Karabiny:</strong> ${gameState.resources.weapons.rifle}</div>
    </div>`;
}

// NOWA, POPRAWIONA WERSJA Z WŁAŚCIWYM SKALOWANIEM MAPY - ZASTĄP CAŁĄ FUNKCJĘ
function renderEkspedycjeTab() {
    let html = '<h3>Mapa Okolicy</h3>';
    if(gameState.expedition.active) {
        const dweller = gameState.dwellers.find(d => d.id === gameState.expedition.dwellerId);
        html += `<p>Ekspedycja w toku.</p>
                 <p>Mieszkaniec: ${dweller ? dweller.name : 'Nieznany'}</p>
                 <p>Cel: ${gameState.expedition.locationName}</p>
                 <p>Przewidywany powrót: Dzień ${gameState.expedition.returnDay}</p>`;
    } else {
        html += `<p>Wybierz lokację do zbadania. Tylko jedna ekspedycja może być aktywna.</p>
                 <div id="map-container">
                    <div id="map-aspect-ratio-holder">
                        <img src="map.jpg" class="map-image" alt="Mapa Pustkowi">
                        ${EXPEDITION_LOCATIONS.map(loc => `<div class="map-point" style="left:${loc.x}%; top:${loc.y}%;" data-loc-id="${loc.id}" title="${loc.name} (Ryzyko: ${loc.risk}, Czas: ok. ${loc.duration[0]}-${loc.duration[1]} dni)"></div>`).join('')}
                    </div>
                 </div>`;
    }
    DOM.mainDisplay.innerHTML = html;

    if (!gameState.expedition.active) {
        document.querySelectorAll('.map-point').forEach(point => {
            point.addEventListener('click', (e) => {
                const location = EXPEDITION_LOCATIONS.find(l => l.id === parseInt(e.target.dataset.locId));
                confirmExpedition(location);
            });
        });
    }
}

function renderKomunikatorTab() {
    let html = `<h3>Terminal Komunikacyjny</h3><p>Moduł dalekiego zasięgu jest aktywny. Możesz próbować nawiązać kontakt z innymi.</p><div class="grid-container">`;
    TRADING_POSTS.forEach(post => {
        const canAttack = (gameState.resources.weapons.pistol + gameState.resources.weapons.shotgun + gameState.resources.weapons.rifle) > 0;
        const relationsBroken = gameState.flags.traderKilled[post.id] || false;
        html += `<div class="dweller-entry"><h4>${post.name}</h4><p>${post.description}</p>
                 <button class="trade-btn" data-post-id="${post.id}" ${relationsBroken ? "disabled" : ""}>Handluj</button>
                 <button class="attack-btn" data-post-id="${post.id}" ${canAttack && !relationsBroken ? '' : 'disabled'}>Atakuj</button>
                 ${relationsBroken ? '<p style="font-size: 14px; color: var(--red-color);">Stosunki zerwane.</p>' : ''}
                 </div>`;
    });
    html += `</div>`;
    DOM.mainDisplay.innerHTML = html;

    // --- POPRAWIONA LOGIKA PRZYCISKÓW ---
    document.querySelectorAll('.trade-btn:not(:disabled)').forEach(btn => btn.addEventListener('click', e => {
        // Poprawnie znajdujemy handlarza na podstawie ID z przycisku i uruchamiamy handel
        const post = TRADING_POSTS.find(p => p.id == e.target.dataset.postId);
        startTrade(post);
    }));
    document.querySelectorAll('.attack-btn:not(:disabled)').forEach(btn => btn.addEventListener('click', e => {
        // Poprawnie znajdujemy handlarza na podstawie ID z przycisku i uruchamiamy planowanie ataku
        const post = TRADING_POSTS.find(p => p.id == e.target.dataset.postId);
        planAttack(post);
    }));
    // --- KONIEC POPRAWIONEJ LOGIKI ---
}

// --- MODALE I ZDARZENIA ---
function showModal(title, bodyHtml, buttons) {
    DOM.modalTitle.textContent = title;
    DOM.modalBody.innerHTML = bodyHtml;
    DOM.modalButtons.innerHTML = '';
    buttons.forEach(btnInfo => {
        const button = document.createElement('button');
        button.innerHTML = btnInfo.text;
        button.onclick = () => { Sound.play('click'); if (btnInfo.callback) btnInfo.callback(btnInfo.args); };
        if (btnInfo.disabled) {
            button.disabled = true;
            if (btnInfo.isSkillCheck) button.classList.add('disabled-skill-check');
        }
        DOM.modalButtons.appendChild(button);
    });
    DOM.modalOverlay.classList.remove('hidden');
    Sound.play('alert');
}

function closeModal() { DOM.modalOverlay.classList.add('hidden'); }

function hasEnoughResources(cost) {
    if (!cost) return true;
    for (const res in cost) {
        if (typeof cost[res] === 'object') {
            for (const subRes in cost[res]) {
                if ((gameState.resources[res]?.[subRes] ?? 0) < cost[res][subRes]) return false;
            }
        } else {
            // Obsługa broni, złomu, itp.
            if (res === 'weapons') {
                for (const weaponType in cost[res]) {
                    if ((gameState.resources.weapons[weaponType] ?? 0) < cost[res][weaponType]) return false;
                }
            } else if ((gameState.resources[res] ?? 0) < cost[res]) {
                return false;
            }
        }
    }
    return true;
}

// NOWA, POPRAWNA WERSJA - ZASTĄP CAŁĄ FUNKCJĘ
function subtractResources(cost) {
    if (!cost) return;
    for (const res in cost) {
        if (typeof cost[res] === 'object') { // Obsługa obiektów, np. 'weapons'
            for (const subRes in cost[res]) {
                if (gameState.resources[res] && typeof gameState.resources[res][subRes] === 'number') {
                    gameState.resources[res][subRes] -= cost[res][subRes];
                    // === GWARANCJA: Zasób nigdy nie będzie ujemny ===
                    if (gameState.resources[res][subRes] < 0) {
                         gameState.resources[res][subRes] = 0;
                    }
                }
            }
        } else { // Obsługa prostych zasobów, np. 'caps'
            if (typeof gameState.resources[res] === 'number') {
                gameState.resources[res] -= cost[res];
                // === GWARANCJA: Zasób nigdy nie będzie ujemny ===
                if (gameState.resources[res] < 0) {
                    gameState.resources[res] = 0;
                }
            }
        }
    }
}

// OSTATECZNA WERSJA WYŚWIETLANIA ZADAŃ I KOSZTÓW - ZASTĄP CAŁĄ FUNKCJĘ
function showEventModal(event, onEventResolvedCallback) {
    let body = "";
    
    let imageSrc = event.image;
    if (event.type === 'vault' && !event.image) {
        imageSrc = 'vault_boy.jpg';
    }
    if (imageSrc) {
        body += `<img src="${imageSrc}" alt="Event Image" id="modal-image">`;
    }

    body += `<p class="event-desc">${event.introduction ? event.introduction + "<br><br>" : ""}${event.description}</p>`;

    const buttons = event.options.map(option => {
        let buttonText = option.text; // Bierzemy czysty tekst z zadania
        let isDisabled = false;
        
        if (option.isClassSpecific && option.classCheck !== gameState.player.characterClass) {
            isDisabled = true;
            buttonText += ` <span style="opacity: 0.7; color: var(--red-color);">[WYMAGA: ${option.classCheck.toUpperCase()}]</span>`;
        } else {
            if (option.cost && !hasEnoughResources(option.cost)) {
                isDisabled = true;
            }
            if (option.condition && !option.condition(gameState)) {
                isDisabled = true;
            }
        }
        
        // === INTELIGENTNA LOGIKA, KTÓRA ZAWSZE DZIAŁA ===
        // Ta część kodu teraz sama tworzy i dodaje informację o koszcie na końcu przycisku.
        if (option.cost) {
            const costStrings = [];
            const resourceNames = {
                food: "żywności", water: "wody", power: "energii", caps: "kapsli",
                scrap: "złomu", stimpaks: "stimpaków", pistol: "pistoletów",
                shotgun: "strzelb", rifle: "karabinów"
            };

            for (const res in option.cost) {
                if (typeof option.cost[res] === 'object') {
                    for (const subRes in option.cost[res]) {
                        costStrings.push(`-${option.cost[res][subRes]} ${resourceNames[subRes] || subRes}`);
                    }
                } else {
                    costStrings.push(`-${option.cost[res]} ${resourceNames[res] || res}`);
                }
            }
            buttonText += ` <span style="color: var(--red-color)">(${costStrings.join(', ')})</span>`;
        }
        // === KONIEC POPRAWKI ===
        
        return {
            text: buttonText,
            disabled: isDisabled,
            callback: () => {
                if (isDisabled) return;
                if (option.cost) subtractResources(option.cost);
                let outcomeMessage;
                let success = true;
                if (option.skillCheck) {
                    const skillCheckResult = performSkillCheck(option.isClassSpecific || false);
                    success = skillCheckResult.success;
                    addLog(`[TEST UMIEJĘTNOŚCI] Wynik: ${success ? 'Sukces!' : 'Porażka.'}`, success ? 'good' : 'bad');
                }
                outcomeMessage = success 
                    ? (option.successEffect ? option.successEffect(gameState) : (option.effect ? option.effect(gameState) : '')) 
                    : (option.failureEffect ? option.failureEffect(gameState) : '');

                if (outcomeMessage) {
                    if (typeof outcomeMessage === 'object' && outcomeMessage.desc) {
                        addLog(outcomeMessage.desc, success ? 'good' : 'bad');
                    } else if (typeof outcomeMessage === 'string') {
                         addLog(outcomeMessage, success ? 'good' : 'bad');
                    }
                }
                updateUI();
                closeModal();
                if (onEventResolvedCallback) onEventResolvedCallback();
            }
        };
    });
    showModal(event.title, body, buttons);
}



function generateInitialDwellers() {
    gameState.dwellers = Array.from({ length: gameState.resources.population }, (_, i) => createDweller(i));
    const brotherIndex = Math.floor(Math.random() * (gameState.dwellers.length - 1)) + 1;
    gameState.dwellers[brotherIndex].isBrother = true;
    gameState.dwellers[brotherIndex].name = "Adam";
    gameState.dwellers[brotherIndex].profession = "Główny Technik";
    gameState.dwellers[brotherIndex].C = 5; gameState.dwellers[brotherIndex].I = 4;
}

function createDweller(id) {
    const firstNames = ["Jan","Anna","Piotr","Ewa","Krzysztof","Maria","Tomasz","Agata","Marek","Julia"];
    const lastNames = ["Kowalski","Nowak","Wiśniewski","Wójcik","Mazur","Zieliński","Szymański","Woźniak"];
    const professions = ["Inżynier", "Medyk", "Ochroniarz", "Kucharz", "Naukowiec", "Rolnik", "Technik"];
    const name = `${firstNames[Math.floor(Math.random() * firstNames.length)]} ${lastNames[Math.floor(Math.random() * lastNames.length)]}`;
    
    // Losowanie Poziomu Przetrwania
    const roll = Math.random() * 100;
    let survivalLevel;
    if (roll < 30) survivalLevel = 1;      // 30% szans
    else if (roll < 55) survivalLevel = 2; // 25% szans
    else if (roll < 75) survivalLevel = 3; // 20% szans
    else if (roll < 90) survivalLevel = 4; // 15% szans
    else survivalLevel = 5;                // 10% szans

    return {
        id: id, name: name, profession: professions[Math.floor(Math.random() * professions.length)],
        // Wizualne statystyki S.P.E.C.I.A.L.
        S: Math.ceil(Math.random()*5), P: Math.ceil(Math.random()*5), E: Math.ceil(Math.random()*5),
        C: Math.ceil(Math.random()*5), I: Math.ceil(Math.random()*5), A: Math.ceil(Math.random()*5),
        L: Math.ceil(Math.random()*5),
        // Nowa, kluczowa mechanika
        survivalLevel: survivalLevel,
        status: 'idle', isBrother: false, recoveryDay: 0
    };
}

function applyCharacterBonuses(className) {
    const bonus = CHARACTER_CLASSES[className];
    addLog(`Wybrano klasę: ${className}.`, 'good');
}

function saveGame() {
    if (gameState.player.name) {
        localStorage.setItem(`vault62_save_${gameState.player.name}`, JSON.stringify(gameState));
    }
}

function calculateAttackPower() {
    if (!gameState.resources || !gameState.resources.weapons) return 0;
    
    // Każdy typ broni ma inną, stałą wartość ataku
    return (gameState.resources.weapons.pistol * 5) + 
           (gameState.resources.weapons.shotgun * 15) + 
           (gameState.resources.weapons.rifle * 30);
}


function handleNewGame() {
    const username = DOM.username.value.trim().toUpperCase();
    const password = DOM.password.value;
    if (!username || !password) { showLoginError("PODAJ NAZWĘ UŻYTKOWNIKA I HASŁO DLA NOWEJ KAMPANII."); return; }

    localStorage.removeItem(`vault62_epilogue_${username}`);
    gameState = JSON.parse(JSON.stringify(initialGameState));
    gameState.player.name = username;
    gameState.player.password = btoa(password);
    
    // Po utworzeniu nowej gry, przechodzimy do wyboru postaci
    showScreen('character-select-screen');
}

function selectCharacter(className) {
    gameState.player.characterClass = className;
    applyCharacterBonuses(className);
    
    // Krok 1: Stwórz mieszkańców w tle.
    generateInitialDwellers(); 
    
    // Krok 2: Pokaż ekran z prologiem.
    showPrologue();
    
    // Krok 3: Zapisz grę, aby wybór postaci był zachowany.
    saveGame();
}

function generateInitialDwellers() {
    // Ta funkcja teraz robi TYLKO to, co powinna: tworzy mieszkańców.
    gameState.dwellers = Array.from({ length: gameState.resources.population }, (_, i) => createDweller(i));
    const brotherIndex = Math.floor(Math.random() * (gameState.dwellers.length - 1)) + 1;
    gameState.dwellers[brotherIndex].isBrother = true;
    gameState.dwellers[brotherIndex].name = "Adam";
    gameState.dwellers[brotherIndex].profession = "Główny Technik";
    gameState.dwellers[brotherIndex].C = 5; 
    gameState.dwellers[brotherIndex].I = 4;
}

function createDweller(id) {
    const firstNames = ["Jan", "Anna", "Piotr", "Ewa", "Krzysztof", "Maria", "Tomasz", "Agata", "Marek", "Julia"];
    const lastNames = ["Kowalski", "Nowak", "Wiśniewski", "Wójcik", "Mazur", "Zieliński", "Szymański", "Woźniak"];
    const professions = ["Inżynier", "Medyk", "Ochroniarz", "Kucharz", "Naukowiec", "Rolnik", "Technik"];
    const name = `${firstNames[Math.floor(Math.random() * firstNames.length)]} ${lastNames[Math.floor(Math.random() * lastNames.length)]}`;
    
    // Losowanie Poziomu Przetrwania - najważniejsza mechanika
    const roll = Math.random() * 100;
    let survivalLevel;
    if (roll < 30) survivalLevel = 1;      // 30% szans
    else if (roll < 55) survivalLevel = 2; // 25% szans
    else if (roll < 75) survivalLevel = 3; // 20% szans
    else if (roll < 90) survivalLevel = 4; // 15% szans
    else survivalLevel = 5;                // 10% szans

    return {
        id: id,
        name: name,
        profession: professions[Math.floor(Math.random() * professions.length)],
        S: Math.ceil(Math.random() * 5), P: Math.ceil(Math.random() * 5), E: Math.ceil(Math.random() * 5),
        C: Math.ceil(Math.random() * 5), I: Math.ceil(Math.random() * 5), A: Math.ceil(Math.random() * 5),
        L: Math.ceil(Math.random() * 5),
        survivalLevel: survivalLevel,
        status: 'idle',
        isBrother: false,
        recoveryDay: 0
    };
}

function showPrologue() {
    showScreen('intro-screen');
    const introLines = [
        "Huk ucichł. Teraz jest tylko smród spalenizny i stęchły zapach strachu. W ambulatorium jedynym dźwiękiem jest miarowe pikanie maszyny podtrzymującej życie. Umowa była prosta. Mieli narobić trochę hałasu, wejść w nocy, pozbyć się Nadzorcy i zniknąć z kilkoma zapasami. Czysta robota.",
        "\nAle oni... oni wpadli w szał. Zamiast jednego trupa, jest osiem. Ośmiu niewinnych ludzi, martwych w kałużach krwi, bo znaleźli się na ich drodze. Splądrowali nie tylko magazyn, ale i prywatne kwatery. A Nadzorca? Nawet tego nie potrafili zrobić dobrze. Kula podziurawiła go jak na wylot, ale serce wciąż bije. Leży tam, nieprzytomny. Uwięziony między życiem a śmiercią.",
        "\nNikt nic nie wie. Mój brat, wiecznie ufny idiota, nawet nie zauważył, kiedy skopiowałem główny klucz z jego technicznego Pip-Boya. Zapasowy terminal, na którym to zrobiłem? Wygodnie stopił się w pożarze, który wybuchł przy generatorze. Żadnych śladów.",
        "\nDopiąłem swego. Teraz ja tu dowodzę. Jestem Zastępcą i tylko krok dzieli mnie od upragnionej władzy. Muszę tylko ogarnąć ten burdel, który sam rozpętałem, zanim on się obudzi... lub umrze. Krypta jest w chaosie, ale to mój chaos.",
        "\nWięc... czas zacząć pracę."
    ];
    
    // Krok 1: Tworzymy interwał, który będzie odtwarzał dźwięk 'type' co 3 sekundy
    const typingInterval = setInterval(() => {
        Sound.play('type');
    }, 3000); // <-- Zmienione na 3000 milisekund (3 sekundy)

    // Krok 2: Uruchamiamy animację pisania BEZ wbudowanego dźwięku
    typewriterEffect(DOM.introText, introLines, () => {
        // Krok 3: Kiedy pisanie się skończy, ZATRZYMUJEMY pętlę dźwiękową
        clearInterval(typingInterval);
        
        // Dodatkowo zatrzymujemy ostatnio odtwarzany dźwięk, jeśli jeszcze gra
        Sound.stop('type'); 
        
        DOM.continueIntroBtn.style.display = 'inline-block';
        gameState.flags.knowsTheTruth = true;
    }, 50, 800, false); // 'false' gwarantuje, że funkcja sama nie odtwarza dźwięku
}



// NOWA, POPRAWNA WERSJA - SKOPIUJ I ZASTĄP CAŁĄ FUNKCJĘ
// NOWA, POPRAWNA WERSJA
function calculateDailyProduction(resourceType = null) {
    const productions = { food: 0, water: 0, power: 0 };
    const machineMapping = {
        food: gameState.machines.hydroponics,
        water: gameState.machines.waterPurifier,
        power: gameState.machines.powerGenerator
    };

    for (const resource in productions) {
        const machine = machineMapping[resource];
        let production = 0;
        const wydajnosc = machine.wydajnosc;

        if (wydajnosc > 75) {
            if (resource === 'food') production = 3;
            else if (resource === 'water') production = 3;
            else if (resource === 'power') production = 4;
        } else if (wydajnosc > 50) {
            if (resource === 'food') production = 2;
            else if (resource === 'water') production = 2;
            else if (resource === 'power') production = 3;
        } else if (wydajnosc > 25) {
            if (resource === 'food') production = 1;
            else if (resource === 'water') production = 1;
            else if (resource === 'power') production = 2;
        } else if (wydajnosc > 1) {
            if (resource === 'power') production = 1;
            else production = 0; 
        }
        productions[resource] = production;
    }

    if (resourceType) {
        return productions[resourceType];
    }
    return productions;
}

// NOWA, POPRAWNA WERSJA
// OSTATECZNA WERSJA - BEZ STAŁEGO ZUŻYCIA
// PRZYWRÓCENIE SPADKU MORALE
function processConsumptionAndMorale() {
    let moraleChange = 0;

    if (gameState.resources.food < 0) { 
        moraleChange -= 12; 
        addLog(`Głód w Krypcie! Mieszkańcy cierpią.`, 'bad'); 
        gameState.resources.food = 0;
    }
    if (gameState.resources.water < 0) { 
        moraleChange -= 15; 
        addLog(`Brak wody! Ludzie umierają z pragnienia.`, 'bad'); 
        gameState.resources.water = 0; 
    }
    if (gameState.resources.power < 0) {
        moraleChange -= 10;
        addLog(`KRYTYCZNY BRAK ENERGII! Systemy podtrzymywania życia wyłączone!`, 'bad');
        gameState.resources.power = 0;
        gameState.machines.hydroponics.wydajnosc = 0;
        gameState.machines.waterPurifier.wydajnosc = 0;
    }

    if (moraleChange === 0) {
        moraleChange = -2; // Stały, codzienny spadek morale
    }
    
    gameState.resources.morale += moraleChange;
    gameState.resources.morale = Math.max(0, Math.min(100, gameState.resources.morale));
}

function processDwellerStatus() {
    gameState.dwellers.forEach(dweller => {
        if (dweller.recoveryDay > 0 && gameState.day >= dweller.recoveryDay) {
            dweller.status = 'idle';
            dweller.recoveryDay = 0;
            addLog(`${dweller.name} doszedł do siebie i jest gotów do pracy.`, 'good');
        }
    });
}

// NOWA, POPRAWNA WERSJA Z LOSOWĄ DEGRADACJĄ - ZASTĄP CAŁĄ FUNKCJĘ
function processMachineDegradation() {
    for (const machineName in gameState.machines) {
        const machine = gameState.machines[machineName];
        if (machine.wydajnosc <= 0) continue;

        // NOWA, LOSOWA DEGRADACJA (od 2 do 5)
        // Math.random() zwraca liczbę od 0 do 0.999...
        // (5 - 2 + 1) = 4.  Math.random() * 4 daje liczbę od 0 do 3.999...
        // Math.floor(...) zaokrągla w dół (0, 1, 2, 3)
        // Dodając 2, otrzymujemy losową liczbę całkowitą: 2, 3, 4, lub 5.
        const degradationRate = Math.floor(Math.random() * 3) + 1; // ZMIANA: Degradacja 1-3
        
        machine.wydajnosc -= degradationRate;

        // Logika trwałego uszkodzenia pozostaje bez zmian
        if (machine.sufitWydajnosci === 100 && machine.wydajnosc < 75) {
            machine.sufitWydajnosci = 75;
            addLog(`[ALARM] ${machine.nazwa} doznał trwałego uszkodzenia! Maksymalna wydajność spadła do 75%.`, 'bad');
        } else if (machine.sufitWydajnosci === 75 && machine.wydajnosc < 50) {
            machine.sufitWydajnosci = 50;
            addLog(`[KRYTYCZNY] ${machine.nazwa} jest poważnie uszkodzony! Maksymalna wydajność spadła do 50%.`, 'bad');
        } else if (machine.sufitWydajnosci === 50 && machine.wydajnosc < 25) {
            machine.sufitWydajnosci = 25;
            addLog(`[KATASTROFA] ${machine.nazwa} jest na granicy zniszczenia! Maksymalna wydajność to teraz tylko 25%.`, 'bad');
        }

        if (machine.wydajnosc < 0) {
            machine.wydajnosc = 0;
        }
    }
}

// NOWA, POPRAWIONA WERSJA Z BONUSEM DLA NAUKOWCA - ZASTĄP CAŁĄ FUNKCJĘ
function repairMachine(machineName) {
    // === NOWA LOGIKA: SPRAWDZANIE KLASY I USTALANIE KOSZTU ===
    let repairCost = 20; // Standardowy koszt
    if (gameState.player.characterClass === 'Naukowiec') {
        repairCost = 16; // Zniżka 25% dla Naukowca!
    }
    // =========================================================

    if (gameState.resources.caps >= repairCost) {
        gameState.resources.caps -= repairCost;
        const machine = gameState.machines[machineName];
        
        machine.wydajnosc = machine.sufitWydajnosci;

        addLog(`Technicy przywrócili wydajność maszyny ${machine.nazwa} do ${machine.sufitWydajnosci}%. Koszt: ${repairCost} kapsli.`, 'good');
        renderTabContent('status'); 
        updateUI();
        saveGame();
    } else {
        showModal("Brak Kapsli", `<p>Nie masz wystarczająco kapsli, aby opłacić naprawę (Wymagane: ${repairCost}).</p>`, [{ text: "OK", callback: closeModal }]);
    }
}

// NOWA, POPRAWNA WERSJA - ZASTĄP CAŁĄ FUNKCJĘ
// NOWA, POPRAWNA WERSJA
function calculateDailyProduction(resourceType = null) {
    const productions = { food: 0, water: 0, power: 0 };
    const machineMapping = {
        food: gameState.machines.hydroponics,
        water: gameState.machines.waterPurifier,
        power: gameState.machines.powerGenerator
    };

    for (const resource in productions) {
        const machine = machineMapping[resource];
        let production = 0;
        const wydajnosc = machine.wydajnosc;

        // NOWA, ŚCIŚLE OKREŚLONA LOGIKA PRODUKCJI ZGODNA Z TWOIMI WYTYCZNYMI
        if (wydajnosc > 75) {
            if (resource === 'food') production = 3;
            else if (resource === 'water') production = 3;
            else if (resource === 'power') production = 4;
        } else if (wydajnosc > 50) {
            if (resource === 'food') production = 2;
            else if (resource === 'water') production = 2;
            else if (resource === 'power') production = 3;
        } else if (wydajnosc > 25) {
            if (resource === 'food') production = 1;
            else if (resource === 'water') production = 1;
            else if (resource === 'power') production = 2;
        } else if (wydajnosc > 1) { // Zmienione z "> 0" na "> 1", aby próg 1% był ostatnim
            if (resource === 'power') production = 1;
            // Dla żywności i wody produkcja poniżej 25% wynosi 0, zgodnie z Twoją logiką
            else production = 0; 
        }
        
        productions[resource] = production;
    }

    if (resourceType) {
        return productions[resourceType];
    }
    return productions;
}
function addLog(message, type) {
    const typeClass = type || 'neutral';
    gameState.log.unshift({ text: message, type: typeClass, day: gameState.day });
    if (gameState.log.length > 200) gameState.log.pop();
    const logContainer = document.querySelector('.log-container');
    if (logContainer) logContainer.innerHTML = getLogHTML();
}

function getLogHTML() {
    return gameState.log.map(entry => `<div class="log-entry ${entry.type}">[Dzień ${entry.day}] ${entry.text}</div>`).join('');
}

function typewriterEffect(element, lines, callback, charDelay = 40, lineDelay = 500, playSound = true) {
    element.innerHTML = "";
    let lineIndex = 0;
    let charIndex = 0;

    function type() {
        if (lineIndex < lines.length) {
            if (charIndex < lines[lineIndex].length) {
                
                // --- NOWA, ULEPSZONA LOGIKA DŹWIĘKU ---
                if (playSound) {
                    const currentChar = lines[lineIndex].charAt(charIndex);
                    const prevChar = charIndex > 0 ? lines[lineIndex].charAt(charIndex - 1) : ' '; // Traktuj początek jak spację

                    // Odtwarzaj dźwięk tylko, jeśli aktualny znak NIE jest spacją, a poprzedni BYŁ spacją.
                    if (currentChar !== ' ' && prevChar === ' ') {
                        Sound.play('type');
                    }
                }
                // --- KONIEC NOWEJ LOGIKI ---

                element.innerHTML += lines[lineIndex].charAt(charIndex);
                charIndex++;
                setTimeout(type, charDelay);
            } else {
                element.innerHTML += '<br>';
                lineIndex++;
                charIndex = 0;
                setTimeout(type, lineDelay);
            }
        } else if (callback) {
            callback();
        }
    }
    type();
}

function showLoginError(message) { DOM.loginError.textContent = message; DOM.loginError.style.display = 'block'; setTimeout(() => DOM.loginError.style.display = 'none', 3000); }

function processExpeditionReturn() {
    if (!gameState.expedition.active || gameState.day < gameState.expedition.returnDay) return null;

    const dweller = gameState.dwellers.find(d => d.id === gameState.expedition.dwellerId);
    const location = EXPEDITION_LOCATIONS.find(l => l.name === gameState.expedition.locationName);
    
    let report = {
        title: `Raport z Ekspedycji: ${location ? location.name : 'Nieznana Lokacja'}`,
        body: ''
    };

    if (!dweller) {
        report.body = "Utracono kontakt ze zwiadowcą. Misja została uznana za porażkę, a zwiadowca za zaginionego.";
        gameState.expedition = { active: false, dwellerId: null, locationName: null, returnDay: null };
        return report;
    }
    
    // === NOWA LOGIKA PRZETRWANIA ZGODNA Z TWOIMI PROCENTAMI ===
    const survivalChances = { 5: 75, 4: 65, 3: 50, 2: 40, 1: 30 };
    let finalSurvivalChance = survivalChances[dweller.survivalLevel] || 50; // Domyślnie 50%
    
    // Bonusy klasowe i od strażnika wciąż działają
    if (gameState.player.characterClass === 'Siłacz') finalSurvivalChance += 10;
    if (gameState.flags.hasDeathclawGuardian) finalSurvivalChance += 15;
    finalSurvivalChance = Math.min(100, finalSurvivalChance); // Ograniczenie do 100%
    
    const survived = Math.random() * 100 < finalSurvivalChance;

    if (survived) {
        dweller.status = 'idle';
        
        // === NOWA, BARDZIEJ ROZBUDOWANA LOGIKA ŁUPU ===
        const lootChanceModifier = location.lootChanceModifier || 1.0;
        let lootResult = null;
        
        // Zależnie od poziomu, mieszkaniec ma dostęp do różnych "widełek" łupu
        switch (dweller.survivalLevel) {
            case 5:
            case 4:
                // Poziomy 5 i 4 mogą zdobyć łup dobry lub średni
                if (Math.random() * 100 < (40 * lootChanceModifier)) { // 40% bazowej szansy na najlepszy łup
                    lootResult = location.loot.good(gameState);
                } else {
                    lootResult = location.loot.mediocre(gameState);
                }
                break;
            case 3:
                // Poziom 3 może zdobyć łup średni lub słaby
                 if (Math.random() * 100 < (50 * lootChanceModifier)) {
                    lootResult = location.loot.mediocre(gameState);
                } else {
                    lootResult = location.loot.bad(gameState);
                }
                break;
            case 2:
            case 1:
                // Najsłabsi mogą zdobyć łup słaby lub wrócić z niczym
                if (Math.random() * 100 < (75 * lootChanceModifier)) { // Mają dużą szansę na słaby łup, ale...
                    lootResult = location.loot.bad(gameState);
                } else {
                    lootResult = location.loot.nothing(gameState); // ...jest ryzyko powrotu z niczym
                }
                break;
        }

        report.body = `${dweller.name} powrócił bezpiecznie z misji do ${location.name}.<br><br><strong class='good'>ZDOBYCZ:</strong> ${lootResult.desc}`;
    } else {
        report.body = `<strong class='bad'>${dweller.name} nie wrócił z misji. Poniósł śmierć na Pustkowiach.</strong> Straciliśmy dobrego mieszkańca. (Szansa na powrót: ${finalSurvivalChance}%)`;
        gameState.dwellers = gameState.dwellers.filter(d => d.id !== dweller.id);
        gameState.resources.population--;
        gameState.resources.morale -= 10;
        
        if (gameState.flags.hasDeathclawGuardian) {
            report.body += "<br><br><strong class='bad'>PORAŻKA MISJI ROZWŚCIECZYŁA STRAŻNIKA! Szpon Śmierci wpadł w szał, zabijając 2 dodatkowych mieszkańców przy włazie!</strong>";
            gameState.resources.population -= 2;
            if (gameState.dwellers.length > 2) gameState.dwellers.splice(0, 2);
            gameState.resources.morale -= 25;
        }
    }

    gameState.expedition = { active: false, dwellerId: null, locationName: null, returnDay: null };
    return report;
}


function confirmExpedition(location) {
    const availableDwellers = gameState.dwellers.filter(d => d.status === 'idle' && !d.isBrother);
    if (availableDwellers.length === 0) {
        showModal("Brak dostępnych mieszkańców", "<p>Wszyscy zdolni do pracy mieszkańcy (poza Twoim bratem) są obecnie zajęci lub ranni.</p>", [{ text: "OK", callback: closeModal }]);
        return;
    }
    
    let hazmatWarning = "";
    if (location.hazmatRequired) {
        if (gameState.resources.hazmatSuits > 0) {
            hazmatWarning = `<p style="color: var(--red-color);">UWAGA: Ta misja wymaga skafandra ochronnego! (Zostanie zużyty 1 z ${gameState.resources.hazmatSuits} posiadanych).</p>`;
        } else {
            hazmatWarning = `<p style="color: var(--red-color);">BŁĄD: Ta misja wymaga skafandra ochronnego! Nie posiadasz żadnego.</p>`;
        }
    }

    // ZMIANA: Wyświetlamy teraz przedział czasowy
    const durationText = `ok. ${location.duration[0]}-${location.duration[1]} dni`;

    let body = `
        <p>Wysyłasz ekspedycję do: <strong>${location.name}</strong></p>
        <p>Ryzyko: ${location.risk}, Czas trwania: ${durationText}</p>
        ${hazmatWarning}
        <p>Wybierz zwiadowcę. Wyższy Poziom Przetrwania zwiększa szanse na sukces.</p>
        <select id="dweller-select" style="width: 100%;">
            ${availableDwellers
                .sort((a, b) => b.survivalLevel - a.survivalLevel)
                .map(d => `<option value="${d.id}">${d.name} (Poziom Przetrwania: ${d.survivalLevel})</option>`).join('')}
        </select>
    `;

    const canSend = !(location.hazmatRequired && gameState.resources.hazmatSuits <= 0);

    const buttons = [
        { text: "Wyślij", callback: () => sendExpedition(location, document.getElementById('dweller-select').value), disabled: !canSend },
        { text: "Anuluj", callback: closeModal }
    ];
    showModal("Potwierdzenie Ekspedycji", body, buttons);
}

function sendExpedition(location, dwellerId) {
    if (location.hazmatRequired) {
        gameState.resources.hazmatSuits--;
    }

    const dweller = gameState.dwellers.find(d => d.id == dwellerId);
    dweller.status = 'on_expedition';

    // === NOWA LOGIKA CZASU TRWANIA ZALEŻNA OD POZIOMU ===
    const durationModifier = location.durationModifier || 1.0;
    const minDuration = Math.round(location.duration[0] * durationModifier);
    const maxDuration = Math.round(location.duration[1] * durationModifier);
    let missionDuration;

    switch (dweller.survivalLevel) {
        case 5:
        case 4:
            // Najlepsi wracają najszybciej
            missionDuration = minDuration;
            break;
        case 1:
            // Najsłabsi wracają najpóźniej
            missionDuration = maxDuration;
            break;
        case 3:
        case 2:
        default:
            // Średniacy wracają w losowym czasie
            missionDuration = Math.floor(Math.random() * (maxDuration - minDuration + 1)) + minDuration;
            break;
    }
    
    gameState.expedition.active = true;
    gameState.expedition.dwellerId = parseInt(dwellerId);
    gameState.expedition.locationName = location.name;
    gameState.expedition.returnDay = gameState.day + missionDuration;

    addLog(`${dweller.name} wyruszył na ekspedycję do ${location.name}. Przewidywany powrót za ${missionDuration} dni.`, 'info');
    Sound.play('confirm');
    closeModal();
    renderTabContent('ekspedycje');
    updateUI();
    saveGame();
}

function startTrade(post) {
    const priceModifier = gameState.player.characterClass === 'Dyplomata' ? 0.85 : 1;
    
    let body = `<p>Handlujesz z ${post.name}.</p>
                <div class="trade-grid">
                    <div class="trade-section" id="trade-buy"><h4>Kupujesz (Ich towary)</h4></div>
                    <div class="trade-section" id="trade-sell"><h4>Sprzedajesz (Czego potrzebują)</h4></div>
                </div>`;
    
    const buttons = [{ text: "Zakończ handel", callback: closeModal }];
    showModal(`Handel z ${post.name}`, body, buttons);

    const buyContainer = document.getElementById('trade-buy');
    const sellContainer = document.getElementById('trade-sell');
    
    // Wypełnianie sekcji "Kupujesz"
    post.wares.forEach(item => {
        const currentPrice = Math.round(item.price * priceModifier);
        const canAfford = gameState.resources.caps >= currentPrice;
        const itemDiv = document.createElement('div');
        itemDiv.className = 'trade-item';
        itemDiv.innerHTML = `<span>${item.name} (${currentPrice} kapsli)</span>`;
        const buyButton = document.createElement('button');
        buyButton.textContent = 'Kup';
        buyButton.disabled = !canAfford;
        buyButton.onclick = () => {
            if (gameState.resources.caps >= currentPrice) {
                gameState.resources.caps -= currentPrice;
                if (item.type === 'weapon') gameState.resources.weapons[item.key]++;
                else gameState.resources[item.key] += item.amount;
                addLog(`Kupiono ${item.name} od ${post.name} za ${currentPrice} kapsli.`, 'good');
                closeModal(); updateUI();
            }
        };
        itemDiv.appendChild(buyButton);
        buyContainer.appendChild(itemDiv);
    });

    // Wypełnianie sekcji "Sprzedajesz"
    post.willBuy.forEach(item => {
        const canSell = gameState.resources[item.key] >= item.amount;
        const sellPrice = Math.round(item.price / priceModifier); // Dyplomata dostaje lepsze ceny
        const itemDiv = document.createElement('div');
        itemDiv.className = 'trade-item';
        itemDiv.innerHTML = `<span>${item.name} (+${sellPrice} kapsli)</span>`;
        const sellButton = document.createElement('button');
        sellButton.textContent = 'Sprzedaj';
        sellButton.disabled = !canSell;
        sellButton.onclick = () => {
            if (gameState.resources[item.key] >= item.amount) {
                gameState.resources[item.key] -= item.amount;
                gameState.resources.caps += sellPrice;
                addLog(`Sprzedano ${item.name} za ${sellPrice} kapsli.`, 'good');
                closeModal(); updateUI();
            }
        };
        itemDiv.appendChild(sellButton);
        sellContainer.appendChild(itemDiv);
    });
}

function planAttack(post) {
    let attackPower = calculateAttackPower();
    // Bonusy są teraz dodawane tutaj, by gracz widział swoją realną siłę
    if (gameState.player.characterClass === 'Siłacz') attackPower *= 1.3;
    if (gameState.flags.hasDeathclawGuardian) attackPower *= 1.5;
    attackPower = Math.round(attackPower);
    
    // Obliczanie szansy na sukces, aby pokazać ją graczowi
    const successChance = Math.max(10, Math.min(95, Math.round((attackPower / post.defense) * 100)));

    let body = `<h3>Planowanie ataku na ${post.name}</h3>
                <p>To ryzykowna operacja. Zwycięstwo przyniesie cenne zapasy, ale porażka będzie kosztowna.</p>
                <p>Twoja siła ataku: <strong style="color: #8effa8;">${attackPower}</strong>. Siła obrony przeciwnika: <strong style="color: var(--red-color);">${post.defense}</strong>.</p>
                <p class="event-desc">Szacowana szansa na sukces: <strong>${successChance}%</strong></p>`;
    
    let buttons = [
        { text: "Rozpocznij Atak", callback: () => executeAttack(post, successChance) },
        { text: "Anuluj", callback: closeModal }
    ];

    if (post.id === 2) { // Specjalna opcja dla Karmazynowej Karawany
         body += `<p style="color: var(--red-color); font-size: 16px;">Możesz też spróbować ich po prostu zabić z zaskoczenia, ale to brutalny akt, który wstrząśnie Kryptą.</p>`;
         buttons.unshift({ text: "Zabij Handlarza", callback: () => {
             gameState.resources.morale -= 30;
             gameState.flags.murdersCommitted++;
             addLog("Wydałeś rozkaz egzekucji. To był brutalny mord.", 'bad');
             executeAttack(post, successChance * 1.5); // Bonus do szans za zaskoczenie
         }, disabled: !(gameState.player.characterClass === 'Siłacz' || (calculateAttackPower() > 0)) });
    }

    showModal("Plan Ataku", body, buttons);
}

// POPRAWIONA FUNKCJA ATAKU
function executeAttack(post, chance) {
    closeModal(); // Zamknij okno planowania od razu po kliknięciu
    const roll = Math.random() * 100;
    const success = roll < chance;
    let result;

    gameState.flags.traderKilled[post.id] = true;

    if (success) {
        result = post.loot.success(gameState);
        addLog(result.desc, 'good');
    } else {
        if (gameState.flags.hasDeathclawGuardian) {
            setTimeout(() => {
                showModal("Szał Strażnika!", "<p class='event-desc'>Atak się nie powiódł! Twój Strażnik wpada w szał i rzuca się na najbliższych mieszkańców, rozszarpując ich na strzępy.</p>",
                    [{ text: "Boże... co ja zrobiłem...", callback: () => {
                        gameState.resources.population -= 3;
                        if (gameState.dwellers.length > 3) gameState.dwellers.splice(0, 3);
                        gameState.resources.morale -= 35;
                        addLog("Porażka w ataku doprowadziła Strażnika do szału. Zginęło 3 mieszkańców.", 'bad');
                        updateUI();
                        renderTabContent('komunikator');
                        saveGame();
                        closeModal();
                    }}]
                );
            }, 500);
            return;
        } else {
            result = post.loot.failure(gameState);
            addLog(result.desc, 'bad');
        }
    }

    setTimeout(() => {
        showModal("Wynik Ataku", `<p>${result.desc}</p>`, [{text: "Kontynuuj", callback: () => {
            renderTabContent('komunikator');
            closeModal();
        }}]);
    }, 500);
    
    updateUI();
    saveGame();
}
// ===================================================================
// ================ OSTATECZNA LOGIKA ZAKOŃCZEŃ GRY ==================
// ===================================================================
// NOWA, POPRAWNA WERSJA - ZASTĄP CAŁĄ FUNKCJĘ
function checkEndGameConditions() {
    let ending = null;

    // KROK 1: Sprawdzamy ZAKOŃCZENIA FABULARNE, które mają absolutny priorytet
    if (gameState.flags.becameGhoul) {
        ending = ENDINGS.Pustelnik;
    } else if (gameState.day > 60) {
        const isAnyTraderKilled = Object.values(gameState.flags.traderKilled).some(killed => killed === true);

        if (gameState.flags.overseerKilled && gameState.flags.brotherSilenced) {
            if (gameState.resources.morale < 50 && isAnyTraderKilled) {
                ending = ENDINGS.Tyran;
            } else {
                ending = ENDINGS.KrwawyNadzorca;
            }
        } else if (!gameState.flags.overseerKilled) {
            ending = ENDINGS.LojalnyZastepca;
        } else {
            ending = ENDINGS.Przetrwanie; // Domyślne, jeśli np. tylko Nadzorca zginął
        }
    } else if (gameState.flags.brotherKnows && !gameState.flags.brotherSilenced) {
        ending = ENDINGS.Zdrada;
    }
    
    // Jeśli zakończenie fabularne zostało już ustalone, zwracamy je natychmiast
    if (ending) { 
        showEnding(ending); 
        return true; 
    }

    // KROK 2: Dopiero teraz sprawdzamy porażki wynikające ze stanu zasobów
    if (gameState.resources.morale <= 0) {
        ending = ENDINGS.Upadek;
    } else if (gameState.resources.population <= 13) {
        ending = ENDINGS.Wygnaniec;
    } else if (gameState.resources.food <= 0 && gameState.resources.water <= 0) {
        ending = ENDINGS.Glod;
    }

    for (const machineName in gameState.machines) {
        if (gameState.machines[machineName].wydajnosc <= 0) {
            ending = ENDINGS.AwariaSystemu;
            break;
        }
    }
    
    if (ending) { 
        showEnding(ending); 
        return true; 
    }
    return false;
}

function showEnding(endingData) {
    DOM.nextDayBtn.disabled = true;
    localStorage.removeItem(`vault62_save_${gameState.player.name}`);
    localStorage.setItem(`vault62_epilogue_${gameState.player.name}`, JSON.stringify(endingData));
    
    showScreen('ending-screen');
    DOM.modalOverlay.classList.add('hidden');
    
    const endingTextElement = DOM.endingText;
    endingTextElement.textContent = endingData.isPositive ? "PRZETRWAŁEŚ" : "PRZEGRAŁEŚ";
    if (!endingData.isPositive) endingTextElement.classList.add('glitch-text');
    
    // --- ODTWARZANIE DŹWIĘKU ZAKOŃCZENIA ---
    if (endingData.isPositive) {
        Sound.play('victory');
    } else {
        Sound.play('failure');
    }
    // --- KONIEC ---
    
    DOM.restartBtn.style.display = "none"; 
    
    setTimeout(() => {
        const buttons = [{ 
            text: "ZAGRAJ PONOWNIE", 
            callback: () => window.location.reload() 
        }];
        showModal(endingData.title, `<p style="font-size: 20px; text-align: left;">${endingData.description}</p>`, buttons);
    }, 2500);
}
// <<-- DODAJ CAŁĄ TĘ NOWĄ FUNKCJĘ -->>

function showDiplomatBrotherConfrontation() {
    closeModal();
    
    const body = `<p class="event-desc">"Widzę, że wszystko przemyślałeś," mówisz spokojnie. "Ale jest coś, o czym nie wiesz. Kopiując klucz z twojego Pip-Boya, zostawiłem ślad... na twoim urządzeniu. Wrobienie cię w zdradę będzie dziecinnie proste."</p><p>Jego twarz blednie. Teraz to ty masz go w garści. Co zrobisz?</p>`;
    
    const buttons = [
        {
            text: "Zaszantażuj go. Niech żyje w strachu.",
            effect: gs => {
                gs.flags.brotherSilenced = true;
                gs.flags.brotherBlackmailed = true;
                gs.resources.morale -= 10;
                return "Zgadza się. Zostawiasz go przy życiu, ale jego wola jest złamana. Jest teraz twoją marionetką. Tajemnica jest bezpieczna.";
            }
        },
        {
            text: "Zabij go i zrzuć na niego winę.",
            effect: gs => {
                gs.flags.brotherSilenced = true;
                gs.flags.brotherKilledByPlayer = true;
                gs.flags.brotherFramed = true;
                gs.resources.population--;
                gs.dwellers = gs.dwellers.filter(d => !d.isBrother);
                gs.resources.morale -= 20;
                gs.flags.murdersCommitted++;
                return "To było chłodne i wykalkulowane. Pozbyłeś się go i masz idealną historię. Nikt nie będzie za nim tęsknił.";
            }
        }
    ];

    setTimeout(() => {
        // Używamy zwykłego modala, bo nie ma już losowości
        showModal("Wybór Dyplomaty", body, buttons.map(btn => ({
            text: btn.text,
            callback: () => {
                const outcomeMessage = btn.effect(gameState);
                if (outcomeMessage) dailyReport.push(outcomeMessage);
updateUI();
closeModal();
if (typeof finalizeDay === "function") finalizeDay();
            }
        })));
    }, 500);
}
// #############################################################################
// #######   PEŁNA BAZA DANYCH GRY - ZADANIA, ZDARZENIA, LOKACJE     #######
// #############################################################################

let CHARACTER_CLASSES, MAIN_STORY_EVENTS, RANDOM_VAULT_EVENTS, RANDOM_DOOR_EVENTS, CLASS_SPECIFIC_EVENTS, EXPEDITION_LOCATIONS, TRADING_POSTS, ENDINGS;


function generateGameData() {
    CHARACTER_CLASSES = {
    'Siłacz': { description: "Ataki mają +30% do siły. Opcje siłowe w dialogach są skuteczniejsze." },
    'Naukowiec': { description: "Naprawy maszyn są o 25% skuteczniejsze. Dostęp do opcji analitycznych." },
    'Dyplomata': { description: "Lepsze ceny w handlu o 15% i większe szanse na pokojowe rozwiązania." }
};

    
    MAIN_STORY_EVENTS = {
45: {
    id: 'main_45',
    title: "Krytyczny Skok Napięcia",
    condition: gs => gs.flags.expeditionsEnabled && gs.flags.communicatorEnabled,
    image: "vault_boy.jpg",
    introduction: "Główny generator zaiskrzył i zgasł, pogrążając Kryptę w chwilowej ciemności. Moc wróciła, ale uszkodzenia są poważne.",
    description: "Twój brat Adam wpada do biura z raportem. 'Szefie, zła wiadomość. Skok napięcia usmażył delikatne układy w dwóch kluczowych systemach. Mamy tylko jeden zestaw do precyzyjnej naprawy. Musimy wybrać, co ratujemy. Ten drugi system będzie bezużyteczny. To ostateczna decyzja.'<br><br><strong style='color: var(--red-color);'>Wybierz system, który chcesz ocalić. Drugi zostanie bezpowrotnie zniszczony.</strong>",
    options: [
        {
            text: "Uratuj KOMUNIKATOR (Tracimy mapy do ekspedycji)",
            effect: gs => {
                gs.flags.communicatorEnabled = true;
                gs.flags.expeditionsEnabled = false;
                return "Technicy skupili się na ratowaniu modułu komunikacji. Komunikator działa, ale delikatne mapy w Pip-Boyu zostały bezpowrotnie utracone. System ekspedycji jest niedostępny na stałe.";
            }
        },
        {
            text: "Uratuj system EKSPEDYCJI (Tracimy komunikator)",
            effect: gs => {
                gs.flags.expeditionsEnabled = true;
                gs.flags.communicatorEnabled = false;
                return "Skupiłeś zasoby na naprawie modułu mapowania. System ekspedycji został ocalony, ale konsola komunikacyjna zamilkła na zawsze. Komunikator jest niedostępny na stałe.";
            }
        }
    ]
},
        12: {
            id: 'main_12',
            title:"Znalezisko w Biurze Nadzorcy",
            image: "vault_boy.jpg",
            introduction:"Podczas przeglądania rzeczy Nadzorcy w poszukiwaniu czegokolwiek użytecznego, jeden z Twoich ludzi natrafia na jego osobistego Pip-Boya, schowanego w sejfie ściennym. Urządzenie jest rozładowane, ale wygląda na nienaruszone.",
            description:"Inżynierowie twierdzą, że mogą go naładować, przekierowując energię z głównych systemów. To chwilowo osłabi Kryptę, ale da nam dostęp do zaawansowanych funkcji Pip-Boya, w tym map okolicy. Przy okazji otworzy to pobliską szafkę ze sprzętem ochronnym.",
            options:[
                {text:"Zaryzykuj. Zasil Pip-Boya.", cost:{power:30}, effect:gs=>{gs.flags.expeditionsEnabled=true; gs.resources.hazmatSuits += 3; gs.resources.power-= 30; return "Pip-Boy rozbłysnął zielonym światłem. Mamy dostęp do map! System ekspedycji jest aktywny. Dodatkowo, otworzyła się szafka z 3 skafandrami ochronnymi!"}},
                {text:"Nie warto ryzykować. Zostaw to.", effect:gs=>{return "Decydujesz, że energia (akumulator) jest zbyt cenna. Pip-Boy i szafka pozostają zamknięte, a świat na zewnątrz nieznany."}}
            ]
        },
        20: {
            id: 'main_20',
            title:"Zamknięta Szuflada",
            introduction:"W biurku Nadzorcy znajduje się jedna, solidnie zamknięta szuflada. Wygląda na wzmocnioną i nie pasuje do reszty mebla. Próby otwarcia jej standardowym kluczem spełzły na niczym.",
            description:"Co może być w środku? Prywatne zapasy? Broń? A może coś, co mogłoby zagrozić Twojej pozycji? Możesz spróbować otworzyć ją siłą lub bardziej finezyjnie.",
            options:[
                {text:"Użyj trochę zasobów, by ją otworzyć (-15 złomu).", cost:{scrap:15}, effect:gs=>{gs.flags.communicatorEnabled=true; gs.resources.scrap-= 15; return "Poświęcenie kilku kapsli na narzędzia opłaciło się. Szuflada otwarta, a w środku karta dostępu do komunikatora!"}},
                {text:"Zostaw to. Nie warto ryzykować.", effect:gs=>{return "Decydujesz nie ruszać szuflady. Cokolwiek jest w środku, pozostanie tajemnicą."}},
                {text:"[SIŁACZ] Wyważ ją siłą.", isClassSpecific: true, classCheck:'Siłacz', effect:gs=>{gs.flags.communicatorEnabled=true; return "Twoja siła była wystarczająca. Zamek puścił z trzaskiem. W środku znajdujesz kartę dostępu do głównego terminala komunikacyjnego! Możemy nawiązać kontakt z innymi."}},
            ]
        },
        40: {
            id: 'main_40',
            title:"Otwarcie Zbrojowni",
            introduction:"Twój brat, Adam, wpada do biura z triumfalnym uśmiechem. 'Pamiętasz te zacięte drzwi do zbrojowni, uszkodzone podczas ataku? Udało mi się obejść zamek! Mamy dostęp do całego arsenału!'",
            description:"Wewnątrz znajdujecie dwa dobrze zachowane karabiny bojowe. To znacznie zwiększy naszą siłę ognia i otworzy nowe możliwości w kontaktach z zewnętrznym światem.",
            options:[
                {text:"Doskonała robota, Adamie!", effect:gs=>{gs.resources.weapons.rifle+=2; return "Dwa karabiny zostały dodane do magazynu. Krypta jest teraz o wiele bezpieczniejsza... lub groźniejsza."}}
            ]
        },
        50: {
    id: 'main_50',
    title:"Ciężar Korony", 
    introduction:"Medyk przynosi raport: stan Nadzorcy gwałtownie się poprawia. Odzyska przytomność w ciągu kilku dni. W tym samym czasie w kantynie słyszysz szepty. 'Za starego Nadzorcy było lepiej... Ten nowy jest słaby'.", 
    description:"Patrzysz na nieprzytomnego człowieka w łóżku. Wiesz, że gdy się obudzi, twoja władza przepadnie. Ludzie cię nie poprą. Całe to piekło, które rozpętałeś - śmierć ośmiu osób - pójdzie na marne. Czy twoja ambicja jest warta jeszcze jednego trupa, by to wszystko miało sens?", 
    options:[
        {
            text:"Tak. Moja ambicja jest tego warta. (Udusisz go)", 
            effect:gs=>{
                gs.flags.overseerKilled=true;  
                gs.resources.food+=5; 
                gs.resources.caps+=10; 
                gs.flags.murdersCommitted++;
                return "<strong class='good'>ZDOBYCZ: 5 żywności, 10 kapsli.</strong> Zrobiłeś to. Strach przed porażką okazał się silniejszy niż sumienie. Jesteś teraz jedynym władcą Krypty. Na zawsze.";
            }
        },
        {
            text:"Nie. Ludzie mają rację. To był błąd. (Pozwolisz mu żyć)", 
            effect:gs=>{
                showEnding(ENDINGS.LojalnyZastepca);
                return "Odwracasz się od jego łóżka. Nie jesteś mordercą. Jesteś po prostu słabym liderem, który przegrał...";
            }
        }
    ]
},
        60: {
            id: 'main_60',
            title:"Ostateczna Konfrontacja", 
    condition: gs => !gs.flags.brotherSilenced,
    introduction:"Twój brat, Adam, wpada do biura Nadzorcy. Jest blady, a w ręku trzyma starego, zabrudzonego Pip-Boya... swojego Pip-Boya.",
    description:`"Znalazłem go... w szybie wentylacyjnym, tam gdzie go upuściłeś. Pamięć podręczna wciąż działała. To logi z dnia ataku. Pokazują, że ktoś użył mojego klucza, by otworzyć właz bandytom... To byłeś ty, prawda? To wszystko twoja wina! Idę powiedzieć wszystkim!"`,
    options:[
        {
            text:"Przyznaj się do wszystkiego. Niech się dzieje wola Krypty.", 
            effect:gs=>{
                gs.flags.brotherKnows=true; 
                return "Przyznajesz się. Widzisz w jego oczach tylko pogardę. Odwraca się i odchodzi. Wiesz, co zaraz zrobi. Powie wszystkim."
            }
        },
        {
            text:"[SIŁACZ] Udusz go i wrob w zdradę.", 
            isClassSpecific: true, 
            classCheck:'Siłacz', 
            effect:gs=>{
                gs.flags.brotherSilenced=true; 
                gs.flags.brotherKilledByPlayer = true;
                gs.flags.brotherFramed = true;
                gs.resources.population--; 
                gs.dwellers = gs.dwellers.filter(d => !d.isBrother); 
                gs.resources.morale-=25;
                gs.flags.murdersCommitted++;
                return "W krótkiej, brutalnej walce uciszyłeś go. Ciało ukryjesz później. Powiesz wszystkim, że to on był zdrajcą i zaatakował cię, gdy go zdemaskowałeś. To była samoobrona.";
            }
        },
        {
            text:"[SIŁACZ] Zagwiżdż na swojego 'pupila'.",
            isClassSpecific: true,
            classCheck: 'Siłacz',
            condition: gs => gs.flags.hasDeathclawGuardian, // Opcja widoczna tylko z potworem
            effect: gs => {
                gs.flags.brotherSilenced = true;
                gs.flags.brotherKilledByDeathclaw = true;
                gs.resources.population--;
                gs.dwellers = gs.dwellers.filter(d => !d.isBrother);
                return "Wystarczył jeden gwizd. Bestia wpadła do pokoju i rozszarpała Adama na strzępy. Z przerażeniem w oczach powiesz wszystkim, że to był tragiczny wypadek. Koszt trzymania takiego strażnika...";
            }
        },
        {
            text:"[NAUKOWIEC] Otruj go i sfinguj zawał serca.",
            isClassSpecific: true,
            classCheck: 'Naukowiec',
            effect: gs => {
                gs.flags.brotherSilenced = true;
                gs.flags.brotherKilledByPlayer = true;
                gs.resources.population--;
                gs.dwellers = gs.dwellers.filter(d => !d.isBrother);
                gs.resources.morale -= 15;
                gs.flags.murdersCommitted++;
                return "Udało ci się go uspokoić. Podałeś mu kawę z bezbarwną, bezwonną toksyną z twojego amuletu. Po chwili upadł, łapiąc się za serce. Zgłosisz to jako tragiczny zawał serca. Nikt nic nie będzie podejrzewał.";
            }
        },
        {
            text:"[DYPLOMATA] Czas na mały monolog...", 
            isClassSpecific: true, 
            classCheck:'Dyplomata', 
            effect: gs => {
                showDiplomatBrotherConfrontation();
                return "";
            }
        }
    ]
}}
    };

    const ALL_RANDOM_EVENTS = [
    {
        id: 'rand_v_1', type: 'vault', title:"Przeciek w Sekcji Gamma", introduction:"Główny inżynier melduje o pęknięciu magistrali wodnej.", description:"Tracimy cenne zasoby!",
        options:[
            {text:"Wyślij profesjonalną ekipę", cost:{caps:15}, effect:gs=>{gs.resources.water-=5; return "Ekipa załatała rurę. Strata wody była minimalna."}},
            {text:"Poczekaj, aż ciśnienie samo spadnie.", effect:gs=>{gs.resources.water-=15; gs.resources.morale-=4; return "Czekanie trochę pomogło, ale i tak straciliście sporo wody, a bierność zirytowała techników."}},
            {text:"[NAUKOWIEC] Zoptymalizuj naprawę.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.water-=2; return "Twoje instrukcje były genialne. Prawie nie straciliśmy wody."}, failureEffect:gs=>{gs.resources.water-=30; gs.machines.waterPurifier.wydajnosc-=15; return "Twój pomysł spowodował skok ciśnienia. Straciliśmy mnóstwo wody i uszkodziliśmy pompę."}}
        ]
    },
    {
        id: 'rand_v_2', type: 'vault', title:"Zepsuty Filtr Powietrza", introduction:"W kwaterach jakość powietrza gwałtownie spadła. Ludzie kaszlą.", description:"Filtr w systemie wentylacji uległ awarii.",
        options:[
            {text:"Wymień filtr na nowy", cost:{caps:20}, effect:gs=>{gs.resources.morale+=5; return "Nowy filtr działa idealnie. Powietrze jest czyste, a morale lekko wzrosło."}},
            {text:"Zignoruj to na razie.", effect:gs=>{gs.resources.morale-=8; return "Ludzie są rozdrażnieni i chorzy z powodu złego powietrza. Twoja bierność jest odbierana jako arogancja."}},
            {text:"[NAUKOWIEC] Spróbuj przeczyścić stary filtr.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=3; return "Twoja wiedza techniczna pomogła! Filtr jest niemal jak nowy, a zaoszczędziłeś kapsle."}, failureEffect:gs=>{gs.resources.morale-=5; gs.machines.powerGenerator.wydajnosc-=10; return "Próba czyszczenia uszkodziła obudowę, powodując zwarcie w systemie wentylacji. Uszkodziło to generator."}}
        ]
    },
    {
        id: 'rand_v_3', type: 'vault', title:"Karciane Oszustwo", introduction:"W kantynie wybuchła bójka o kapsle. Sytuacja jest napięta.", description:"Musisz rozwiązać spór, zanim poleje się krew.",
        options:[
            {text:"Zrekompensuj straty obu stronom", cost:{caps:20}, effect:gs=>{gs.resources.morale+=5; return "Twoja hojność załagodziła spór. Obaj gracze czują się wysłuchani."}},
            {text:"Zignoruj to. Niech sami to załatwią.", effect:gs=>{gs.resources.morale-=5; return "Twoja bierność doprowadziła do eskalacji. Pobili się porządnie, ale w końcu się dogadali. Morale trochę spadło, ale nikt nie zginął."}},
            {text:"[DYPLOMATA] Uspokój ich rozmową.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=15; return "<strong class='good'>ZDOBYCZ: 15 kapsli.</strong> Nie tylko ich pogodziłeś, ale przekonałeś, by oddali część kapsli 'na cele społeczne'. Trafiły do ciebie.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Twoje przemowy tylko ich bardziej rozzłościły. Pobili nie tylko siebie, ale i postronnego świadka."}}
        ]
    },
    {
        id: 'rand_v_4', type: 'vault', title:"Plaga Rad-karaluchów", introduction:"Z kanałów wylęgła się plaga Rad-karaluchów.", description:"Musimy się ich pozbyć, zanim opanują Kryptę.",
        options:[
            {text:"Użyj profesjonalnych środków chemicznych", cost:{caps:15}, effect:gs=>{gs.resources.food-=5; return "Środki chemiczne zadziałały, ale skaziły część zapasów żywności."}},
            {text:"Zabarykadujcie kanały i poczekajcie.", effect:gs=>{gs.resources.food-=25; gs.resources.morale-=5; return "Karaluchy znalazły inną drogę - przez spiżarnię. Zanim je wytępiliście, zjadły mnóstwo jedzenia."}},
            {text:"[SIŁACZ] Sam zapoluj na największe gniazdo.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.food+=10; gs.resources.morale+=5; return "<strong class='good'>ZDOBYCZ: 10 żywności.</strong> To nie było polowanie, to była egzekucja. Mięso karaluchów to czyste białko.";}, failureEffect:gs=>{gs.resources.stimpaks-=1; gs.resources.morale-=3; return "Gniazdo było większe niż myślałeś. Wróciłeś ranny i musiałeś zużyć stimpaka.";}}
        ]
    },
    {
        id: 'rand_v_5', type: 'vault', title: "Tajemniczy Grzyb", introduction: "W hydroponice rośnie dziwny, pulsujący grzyb.", description: "Nikt nie wie, co to jest. To może być jedzenie albo trucizna.",
        options: [
            { text: "Zleć pełną analizę medyczną", cost:{caps:15}, effect: gs => { gs.resources.food += 50; return "<strong class='good'>ZDOBYCZ: 50 żywności.</strong> Analiza wykazała, że grzyb jest jadalny i pożywny!" } },
            { text: "Spalcie to natychmiast. Bez dyskusji.", effect: gs => { gs.resources.morale -= 5; return "Zniszczyłeś potencjalne źródło pożywienia bez sprawdzenia. Ludzie szepczą o twojej paranoi."; } },
            { text: "[NAUKOWIEC] Zbadaj jego właściwości osobiście.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect: gs => { gs.resources.stimpaks += 1; return "<strong class='good'>ZDOBYCZ: 1 Stimpaki.</strong> Odkryłeś, że grzyb ma właściwości regeneracyjne!"; }, failureEffect: gs => { gs.machines.hydroponics.wydajnosc -= 20; return "Podczas analizy grzyb eksplodował chmurą żrących zarodników, poważnie uszkadzając sprzęt."; } }
        ]
    },
    {
        id: 'rand_v_6', type: 'vault', title: "Pan Złota Rączka wariuje", introduction: "Robot sprzątający 'Pan Złota Rączka' zaczął 'polerować' mieszkańców.", description: "Jego mechaniczne ramiona machają na wszystkie strony. Trzeba go powstrzymać.",
        options: [
            {text:"Wezwij technika do reprogramacji", cost:{caps:20}, effect:gs=>{gs.resources.morale+=5; return "Technik naprawił robota. Pan Złota Rączka wrócił do swoich obowiązków."}},
            {text:"Wyłączcie go i schowajcie w magazynie.", effect:gs=>{gs.resources.morale-=5; gs.resources.scrap-=5; return "Straciliśmy pomocnika w utrzymaniu czystości, a na dodatek ktoś ukradł z niego kilka części, zanim trafił do magazynu."}},
            {text:"[SIŁACZ] 'Przekonaj' go kluczem francuskim.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=10; return "<strong class='good'>ZDOBYCZ: 10 złomu.</strong> Kilka celnych uderzeń nie tylko go naprawiło, ale i poluzowało kilka cennych części, które zabrałeś.";}, failureEffect:gs=>{gs.resources.power-=20; return "Robot zinterpretował twoje działania jako atak i uderzył w skrzynkę z bezpiecznikami, powodując spadek mocy.";}}
        ]
    },
    {
        id: 'rand_v_7', type: 'vault', title: "Kradzież wody", introduction: "Ktoś ukradł zapasy wody. Wśród mieszkańców narasta panika.", description: "Musisz znaleźć winnego i zapobiec dalszym kradzieżom.",
        options:[
            {text:"Zainstaluj zamki w magazynie", cost:{scrap:20}, effect:gs=>{gs.resources.water-=20; gs.resources.morale+=3; return "Woda przepadła, ale nowe zamki zabezpieczyły resztę zapasów. Mieszkańcy czują się bezpieczniej.";}},
            {text:"Wprowadź racjonowanie i zignoruj kradzież.", effect:gs=>{gs.resources.water-=20; gs.resources.morale-=8; return "Woda przepadła, a wprowadzone przez ciebie restrykcje i brak działania w sprawie złodzieja obniżyły morale i zaufanie do ciebie.";}},
            {text:"[DYPLOMATA] Porozmawiaj z ludźmi i przeprowadź śledztwo.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.water-=10; gs.resources.morale+=5; return "Twoje przemówienie uspokoiło ludzi, a twoje śledztwo ujawniło złodzieja. Odzyskano połowę wody.";}, failureEffect:gs=>{gs.resources.water-=20; gs.resources.morale-=10; return "Twoje śledztwo spaliło na panewce. Oskarżyłeś niewinną osobę, co doprowadziło do zamieszek.";}}
        ]
    },
    {
        id: 'rand_v_8', type: 'vault', title: "Noc filmowa", introduction: "Mieszkaniec znalazł stary projektor i proponuje wieczór filmowy.", description: "To może podnieść morale, ale wymaga dodatkowej energii.",
        options: [
            { text: "Zgódź się. Potrzebujemy tego", cost: { power: 20 }, effect: gs => { gs.resources.morale += 10; return "Wieczór filmowy był wielkim sukcesem! Mieszkańcy dawno nie byli tak zrelaksowani."; } },
            { text: "Odmów. Energia jest zbyt cenna.", effect: gs => { gs.resources.morale -= 7; return "Twoja decyzja spotkała się z ogromnym rozczarowaniem. Mieszkańcy są przygnębieni monotonią życia."; } },
            { text: "[NAUKOWIEC] Zmodyfikuj projektor.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect: gs => { gs.resources.power -= 5; gs.resources.morale += 12; return "Twoja modyfikacja zadziałała! Seans zużył minimalną ilość energii i był hitem."; }, failureEffect: gs => { gs.resources.power -= 20; gs.resources.morale -= 5; return "Próba modyfikacji spaliła projektor. Nie było seansu, a energia i morale przepadły."; } }
        ]
    },
    {
        id: 'rand_v_9', type: 'vault', title: "Plaga kretoszczurów", introduction: "Z nieużywanych tuneli zaczęły wychodzić kretoszczury.", description: "Są agresywne i mogą przenosić choroby. Trzeba działać szybko.",
        options: [
            {text:"Zastaw profesjonalne pułapki", cost:{scrap:15}, effect:gs=>{gs.resources.food-=10; return "Pułapki zadziałały, ale zanim wyłapały wszystkie szczury, te zdążyły ukraść trochę jedzenia."}},
            {text:"Zabarykadujcie tunele i poczekajcie.", effect:gs=>{gs.resources.power-=15; return "Kretoszczury, odcięte od tuneli, przegryzły się do kabli energetycznych w ścianach, powodując spadek mocy.";}},
            {text:"[SIŁACZ] Sam zapoluj na ich królową.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.food+=10; gs.resources.morale+=7; return "<strong class='good'>ZDOBYCZ: 10 żywności.</strong> W pojedynkę odnalazłeś i zabiłeś królową. Jesteś bohaterem, a mięso zasili spiżarnię.";}, failureEffect:gs=>{gs.resources.stimpaks-=1; return "Królowa była potężna. Zabiłeś ją, ale odniosłeś poważne rany i musiałeś użyć Stimpaka.";}}
        ]
    },
    {
        id: 'rand_v_10', type: 'vault', title: "Dziecięca 'zabawa'", introduction: "Dzieci pomalowały ściany hasłami typu 'Nadzorca to zgred'.", description: "To podważa Twój autorytet.",
        options: [
            {text:"Zleć profesjonalne czyszczenie i zorganizuj pogadankę", cost:{caps:10}, effect:gs=>{gs.resources.morale+=3; return "Ściany są czyste, a dzieci dostały reprymendę. Mieszkańcy docenili twoje wychowawcze podejście."}},
            {text:"Zignoruj to. To tylko dzieci.", effect:gs=>{gs.resources.morale-=3; return "Twoja bierność została odebrana jako słabość, ale po dwóch dniach wszyscy o tym zapomnieli. Mały spadek morale, ale bez większych konsekwencji."}},
            {text:"[DYPLOMATA] Zorganizuj konkurs na najładniejszy mural.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=8; return "Przekułeś wandalizm w kreatywność! Konkurs na mural okazał się hitem.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Twój pomysł został wyśmiany. Dzieci namalowały twoją karykaturę w ramach 'konkursu'.";}}
        ]
    },
    {
        id: 'rand_v_11', type: 'vault', title: "Awaria terminala medycznego", introduction: "Główny terminal medyczny uległ awarii. Odmawia wydawania leków.", description: "Bez niego nie możemy efektywnie używać Stimpaków. To tykająca bomba.",
        options: [
            {text:"Zleć pełną diagnostykę i naprawę", cost:{caps:25}, effect:gs=>{return "Terminal został naprawiony. Było drogo, ale systemy medyczne znów działają w 100%."}},
            {text:"Spróbuj go zrestartować 'na twardo'.", effect:gs=>{gs.resources.stimpaks-=2; return "Restart spowodował zwarcie, które zniszczyło dwa Stimpaki przechowywane w podajniku. Terminal nadal nie działa.";}},
            {text:"[NAUKOWIEC] Zdiagnozuj błąd w oprogramowaniu.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; return "Znalazłeś i załatałeś błąd w kodzie. Terminal działa nawet sprawniej niż wcześniej.";}, failureEffect:gs=>{gs.resources.stimpaks=0; return "Próbując naprawić kod, przypadkowo uruchomiłeś protokół sterylizacji, który zniszczył wszystkie Stimpaki w ambulatorium.";}}
        ]
    },
    {
        id: 'rand_v_12', type: 'vault', title: "Kult Atomu", introduction: "Mieszkaniec założył mały kult czczący 'blask Atomu'.", description: "Na razie są niegroźni, ale ich fanatyzm rośnie. Chcą 'pobłogosławić' reaktor.",
        options:[
            {text:"Zakaż im spotkań i postaw straże przy reaktorze.", effect:gs=>{gs.resources.morale-=8; return "Zakaz tylko wzmocnił ich wiarę i sprowadził ich do podziemia. Teraz są bardziej zdeterminowani."}},
            {text:"Pozwól im. Nieszkodliwa rozrywka.", effect:gs=>{gs.machines.powerGenerator.wydajnosc-=30; return "Twoja bierność się zemściła. Kultyści próbowali 'pobłogosławić' reaktor, powodując jego poważne uszkodzenie.";}},
            {text:"[DYPLOMATA] Porozmawiaj z przywódcą i zdyskredytuj go.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; return "W publicznej debacie obnażyłeś luki w jego 'teologii'. Kultyści rozeszli się zawstydzeni.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Twoja próba dyskusji tylko go rozsierdziła. Nazwał cię 'niewiernym' i zyskał nowych zwolenników.";}}
        ]
    },
    {
        id: 'rand_v_13', type: 'vault', title: "Przedwojenne racje żywnościowe", introduction: "Znaleziono paletę z przedwojennymi, hermetycznie zamkniętymi racjami żywnościowymi.", description: "To może być ogromny zastrzyk jedzenia, ale te puszki mają ponad 200 lat.",
        options:[
            {text:"Zleć analizę jednej puszki", cost:{caps:10}, effect:gs=>{gs.resources.food+=10; gs.resources.morale+=5; return "<strong class='good'>ZDOBYCZ: 10 żywności.</strong> Racje okazały się jadalne! To wielka ulga dla wszystkich.";}},
            {text:"Wyrzućcie je. Zbyt ryzykowne.", effect:gs=>{return "Decydujesz nie ryzykować. Cenne, potencjalne zapasy lądują w spalarni.";}},
            {text:"[SIŁACZ] Spróbuj jednej puszki osobiście.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.food+=10; gs.resources.morale+=7; return "<strong class='good'>ZDOBYCZ: 10 żywności.</strong> Twój żołądek jest z tytanu! Jedzenie jest dobre, a twoja odwaga zaimponowała mieszkańcom.";}, failureEffect:gs=>{gs.resources.food-=10; gs.resources.morale-=10; return "Jedzenie było zepsute. Dostałeś potężnego zatrucia i musiałeś leżeć w łóżku, a część świeżych zapasów zmarnowano na twoje leczenie.";}}
        ]
    },
    {
        id: 'rand_v_14', type: 'vault', title: "Walki w klatce", introduction: "Dwóch osiłków z ochrony zorganizowało nielegalne walki na gołe pięści.", description: "To brutalna rozrywka, ale cieszy się popularnością. Co robisz?",
        options:[
            {text:"Zdelegalizuj walki i ukarz organizatorów.", effect:gs=>{gs.resources.morale-=7; return "Mieszkańcy są wściekli, że odebrałeś im jedyną rozrywkę."}},
            {text:"Pozwól na to, ale pobieraj 'podatek' od zakładów.", effect:gs=>{gs.resources.caps+=15; gs.resources.morale+=3; if(Math.random()>0.9){gs.resources.population--; gs.dwellers.splice(0,1);} return "<strong class='good'>ZDOBYCZ: 15 kapsli.</strong> Zasiliłeś skarbiec i dałeś ludziom igrzyska. Morale wzrosło, ale brutalność walk pozostaje problemem.";}},
            {text:"[SIŁACZ] Wejdź do 'klatki' i pokonaj obu mistrzów.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=25; gs.resources.morale+=10; return "<strong class='good'>ZDOBYCZ: 25 kapsli.</strong> Pokonałeś obu, zdobywając szacunek i wszystkie kapsle z zakładów.";}, failureEffect:gs=>{gs.resources.morale-=10; gs.resources.caps-=20; return "Przeceniłeś siły. Zostałeś pokonany i musiałeś wypłacić wygraną z własnej kieszeni. Twój autorytet legł w gruzach.";}}
        ]
    },
   {
      id: 'rand_v_15', type: 'vault', title: "Nielegalna Gorzelnia", introduction: "W jednej z kwater technicznych odkryto prymitywną gorzelnię produkującą bimber.", description: "To nielegalne, ale alkohol podnosi morale. Co z tym zrobisz?",
    options:[
        {text:"Zniszcz gorzelnię i ukarz producentów", cost:{caps:10}, effect:gs=>{gs.resources.morale-=5; return "Gorzelnia zniszczona, a winni ukarani. Ludzie są wściekli, że odebrałeś im jedyną rozrywkę."}},
        {text:"Przymknij na to oko.", effect:gs=>{gs.resources.morale-=4; return "Pozwoliłeś na produkcję, ale bez żadnej kontroli bimber jest niskiej jakości i powoduje kaca stulecia. Ludzie są zadowoleni, ale mniej produktywni.";}},
        {text:"[DYPLOMATA] Zalegalizuj i opodatkuj produkcję.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; gs.resources.caps+=10; return "<strong class='good'>ZDOBYCZ: 10 kapsli.</strong> Twoja decyzja okazała się hitem!";}, failureEffect:gs=>{gs.resources.morale-=8; return "Twoja próba regulacji spaliła na panewce. Producenci zeszli do podziemia, a teraz bimber powoduje zatrucia.";}}
    ]
},
{
    id: 'rand_v_16', type: 'vault', title: "Plaga Zmutowanych Szczurów", introduction: "W dolnych poziomach pojawiły się duże, agresywne szczury. Kradną jedzenie z magazynów.", description: "Są zagrożeniem dla zapasów i mieszkańców. Trzeba się ich pozbyć.",
    options:[
        {text:"Zastaw profesjonalne pułapki", cost:{scrap:15}, effect:gs=>{gs.resources.food-=10; return "Pułapki zadziałały, ale zanim wyłapały wszystkie szczury, te zdążyły ukraść trochę jedzenia."}},
        {text:"Zabarykadujcie dolne poziomy.", effect:gs=>{gs.resources.food-=30; gs.resources.morale-=5; return "Szczury, odcięte od dolnych poziomów, przegryzły się do głównej spiżarni. Straty w żywności są ogromne."}},
        {text:"[SIŁACZ] Zorganizuj Wielkie Polowanie.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.food+=10; gs.resources.morale+=5; return "<strong class='good'>ZDOBYCZ: 10 żywności.</strong> Polowanie pod twoim dowództwem było sukcesem! Szczury wytępione, a ich mięso zasiliło spiżarnię.";}, failureEffect:gs=>{gs.resources.population--; gs.dwellers.splice(0,1); gs.resources.morale-=10; return "Szczury były wściekłe. Jeden z mieszkańców zginął w walce.";}}
    ]
},
{
    id: 'rand_v_17', type: 'vault', title: "Tajemnicza Choroba", introduction: "Kilku mieszkańców skarży się na dziwną wysypkę i gorączkę.", description: "To może być zwykłe przeziębienie, albo początek epidemii.",
    options:[
        {text:"Wprowadź kwarantannę i podaj leki", cost:{stimpaks:1}, condition:gs=>gs.resources.stimpaks>0, effect:gs=>{gs.resources.morale-=5; return "Choroba została opanowana dzięki kwarantannie, ale izolacja i strach obniżyły morale."}},
        {text:"Poczekaj. Może samo przejdzie.", effect:gs=>{gs.resources.population-=2; gs.dwellers.splice(0,2); gs.resources.morale-=15; return "To była zmutowana grypa. Zanim zareagowałeś, zmarło dwóch mieszkańców. Twoja bierność doprowadziła do tragedii.";}},
        {text:"[NAUKOWIEC] Zbadaj próbki i stwórz antidotum.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; return "Udało ci się stworzyć lekarstwo z dostępnych zasobów. Jesteś bohaterem!";}, failureEffect:gs=>{gs.resources.population--; gs.dwellers.splice(0,1); gs.resources.morale-=10; return "Twoje eksperymentalne lekarstwo okazało się toksyczne. Jeden z pacjentów zmarł.";}}
    ]
},
{
    id: 'rand_v_18', type: 'vault', title: "Festiwal Pamięci", introduction: "Mieszkańcy chcą zorganizować festiwal ku czci poległych podczas ataku na Kryptę.", description: "To może podnieść morale, ale zużyje cenne zasoby.",
    options:[
        {text:"Zgódź się i przeznacz zasoby", cost:{food:10, water:10}, effect:gs=>{gs.resources.morale+=10; return "Festiwal był wzruszającą ceremonią. Mieszkańcy poczuli się zjednoczeni."}},
        {text:"Odmów. Nie ma czasu na sentymenty.", effect:gs=>{gs.resources.morale-=10; return "Twoja bezduszna decyzja spotkała się z powszechnym potępieniem. Jesteś postrzegany jako tyran bez serca."}},
        {text:"[DYPLOMATA] Wygłoś inspirującą przemowę.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=12; return "Twoja przemowa poruszyła serca wszystkich. Zamiast festiwalu, ludzie z nową motywacją wrócili do pracy.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Twoje słowa były puste i nie trafione. Zostałeś wygwizdany, a ludzie są jeszcze bardziej przygnębieni.";}}
    ]
},
{
    id: 'rand_v_19', type: 'vault', title: "Zepsuty terminal rekreacyjny", introduction: "Jedyny terminal z grami wideo w świetlicy zepsuł się.", description: "Dla wielu mieszkańców to była jedyna odskocznia od szarej rzeczywistości. Nuda narasta.",
    options:[
        {text:"Zleć naprawę technikowi", cost:{caps:20}, effect:gs=>{gs.resources.morale+=5; return "Technik naprawił terminal. Mieszkańcy znów mogą grać w 'Red Menace'."}},
        {text:"Powiedz im, żeby znaleźli sobie inne hobby.", effect:gs=>{gs.resources.morale-=8; return "Twoja rada została odebrana jako kpina. Ludzie są sfrustrowani i znudzeni, co prowadzi do kłótni."}},
        {text:"[NAUKOWIEC] Spróbuj ominąć zabezpieczenia i wgrać nowe gry.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=10; return "Nie tylko naprawiłeś terminal, ale wgrałeś na niego kilka nowych, pirackich gier! Jesteś legendą.";}, failureEffect:gs=>{gs.machines.powerGenerator.wydajnosc-=15; return "Próba hackowania spowodowała potężne zwarcie, które uszkodziło część sieci energetycznej.";}}
    ]
},
{
    id: 'rand_v_20', type: 'vault', title: "Plotki i Dezinformacja", introduction: "Po Krypcie krąży plotka, że kończą nam się zapasy wody, chociaż to nieprawda.", description: "Plotka sieje panikę i podważa zaufanie do ciebie. Musisz zareagować.",
    options:[
        {text:"Opublikuj oficjalny stan magazynów.", effect:gs=>{gs.resources.morale+=2; return "Twoja transparentność uspokoiła większość mieszkańców, ale niektórzy wciąż są podejrzliwi.";}},
        {text:"Zignoruj to. Plotki same ucichną.", effect:gs=>{gs.resources.morale-=8; gs.resources.water-=10; return "Plotki nie ucichły. Przerodziły się w panikę, a kilku mieszkańców próbowało włamać się do magazynu 'na zapas', marnując wodę.";}},
        {text:"[SIŁACZ] Znajdź i publicznie ukarz plotkarza.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; return "Twoja brutalna, ale skuteczna metoda zadziałała. Nikt nie odważy się więcej siać paniki.";}, failureEffect:gs=>{gs.resources.morale-=10; return "Ukarałeś niewłaściwą osobę. Prawdziwy plotkarz teraz przedstawia cię jako brutalnego tyrana, a ludzie mu wierzą.";}}
    ]
},
{
    id: 'rand_v_21', type: 'vault', title: "Prośba o prywatność", introduction: "Grupa mieszkańców prosi o możliwość zamykania swoich kwater na klucz.", description: "To wydaje się niewinną prośbą, ale zamykane drzwi mogą utrudniać kontrolę i prowadzić do podziałów.",
    options:[
        {text:"Zgódź się, ale z zastrzeżeniem inspekcji", cost:{scrap:15}, effect:gs=>{gs.resources.morale+=4; return "Mieszkańcy są zadowoleni. Zamki zostały zamontowane."}},
        {text:"Odmów. Krypta to wspólnota, nie ma tu miejsca na sekrety.", effect:gs=>{gs.resources.morale-=6; return "Twoja odmowa została odebrana jako brak zaufania. Ludzie czują się jak w więzieniu.";}},
        {text:"[DYPLOMATA] Zaproponuj kompromis: strefy ciszy i relaksu.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=6; return "Twój pomysł okazał się strzałem w dziesiątkę! Ludzie nie potrzebowali zamków, tylko miejsca dla siebie.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Twój kompromis został uznany za próbę manipulacji. Ludzie są jeszcze bardziej zdeterminowani, by mieć zamki.";}}
    ]
},
{
    id: 'rand_v_22', type: 'vault', title: "Plaga grzybów", introduction: "W systemie wentylacyjnym zaczął rosnąć dziwny, czarny grzyb.", description: "Technicy twierdzą, że zarodniki mogą być toksyczne. Trzeba oczyścić system.",
    options:[
        {text:"Zleć pełną dekontaminację systemu", cost:{caps:25}, effect:gs=>{gs.resources.morale+=2; return "System został profesjonalnie oczyszczony. Powietrze jest bezpieczne."}},
        {text:"Poczekajcie. Może to nic groźnego.", effect:gs=>{gs.resources.morale-=5; gs.population--; gs.dwellers.splice(0,1); return "To był toksyczny grzyb. Jeden z mieszkańców zmarł w wyniku problemów z oddychaniem. Twoja bezczynność kosztowała życie."}},
        {text:"[NAUKOWIEC] Stwórz środek grzybobójczy.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; return "Twój domowej roboty środek grzybobójczy zadziałał perfekcyjnie. Problem rozwiązany bez kosztów.";}, failureEffect:gs=>{gs.machines.hydroponics.wydajnosc-=20; return "Twój środek chemiczny okazał się zbyt żrący. Zniszczył grzyba, ale uszkodził też przewody wentylacyjne prowadzące do hydroponiki.";}}
    ]
},
{
    id: 'rand_v_23', type: 'vault', title: "Konkurs gotowania", introduction: "Kucharz proponuje zorganizowanie konkursu na najlepsze danie z zapasów Krypty.", description: "To świetny sposób na podniesienie morale, ale oznacza zużycie cennych zapasów na 'zabawę'.",
    options:[
        {text:"Zgódź się i przydziel dodatkowe zapasy", cost:{food:20}, effect:gs=>{gs.resources.morale+=12; return "Konkurs był wielkim sukcesem! Mieszkańcy najedli się do syta i świetnie się bawili."}},
        {text:"Odmów. Nie marnujemy jedzenia.", effect:gs=>{gs.resources.morale-=7; return "Twoja decyzja została odebrana jako przejaw tyranii. Ludzie są przygnębieni i głodni rozrywki.";}},
        {text:"[DYPLOMATA] Przekonaj ich, by użyli tylko najgorszych racji.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=10; return "Twoje przemówienie zadziałało! Zrobili konkurs 'Sztuka Przetrwania', używając najmniej lubianych zapasów. Morale wzrosło bez marnowania dobrego jedzenia.";}, failureEffect:gs=>{gs.resources.food-=15; gs.resources.morale-=5; return "Twoja propozycja została wyśmiana. W akcie buntu zużyli jeszcze więcej jedzenia, niż planowano, a ty wyszedłeś na głupca.";}}
    ]
},
{
    id: 'rand_v_24', type: 'vault', title: "Problem ze szczurem w laboratorium", introduction: "Jeden ze szczurów laboratoryjnych, poddany eksperymentom, stał się niezwykle inteligentny i uciekł.", description: "Teraz grasuje w systemie wentylacyjnym, przegryzając kable i kradnąc małe przedmioty. To mały, ale irytujący sabotażysta.",
    options:[
        {text:"Zorganizuj profesjonalne polowanie", cost:{caps:15}, effect:gs=>{gs.resources.scrap+=10; return "<strong class='good'>ZDOBYCZ: 10 złomu.</strong> Szczur został schwytany. W jego gnieździe znaleziono mnóstwo kradzionych części.";}},
        {text:"Zignoruj go. To tylko jeden szczur.", effect:gs=>{gs.resources.power-=15; gs.resources.morale-=4; return "Szczur przegryzł kluczowy kabel zasilający. Naprawa zajęła pół dnia i zirytowała wszystkich.";}},
        {text:"[SIŁACZ] Zastaw na niego pułapkę z jedzeniem.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.food+=5; gs.resources.scrap+=10; return "<strong class='good'>ZDOBYCZ: 10 złomu, 5 żywności.</strong> Złapałeś go! Odzyskałeś skradziony złom, a sam szczur... cóż, to dodatkowe białko.";}, failureEffect:gs=>{gs.resources.food-=15; return "Szczur był mądrzejszy. Nie tylko ukradł przynętę, ale przy okazji otworzył pojemnik i ukradł jeszcze więcej jedzenia.";}}
    ]
},
{
    id: 'rand_v_25', type: 'vault', title: "Konflikt o pracę", introduction: "Dwóch techników pokłóciło się o to, kto ma nadzorować generator.", description: "Ich rywalizacja zaczyna zagrażać stabilności zasilania. Musisz wyznaczyć jednego z nich jako głównego inżyniera.",
    options:[
        {text:"Zorganizuj oficjalny test kwalifikacji", cost:{caps:10}, effect:gs=>{gs.machines.powerGenerator.maxEfficiency+=0.05; return "<strong class='good'>BONUS: +5% do maks. efektywności generatora.</strong> Test wyłonił lepszego kandydata.";}},
        {text:"Powiedz im, żeby przestali się kłócić.", effect:gs=>{gs.machines.powerGenerator.wydajnosc-=15; gs.resources.morale-=5; return "Twoja ignorancja doprowadziła do sabotażu. Jeden z techników uszkodził pracę drugiego, powodując awarię.";}},
        {text:"[SIŁACZ] Zagroź, że jeśli się nie dogadają, obaj trafią do szorowania latryn.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=2; return "Twoja groźba zadziałała. Technicy przestali się kłócić i zaczęli współpracować.";}, failureEffect:gs=>{gs.machines.powerGenerator.wydajnosc-=20; return "Twoje groźby tylko ich bardziej rozzłościły. W akcie buntu obaj porzucili swoje stanowiska, co doprowadziło do przegrzania reaktora.";}}
    ]
},
{
    id: 'rand_v_26', type: 'vault', title: "Zapomniany schowek", introduction: "Podczas porządków w starym magazynie znaleziono zapieczętowany schowek.", description: "Nikt nie wie, co jest w środku. Może zawierać cenne zapasy, albo niebezpieczne materiały.",
    options:[
        {text:"Otwórz go ostrożnie, używając sprzętu", cost:{scrap:10}, effect:gs=>{gs.resources.stimpaks+=3; return "<strong class='good'>ZDOBYCZ: 3 Stimpaki.</strong> W środku był zapasowy zestaw medyczny!";}},
        {text:"Zostaw go w spokoju. Nie ruszaj nieznanego.", effect:gs=>{gs.resources.morale-=3; return "Tajemniczy schowek stał się źródłem plotek i niepokoju. Ludzie boją się, co może być w środku.";}},
        {text:"[SIŁACZ] Wyważ drzwi siłą.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.power+=10; return "<strong class='good'>ZDOBYCZ: 40 energii.</strong> W środku były zapasowe ogniwa fuzyjne!";}, failureEffect:gs=>{gs.population--; gs.dwellers.splice(0,1); return "W środku były niestabilne materiały wybuchowe. Eksplozja zabiła jednego z mieszkańców.";}}
    ]
},
{
    id: 'rand_v_27', type: 'vault', title: "Amatorskie Radio", introduction: "Jeden z mieszkańców zbudował radio i próbuje nawiązać kontakt z innymi ocalałymi.", description: "Jego transmisje mogą przyciągnąć pomoc... albo bandytów. To duże ryzyko.",
    options:[
        {text:"Zakaż transmisji i skonfiskuj radio.", effect:gs=>{gs.resources.morale-=5; return "Mieszkaniec jest załamany. Odebrałeś mu nadzieję na kontakt ze światem zewnętrznym.";}},
        {text:"Pozwól mu nadawać, ale z ograniczeniami.", effect:gs=>{gs.resources.morale+=3; return "Transmisje są krótkie i kodowane. Na razie nic się nie stało, a ludzie mają nadzieję.";}},
        {text:"[DYPLOMATA] Pomóż mu stworzyć oficjalny kanał dyplomatyczny.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=12; return "<strong class='good'>ZDOBYCZ: 12 kapsli.</strong> Udało wam się nawiązać kontakt z pobliską osadą, która zapłaciła za informacje o bezpiecznych szlakach!";}, failureEffect:gs=>{gs.resources.food-=30; return "Wasz sygnał przechwycili bandyci. Musieliście zapłacić im haracz w jedzeniu, żeby zostawili was w spokoju.";}}
    ]
},
{
    id: 'rand_v_28', type: 'vault', title: "Problem z karaluchami... w jedzeniu", introduction: "Kucharz odkrył, że niewielka partia syntetycznej pasty odżywczej jest zanieczyszczona karaluchami.", description: "Można ją wyrzucić, albo... spróbować wykorzystać. Białko to białko.",
    options:[
        {text:"Wyrzuć całą partię", cost:{food:20}, effect:gs=>{return "Bezpieczeństwo przede wszystkim. Zanieczyszczona żywność została zniszczona."}},
        {text:"Zignoruj to i podaj jedzenie jak zwykle.", effect:gs=>{gs.resources.morale-=10; return "Mieszkańcy odkryli 'dodatkowe składniki'. Wybuchł skandal, a twoja reputacja legła w gruzach.";}},
        {text:"[SIŁACZ] Ogłoś 'Tydzień Chrupiącej Niespodzianki'.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; return "Twoja bezczelna kampania marketingowa zadziałała! Mieszkańcy uznali to za dziwaczną, ale zabawną nowość.";}, failureEffect:gs=>{gs.resources.morale-=15; gs.resources.food-=10; return "Ludzie nie są idiotami. Twoja próba oszustwa doprowadziła do buntu w stołówce. Zmarnowano jeszcze więcej jedzenia.";}}
    ]
},
{
    id: 'rand_v_29', type: 'vault', title: "Wybory na Szefa Ochrony", introduction: "Mieszkańcy domagają się demokratycznych wyborów na szefa ochrony.", description: "Możesz na to pozwolić, ryzykując, że wygra ktoś niekompetentny, albo mianować swojego człowieka siłą.",
    options:[
        {text:"Zgódź się na wybory.", effect:gs=>{if(Math.random()<0.5){gs.resources.morale+=5; return "Wygrał kompetentny kandydat. Demokracja zadziałała!";} else {gs.resources.morale-=5; return "Wygrał populista, który obiecał wszystkim lżejszą pracę. Dyscyplina w ochronie spadła.";}}},
        {text:"Odmów. Ty decydujesz, kto jest szefem.", effect:gs=>{gs.resources.morale-=8; return "Twoja autorytarna decyzja spotkała się z oporem. Mieszkańcy czują, że nie mają żadnego głosu.";}},
        {text:"[DYPLOMATA] Zmanipuluj wybory na korzyść swojego kandydata.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=3; return "Twoje закулисные działania zapewniły zwycięstwo twojemu człowiekowi. Nikt nic nie zauważył.";}, failureEffect:gs=>{gs.resources.morale-=10; return "Twoja manipulacja została odkryta! Wybuchł skandal, który mocno podkopał twoje zaufanie.";}}
    ]
},
{
    id: 'rand_v_30', type: 'vault', title: "Awaria systemu audio", introduction: "Głośniki w całej Krypcie zaczęły emitować ogłuszający, biały szum.", description: "Hałas doprowadza wszystkich do szału. Trzeba natychmiast znaleźć i naprawić usterkę.",
    options:[
        {text:"Zleć pełną diagnostykę systemu", cost:{caps:20}, effect:gs=>{gs.resources.morale+=3; return "Technicy znaleźli źródło problemu i naprawili je. W Krypcie znów panuje cisza.";}},
        {text:"Odetnij zasilanie od głośników.", effect:gs=>{gs.resources.morale-=6; return "Hałas ustał, ale teraz w Krypcie panuje grobowa cisza. Brak komunikatów i muzyki sprawia, że jest nieswojo.";}},
        {text:"[NAUKOWIEC] Spróbuj przekierować sygnał.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=7; return "Nie tylko naprawiłeś system, ale odkryłeś ukryty kanał z przedwojenną muzyką klasyczną! Morale wzrosło.";}, failureEffect:gs=>{gs.machines.powerGenerator.wydajnosc-=10; gs.resources.power-=15; return "Próba przekierowania sygnału spowodowała zwarcie, które uszkodziło konsolę i przeciążyło generator.";}}
    ]
},
{
    id: 'rand_v_31', type: 'vault', title: "Zapasy papieru toaletowego", introduction: "W magazynie odkryto ostatnią paletę przedwojennego papieru toaletowego.", description: "To prawdziwy luksus. Możesz go rozdać, by podnieść morale, albo zachować.",
    options:[
        {text:"Rozdaj go po równo wszystkim mieszkańcom.", effect:gs=>{gs.resources.morale+=8; return "Mieszkańcy są zachwyceni! To mała rzecz, a cieszy jak nic innego. Morale poszybowało w górę.";}},
        {text:"Zamknij go w sejfie. Nikt nie musi o tym wiedzieć.", effect:gs=>{return "Udało ci się zachować sprawę w tajemnicy. Papier jest bezpieczny, a nikt nie jest zły. Na razie.";}},
        {text:"[DYPLOMATA] Zorganizuj loterię, w której główną nagrodą jest papier.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; gs.resources.caps+=10; return "<strong class='good'>ZDOBYCZ: 10 kapsli.</strong> Loteria była strzałem w dziesiątkę! Wszyscy świetnie się bawili, a ty zarobiłeś na losach.";}, failureEffect:gs=>{gs.resources.morale-=7; return "Twoja loteria została uznana za oszustwo. Wybuchły zamieszki, a wściekły tłum splądrował zapasy papieru.";}}
    ]
},
{
    id: 'rand_v_32', type: 'vault', title: "Amatorskie Radio", introduction: "Jeden z mieszkańców zbudował radio i próbuje nawiązać kontakt z innymi ocalałymi.", description: "Jego transmisje mogą przyciągnąć pomoc... albo bandytów. To duże ryzyko.",
    options:[
        {text:"Zakaż transmisji i skonfiskuj radio.", effect:gs=>{gs.resources.morale-=5; return "Mieszkaniec jest załamany. Odebrałeś mu nadzieję na kontakt ze światem zewnętrznym.";}},
        {text:"Pozwól mu nadawać, ale z ograniczeniami.", effect:gs=>{gs.resources.morale+=3; return "Transmisje są krótkie i kodowane. Na razie nic się nie stało, a ludzie mają nadzieję.";}},
        {text:"[DYPLOMATA] Pomóż mu stworzyć oficjalny kanał dyplomatyczny.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=10; return "<strong class='good'>ZDOBYCZ: 10 kapsli.</strong> Udało wam się nawiązać kontakt z pobliską osadą, która zapłaciła za informacje o bezpiecznych szlakach!";}, failureEffect:gs=>{gs.resources.food-=30; return "Wasz sygnał przechwycili bandyci. Musieliście zapłacić im haracz w jedzeniu, żeby zostawili was w spokoju.";}}
    ]
},
{
    id: 'rand_v_33', type: 'vault', title: "Artysta-malarz", introduction: "Jeden z mieszkańców, były artysta, chce namalować wielki mural przedstawiający historię Krypty 62.", description: "To może być piękne dzieło sztuki, ale potrzebuje farb i materiałów.",
    options:[
        {text:"Zgódź się i sfinansuj projekt", cost:{scrap:15, caps:15}, effect:gs=>{gs.resources.morale+=10; return "Mural jest wspaniały! Stał się symbolem przetrwania i dumy Krypty."}},
        {text:"Odmów. Mamy ważniejsze wydatki.", effect:gs=>{gs.resources.morale-=6; return "Artysta jest załamany, a mieszkańcy rozczarowani brakiem wsparcia dla kultury. Krypta staje się coraz bardziej szarym miejscem.";}},
        {text:"[DYPLOMATA] Przekonaj go, by użył naturalnych barwników.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=8; return "Twój pomysł na użycie gliny, rdzy i węgla zadziałał! Mural ma surowy, postapokaliptyczny styl, a ty zaoszczędziłeś zasoby.";}, failureEffect:gs=>{gs.machines.waterPurifier.wydajnosc-=10; return "Naturalne barwniki okazały się toksyczne i zanieczyściły pobliski obieg wody, uszkadzając filtry.";}}
    ]
},
{
    id: 'rand_v_34', type: 'vault', title: "Hodowla insektów", introduction: "Jeden z mieszkańców proponuje założenie farmy jadalnych insektów.", description: "To wydajne źródło białka, ale pomysł jedzenia robaków budzi powszechne obrzydzenie.",
    options:[
        {text:"Zainwestuj w profesjonalną farmę", cost:{scrap:20}, effect:gs=>{gs.resources.food+=10; return "<strong class='good'>BONUS: +10 żywności dziennie! (Fabularnie)</strong> Mieszkańcy narzekają, ale jedzą. Produkcja żywności wzrosła.";}},
        {text:"Odrzuć pomysł. To obrzydliwe.", effect:gs=>{gs.resources.morale-=3; return "Entomolog jest zawiedziony, a ty straciłeś szansę na nowe źródło pożywienia. Niektórzy głodni mieszkańcy żałują.";}},
        {text:"[NAUKOWIEC] Zoptymalizuj hodowlę w ukryciu.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.food+=10; return "<strong class='good'>BONUS: +10 żywności dziennie! (Fabularnie)</strong> Twoja dyskretna, wydajna farma produkuje pastę proteinową. Nikt nie wie, z czego jest zrobiona.";}, failureEffect:gs=>{gs.resources.morale-=10; gs.resources.food-=20; return "Insekty uciekły z prowizorycznej hodowli i zalały spiżarnię, zanieczyszczając zapasy żywności.";}}
    ]
},
{
    id: 'rand_v_35', type: 'vault', title: "Problem z recyklingiem", introduction: "System recyklingu odpadów zapchał się. Sterta śmieci rośnie.", description: "Smród jest nie do zniesienia i istnieje ryzyko wybuchu epidemii.",
    options:[
        {text:"Zleć pełne czyszczenie i naprawę {cost}", cost:{caps:25}, effect:gs=>{return "System został udrożniony. Śmieci zniknęły, a wraz z nimi smród.";}},
        {text:"Wyrzućcie śmieci do nieużywanego tunelu.", effect:gs=>{gs.resources.morale-=8; return "To było krótkowzroczne rozwiązanie. Tunel stał się wylęgarnią chorób i zmutowanych insektów.";}},
        {text:"[SIŁACZ] Udrożnij zapchaną rurę ręcznie.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=25; return "<strong class='good'>ZDOBYCZ: 25 złomu.</strong> Twoja siła wystarczyła, by przepchnąć zator. Odzyskałeś sporo złomu!";}, failureEffect:gs=>{gs.resources.stimpaks-=1; return "Udało ci się, ale w stercie śmieci było ostre szkło. Poważnie się zraniłeś i musiałeś użyć Stimpaka.";}}
    ]
},
{
    id: 'rand_v_36', type: 'vault', title: "Trening obronny", introduction: "Szef ochrony proponuje przeprowadzenie obowiązkowych ćwiczeń obronnych.", description: "To zwiększy bezpieczeństwo Krypty, ale oderwie ludzi od pracy.",
    options:[
        {text:"Zgódź się. Bezpieczeństwo jest najważniejsze.", effect:gs=>{gs.resources.food-=10; gs.resources.water-=10; gs.resources.morale+=5; return "Ćwiczenia były męczące, ale skuteczne. Mieszkańcy czują się bezpieczniej, chociaż straciliśmy trochę zasobów.";}},
        {text:"Odmów. Produkcja jest priorytetem.", effect:gs=>{gs.resources.morale-=5; return "Szef ochrony jest zawiedziony. Mieszkańcy czują się bezbronni.";}},
        {text:"[SIŁACZ] Poprowadź trening osobiście.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=10; return "Twój intensywny trening zamienił cywili w zdyscyplinowaną milicję. Morale i poczucie bezpieczeństwa poszybowały w górę.";}, failureEffect:gs=>{gs.resources.population--; gs.dwellers.splice(0,1); return "Przesadziłeś z realizmem. Jeden z mieszkańców zginął podczas ćwiczeń z ostrą amunicją.";}}
    ]
},
{
    id: 'rand_v_37', type: 'vault', title: "Dzień Sportu", introduction: "Jeden z mieszkańców, były nauczyciel WF-u, proponuje zorganizowanie Dnia Sportu.", description: "Zawody sportowe mogą być świetną odskocznią i sposobem na integrację. Ale czy stać nas na dzień wolny od pracy?",
    options:[
        {text:"Zgódź się. Dzień wolny dobrze wszystkim zrobi.", effect:gs=>{gs.resources.morale+=15; gs.resources.food-=10; gs.resources.water-=10; return "To był wspaniały dzień! Wszyscy świetnie się bawili, a morale jest najwyższe od dawna. Kosztowało to jednak dzień produkcji.";}},
        {text:"Odmów. Nie ma czasu na igrzyska.", effect:gs=>{gs.resources.morale-=8; return "Odmówiłeś. Mieszkańcy są przemęczeni i zdemotywowani. Potrzebowali tej przerwy.";}},
        {text:"[DYPLOMATA] Zorganizuj zawody 'Siłaczy Krypty'.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=10; return "Twój pomysł na zawody siłowe był hitem. Zamiast całego dnia, zawody trwały kilka godzin, a mieszkańcy byli zachwyceni.";}, failureEffect:gs=>{gs.resources.stimpaks-=1; return "Rywalizacja wymknęła się spod kontroli. Dwóch mieszkańców pobiło się tak mocno, że jeden z nich wylądował w ambulatorium.";}}
    ]
},
{
    id: 'rand_v_38', type: 'vault', title: "Stary terminal Nadzorcy", introduction: "Twój brat Adam odkrył, że stary terminal Nadzorcy ma dostęp do ukrytych, przedwojennych archiwów Vault-Tec.", description: "Próba złamania zabezpieczeń może dać nam cenną wiedzę, ale może też uruchomić nieznane protokoły bezpieczeństwa.",
    options:[
        {text:"Zleć profesjonalne, powolne hakowanie", cost:{caps:25}, effect:gs=>{gs.resources.scrap+=30; return "<strong class='good'>ZDOBYCZ: 30 złomu.</strong> Hakerzy znaleźli plany konstrukcyjne, które pozwalają na odzyskiwanie większej ilości złomu z recyklingu.";}},
        {text:"Zostaw terminal w spokoju. Nie kusić losu.", effect:gs=>{return "Decydujesz, że ryzyko jest zbyt duże. Tajemnice Vault-Tec pozostaną nieodkryte.";}},
        {text:"[NAUKOWIEC] Złam zabezpieczenia osobiście.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.machines.powerGenerator.maxEfficiency+=0.1; return "<strong class='good'>BONUS: +10% do maks. efektywności generatora.</strong> Znalazłeś pliki optymalizacyjne dla waszego modelu reaktora!";}, failureEffect:gs=>{gs.resources.morale-=10; return "Uruchomiłeś protokół 'całkowitej kwarantanny'. Wszystkie drzwi w Krypcie zamknęły się na 24 godziny, wywołując panikę.";}}
    ]
},
{
    id: 'rand_v_39', type: 'vault', title: "Kryzys wiary", introduction: "Główny medyk jest wyczerpany i bliski załamania. Widział zbyt wiele śmierci i cierpienia.", description: "Jego stan psychiczny wpływa na jakość opieki medycznej. Potrzebuje wsparcia.",
    options:[
        {text:"Daj mu kilka dni wolnego i przydziel pomocnika.", effect:gs=>{gs.resources.morale+=5; return "Medyk jest wdzięczny za twoje zrozumienie. Po kilku dniach odpoczynku wraca do pracy z nowymi siłami.";}},
        {text:"Powiedz mu, żeby wziął się w garść.", effect:gs=>{gs.resources.morale-=8; return "Twoje twarde słowa tylko go dobiły. Jego praca jest teraz jeszcze bardziej chaotyczna i nieefektywna.";}},
        {text:"[DYPLOMATA] Porozmawiaj z nim i podnieś go na duchu.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=10; return "Twoja rozmowa była dokładnie tym, czego potrzebował. Zainspirowałeś go do dalszej walki o życie mieszkańców.";}, failureEffect:gs=>{gs.resources.stimpaks-=2; return "Twoje słowa przyniosły odwrotny skutek. Wpadł w depresję i 'przypadkowo' zniszczył dwa cenne Stimpaki.";}}
    ]
},
{
    id: 'rand_v_40', type: 'vault', title: "Dziwne sygnały z reaktora", introduction: "Czujniki przy reaktorze wykrywają dziwne, nieregularne skoki energii.", description: "To może być nic, ale może to być też oznaka zbliżającej się awarii. Diagnostyka wymaga wyłączenia reaktora.",
    options:[
        {text:"Wyłącz reaktor i przeprowadź pełną diagnostykę", cost:{power:20}, effect:gs=>{gs.machines.powerGenerator.wydajnosc+=10; return "To była dobra decyzja. Znaleziono i naprawiono niewielką usterkę, zanim stała się groźna.";}},
        {text:"Zignoruj to. Pewnie czujniki wariują.", effect:gs=>{gs.machines.powerGenerator.wydajnosc-=30; return "To nie były czujniki. Niewielka usterka przerodziła się w poważną awarię, która mocno uszkodziła reaktor.";}},
        {text:"[NAUKOWIEC] Przeprowadź diagnostykę 'na żywo'.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.machines.powerGenerator.maxEfficiency+=0.05; return "<strong class='good'>BONUS: +5% do maks. efektywności generatora.</strong> Odkryłeś, że skoki energii to efekt nieefektywnego przepływu. Zoptymalizowałeś go!";}, failureEffect:gs=>{gs.resources.power=0; gs.resources.morale-=10; return "Twoja próba manipulacji 'na żywo' spowodowała awaryjne wyłączenie reaktora. Krypta pogrążyła się w ciemności.";}}
    ]
},
{
    id: 'rand_v_41', type: 'vault', title: "Prośba o bibliotekę", introduction: "Grupa mieszkańców prosi o wydzielenie jednego pomieszczenia na bibliotekę.", description: "Mają trochę książek, ale potrzebują miejsca. To może podnieść morale, ale to pomieszczenie można by wykorzystać jako magazyn.",
    options:[
        {text:"Zgódź się. Wiedza jest ważna.", effect:gs=>{gs.resources.morale+=7; return "Biblioteka stała się sercem społeczności. Ludzie są wdzięczni i mają nowe miejsce do spędzania czasu.";}},
        {text:"Odmów. Potrzebujemy miejsca na zapasy.", effect:gs=>{gs.resources.morale-=5; return "Twoja praktyczna decyzja spotkała się z rozczarowaniem. Ludzie czują, że dbasz tylko o brzuchy, a nie o umysły.";}},
        {text:"[DYPLOMATA] Zaproponuj kącik czytelniczy w kantynie.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; return "To świetny kompromis! Ludzie mają swoje książki, a ty nie straciłeś cennego pomieszczenia.";}, failureEffect:gs=>{gs.resources.food-=10; return "Twój pomysł był zły. Ktoś zalał książki zupą, co doprowadziło do bójki i zmarnowania jedzenia.";}}
    ]
},
{
    id: 'rand_v_42', type: 'vault', title: "Zmutowany pomidor", introduction: "W hydroponice jeden z pomidorów urósł do gigantycznych rozmiarów.", description: "To ogromna ilość jedzenia, ale nikt nie wie, czy jest bezpieczny po takiej mutacji.",
    options:[
        {text:"Zleć pełne badanie toksykologiczne", cost:{caps:15}, effect:gs=>{gs.resources.food+=10; return "<strong class='good'>ZDOBYCZ: 10 żywności.</strong> Pomidor jest bezpieczny! To prawdziwa uczta dla całej Krypty.";}},
        {text:"Zniszcz go. Nie jemy mutantów.", effect:gs=>{gs.resources.morale-=3; return "Zniszczyłeś potencjalną ucztę. Ludzie są rozczarowani twoją nadgorliwością.";}},
        {text:"[SIŁACZ] Zjedz kawałek na oczach wszystkich.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.food+=10; gs.resources.morale+=5; return "<strong class='good'>ZDOBYCZ: 10 żywności.</strong> Okazało się, że jest pyszny! Twoja odwaga zaimponowała wszystkim.";}, failureEffect:gs=>{gs.resources.stimpaks-=1; return "Pomidor był lekko toksyczny. Dostałeś potężnych torsji i musiałeś zużyć Stimpaka, żeby dojść do siebie.";}}
    ]
},
{
    id: 'rand_v_43', type: 'vault', title: "Przedwojenne znalezisko", introduction: "Podczas kopania w nieużywanym sektorze, mieszkańcy znaleźli skrzynię z przedwojennymi alkoholami.", description: "To butelki whisky, wina i wódki, warte fortunę w kapslach. Możesz je rozdać, by podnieść morale, albo zachować.",
    options:[
        {text:"Rozdaj alkohol mieszkańcom.", effect:gs=>{gs.resources.morale+=15; return "Zorganizowałeś największą imprezę w historii Krypty 62! Morale jest w stratosferze.";}},
        {text:"Zachowaj to jako cenną walutę.", effect:gs=>{gs.resources.caps+=12; gs.resources.morale-=5; return "<strong class='good'>ZDOBYCZ: 12 kapsli.</strong> Udało ci się po cichu sprzedać alkohol wędrownym kupcom, ale wieść się rozeszła i ludzie są źli, że nie podzieliłeś się z nimi.";}},
        {text:"[DYPLOMATA] Zorganizuj elegancki wieczór degustacyjny.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=10; gs.resources.caps+=8; return "<strong class='good'>ZDOBYCZ: 8 kapsli.</strong> Zorganizowałeś ekskluzywną degustację 'dla elity' za opłatą. Zarobiłeś kapsle i dałeś ludziom poczucie luksusu.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Twój wieczór był zbyt 'sztywny'. Ludzie upili się, pobili i potłukli najcenniejsze butelki.";}}
    ]
},
{
    id: 'rand_v_44', type: 'vault', title: "Projekt 'Zielona Krypta'", introduction: "Grupa mieszkańców chce posadzić w kwaterach małe roślinki doniczkowe. Będą potrzebować wody.", description: "Zieleń może poprawić nastrój, ale każda kropla jest cenna.",
    options:[
        {text:"Zgódź się i przydziel wodę", cost:{water:16}, effect:gs=>{gs.resources.morale+=9; return "Małe roślinki znacznie ożywiły surowe wnętrza Krypty. Morale wzrosło.";}},
        {text:"Odmów. Woda jest do picia.", effect:gs=>{gs.resources.morale-=5; return "Mieszkańcy są rozczarowani. Krypta pozostaje szara i betonowa.";}},
        {text:"[DYPLOMATA] Zorganizuj zbiórkę 'nadmiaru' wody", isClassSpecific: true, classCheck: 'Dyplomata', cost:{water:5}, successEffect:gs=>{gs.resources.morale+=11; return "Twój apel zadziałał! Ludzie chętnie oddali po trochu wody, a projekt ruszył minimalnym kosztem dla magazynu.";}, failureEffect:gs=>{gs.resources.morale-=6; return "Nikt nie chciał oddać swojej wody. Twój apel został odebrany jako próba oszczędzania na ich komforcie.";}}
    ]
},
{
    id: 'rand_v_45', type: 'vault', title: "Konkurs talentów", introduction: "Jeden z mieszkańców chce zorganizować konkurs talentów dla całej Krypty.", description: "Śpiew, poezja, żonglowanie zmutowanymi owocami... To może być świetna zabawa, albo totalna katastrofa.",
    options:[
        {text:"Zgódź się i ufunduj nagrodę ", cost:{caps:20}, effect:gs=>{gs.resources.morale+=10; return "Konkurs był hitem! Odkryliście ukryte talenty, a zwycięzca jest zachwycony nagrodą. Wszyscy świetnie się bawili.";}},
        {text:"Odmów. Mamy ważniejsze rzeczy do roboty.", effect:gs=>{gs.resources.morale-=6; return "Odmówiłeś. Mieszkańcy są rozczarowani twoim brakiem luzu. Monotonia życia w Krypcie staje się coraz bardziej przytłaczająca.";}},
        {text:"[DYPLOMATA] Zostań jurorem i prowadzącym.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=12; return "Twoje charyzmatyczne prowadzenie i dowcipne komentarze sprawiły, że show był legendarny! Morale poszybowało w górę.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Twoje żarty były suche, a werdykty niesprawiedliwe. Publiczność cię wygwizdała, a konkurs zakończył się kłótnią.";}}
    ]
},
{
    id: 'rand_v_46', type: 'vault', title: "Spór o muzykę", introduction: "Dwóch mieszkańców kłóci się o to, jakiej muzyki słuchać w kantynie. Jeden chce jazzu, drugi rock'n'rolla.", description: "Ich kłótnia psuje atmosferę podczas posiłków. Musisz interweniować.",
    options:[
        {text:"Ustanów harmonogram muzyczny.", effect:gs=>{gs.resources.morale+=3; return "Twoje rozwiązanie jest sprawiedliwe i logiczne. Obie strony są zadowolone.";}},
        {text:"Zakaż puszczania muzyki w ogóle.", effect:gs=>{gs.resources.morale-=5; return "Twoja decyzja jest postrzegana jako tyrania. Teraz wszyscy jedzą w grobowej ciszy.";}},
        {text:"[DYPLOMATA] Przekonaj ich, że fuzja gatunków to przyszłość.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=8; return "Twoja przemowa o 'atomowym rockabilly-jazzie' była tak absurdalna i charyzmatyczna, że pogodziła zwaśnione strony w śmiechu.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Twoja próba bycia fajnym spaliła na panewce. Teraz kłócą się nie tylko o muzykę, ale i o to, że ich nie szanujesz.";}}
    ]
},
{
    id: 'rand_v_47', type: 'vault', title: "Problem z higieną", introduction: "Jeden z mieszkańców notorycznie nie dba o higienę osobistą. Inni skarżą się na smród.", description: "To delikatna sprawa, ale wpływa na komfort życia w zamkniętej przestrzeni. Trzeba coś z tym zrobić.",
    options:[
        {text:"Porozmawiaj z nim na osobności i zaoferuj dodatkowe mydło.", effect:gs=>{gs.resources.morale+=4; return "Mieszkaniec był zawstydzony, ale wdzięczny za twoją dyskrecję. Problem zniknął.";}},
        {text:"Publicznie go zgań i każ mu się umyć.", effect:gs=>{gs.resources.morale-=7; return "Upokorzyłeś go na oczach wszystkich. Może i jest czystszy, ale nienawidzi cię, a inni boją się twojego okrucieństwa.";}},
        {text:"[SIŁACZ] 'Zaproponuj' mu kąpiel w basenie przeciwpożarowym.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; return "Twoja brutalna, ale skuteczna metoda zadziałała. Mieszkaniec jest czysty, a reszta ma zabawną anegdotę do opowiadania.";}, failureEffect:gs=>{gs.machines.waterPurifier.wydajnosc-=10; return "Twoja 'kąpiel' uszkodziła jeden z filtrów w basenie, który jest połączony z głównym obiegiem wody.";}}
    ]
},
{
    id: 'rand_v_48', type: 'vault', title: "Kryzys wieku średniego", introduction: "Jeden z techników zaczął nosić starą, skórzaną kurtkę i twierdzi, że zakłada zespół rockowy.", description: "Jego nowa pasja sprawia, że zaniedbuje swoje obowiązki. To irytujące, ale może to tylko faza.",
    options:[
        {text:"Daj mu tydzień na 'odnalezienie siebie'.", effect:gs=>{gs.resources.morale+=3; return "Po tygodniu grania na gitarze, technikowi przeszła ochota na bycie gwiazdą rocka. Wrócił do pracy, wdzięczny za twoje zrozumienie.";}},
        {text:"Każ mu zdjąć kurtkę i wrócić do pracy.", effect:gs=>{gs.resources.morale-=6; return "Zgasiłeś jego iskrę. Jest teraz apatyczny i wykonuje swoją pracę bez entuzjazmu, co wpływa na jej jakość.";}},
        {text:"[DYPLOMATA] Zostań jego 'menedżerem' i zorganizuj mu koncert.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=10; return "Koncert był okropny, ale tak zabawny, że stał się legendą Krypty. Morale poszybowało w górę.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Koncert był tak zły, że ludzie zaczęli rzucać w niego zepsutym jedzeniem. Wybuchły zamieszki, a ty zostałeś obwiniony za organizację tej klapy.";}}
    ]
},
{
    id: 'rand_v_49', type: 'vault', title: "Romans w pracy", introduction: "Dwóch naukowców, którzy powinni pracować nad hydroponiką, spędza większość czasu na flirtowaniu.", description: "Ich romans obniża wydajność pracy w całym sektorze. Inni pracownicy są poirytowani.",
    options:[
        {text:"Przenieś jednego z nich do innego działu.", effect:gs=>{gs.resources.morale-=3; return "Rozdzieliłeś zakochanych. Są nieszczęśliwi, ale praca w hydroponice wróciła do normy.";}},
        {text:"Zignoruj to. Miłość nie wybiera.", effect:gs=>{gs.resources.food-=15; gs.resources.morale-=4; return "Ich romans doprowadził do zaniedbania, które kosztowało nas część upraw. Inni mieszkańcy są wściekli.";}},
        {text:"[DYPLOMATA] Porozmawiaj z nimi i wyznacz im 'randki' po godzinach pracy.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=8; return "Twoja dojrzała i wyrozumiała postawa zadziałała. Para jest szczęśliwa, a w pracy zachowują pełen profesjonalizm. Zyskałeś ich szacunek.";}, failureEffect:gs=>{gs.resources.morale-=7; return "Twoja próba bycia 'coachem relacji' spaliła na panewce. Uznali, że wtrącasz się w ich życie i w akcie buntu pracują jeszcze gorzej.";}}
    ]
},
{
    id: 'rand_v_50', type: 'vault', title: "Hodowla karaluchów", introduction: "Jedno z dzieci zaczęło hodować rad-karaluchy w słoiku jako 'zwierzątka domowe'.", description: "To obrzydliwe i niehigieniczne, ale dziecko jest bardzo przywiązane do swoich 'pupili'.",
    options:[
        {text:"Każ mu wypuścić karaluchy i zdezynfekuj kwaterę.", effect:gs=>{gs.resources.morale-=4; return "Dziecko jest załamane, a jego rodzice są na ciebie źli. Jesteś postrzegany jako bezduszny.";}},
        {text:"Pozwól mu je zatrzymać, pod warunkiem trzymania ich w zamknięciu.", effect:gs=>{if(Math.random()<0.3){return "Dziecko dobrze opiekuje się swoimi karaluchami. To dziwne, ale nieszkodliwe hobby.";} else {gs.resources.morale-=5; return "Karaluchy uciekły i zalęgły się w całym sektorze mieszkalnym. Teraz macie małą plagę.";}}},
        {text:"[NAUKOWIEC] Zaoferuj mu profesjonalne terrarium w zamian za możliwość obserwacji.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; return "Dziecko jest zachwycone, a ty masz nowe, fascynujące okazy do badań. Wszyscy wygrali.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Twoje terrarium miało wadę. Karaluchy uciekły, a teraz wszyscy obwiniają ciebie za inwazję robactwa.";}}
    ]
},
{
    id: 'rand_v_51', type: 'vault', title: "Klub książki", introduction: "Grupa mieszkańców założyła klub książki, ale kłócą się o to, czy czytać przedwojenną poezję, czy instrukcje techniczne.", description: "Ich intelektualny spór staje się coraz głośniejszy i bardziej irytujący dla otoczenia.",
    options:[
        {text:"Zaproponuj, by czytali na zmianę, tydzień poezji, tydzień techniki.", effect:gs=>{gs.resources.morale+=3; return "To prosty, ale skuteczny kompromis. Wszyscy są zadowoleni.";}},
        {text:"Zignoruj ich. To nie twój problem.", effect:gs=>{gs.resources.morale-=3; return "Ich kłótnia przerodziła się w otwartą wrogość. Teraz w Krypcie są dwa zwaśnione 'kluby książki'.";}},
        {text:"[DYPLOMATA] Wygłoś mowę o tym, jak technika i sztuka się uzupełniają.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=8; return "Twoja inspirująca przemowa sprawiła, że założyli nowy, zjednoczony klub 'Filozofii Techniki'. Jesteś ich guru.";}, failureEffect:gs=>{gs.resources.morale-=6; return "Twoja mowa była zbyt skomplikowana. Obie strony uznały, że wspierasz ich przeciwników i teraz obie cię nienawidzą.";}}
    ]
},
{
    id: 'rand_v_52', type: 'vault', title: "Dekoracje świąteczne", introduction: "Zbliża się 25 grudnia. Mieszkańcy chcą udekorować Kryptę na święta, używając złomu i kolorowych kabli.", description: "To może podnieść morale, ale też zużyć cenne materiały, które mogłyby posłużyć do napraw.",
    options:[
        {text:"Pozwól im, ale z ograniczonym budżetem na materiały.", effect:gs=>{gs.resources.scrap-=10; gs.resources.morale+=8; return "Dekoracje są skromne, ale piękne. Duch świąt zapanował w Krypcie.";}},
        {text:"Odmów. Złom jest potrzebny do ważniejszych rzeczy.", effect:gs=>{gs.resources.morale-=7; return "Zostałeś okrzyknięty Grinchem. Mieszkańcy są przygnębieni twoim brakiem świątecznego ducha.";}},
        {text:"[SIŁACZ] Zorganizuj konkurs na 'najbardziej postapokaliptyczną choinkę'.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=10; return "Twój pomysł był hitem! Choinki z rur, opon i zardzewiałej blachy stały się nową, brutalną tradycją Krypty.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Twoja wizja była zbyt... brutalna. Dekoracje wyglądały tak depresyjnie, że tylko pogorszyły nastroje.";}}
    ]
},
{
    id: 'rand_v_53', type: 'vault', title: "Plotki o tobie", introduction: "Po Krypcie zaczęła krążyć plotka, że faworyzujesz jednego z mieszkańców.", description: "To nieprawda, ale plotka żyje własnym życiem i podkopuje twoje zaufanie. Musisz zareagować.",
    options:[
        {text:"Wygłoś oficjalne dementi.", effect:gs=>{gs.resources.morale+=2; return "Twoje oświadczenie uspokoiło sytuację, chociaż niektórzy wciąż są podejrzliwi.";}},
        {text:"Zignoruj to. Ludzie zawsze będą gadać.", effect:gs=>{gs.resources.morale-=6; return "Brak reakcji został odebrany jako przyznanie się do winy. Teraz wszyscy są przekonani, że masz swoich faworytów.";}},
        {text:"[DYPLOMATA] Znajdź źródło plotki i publicznie je zdyskredytuj.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=8; return "Twoje śledztwo i błyskotliwa argumentacja obnażyły plotkarza jako kłamcę. Twój autorytet został wzmocniony.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Zaatakowałeś niewłaściwą osobę. Okazało się, że ma ona wielu przyjaciół. Teraz masz przeciwko sobie całą grupę mieszkańców.";}}
    ]
},
{
    id: 'rand_v_54', type: 'vault', title: "Problem z chrapaniem", introduction: "Jeden z mieszkańców chrapie tak głośno, że budzi całą kwaterę.", description: "Niewyspani ludzie są poirytowani i mniej wydajni. To drobny, ale uciążliwy problem.",
    options:[
        {text:"Przenieś chrapiącego do izolatki.", effect:gs=>{gs.resources.morale-=3; return "Problem rozwiązany, ale chrapiący czuje się jak wyrzutek, a inni uważają to za zbyt surową karę.";}},
        {text:"Rozdaj wszystkim zatyczki do uszu.", effect:gs=>{gs.resources.scrap-=5; return "To prowizoryczne rozwiązanie, ale działa. Ludzie są wdzięczni, że w ogóle zająłeś się sprawą.";}},
        {text:"[NAUKOWIEC] Skonstruuj 'aparat przeciw chrapaniu'.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=8; return "Twój dziwaczny, ale genialny gadżet działa! Chrapanie ustało, a ty jesteś postrzegany jako cudotwórca.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Twój prototyp spowodował zwarcie, które obudziło całą kwaterę w środku nocy. Teraz nikt cię nie lubi.";}}
    ]
},
{
    id: 'rand_v_55', type: 'vault', title: "Kapsuła czasu", introduction: "Grupa dzieci chce stworzyć 'kapsułę czasu' i zakopać ją w nieużywanym sektorze.", description: "To uroczy pomysł, który może stać się częścią historii Krypty. Ale wymaga pozwolenia i nadzoru.",
    options:[
        {text:"Zgódź się i pomóż im znaleźć bezpieczne miejsce.", effect:gs=>{gs.resources.morale+=7; return "Dzieci są zachwycone. Stworzenie kapsuły czasu było dla wszystkich wzruszającym i jednoczącym doświadczeniem.";}},
        {text:"Odmów. Nie mamy czasu na takie zabawy.", effect:gs=>{gs.resources.morale-=5; return "Złamałeś dziecięce serca. Ich rodzice są wściekli. Jesteś postrzegany jako bezduszny biurokrata.";}},
        {text:"[SIŁACZ] Zbuduj dla nich 'niezniszczalny, pancerny pojemnik'.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.scrap-=10; gs.resources.morale+=10; return "Twój pancerny pojemnik jest dziełem sztuki. Dzieci cię uwielbiają, a dorośli są pod wrażeniem twojej nieoczekiwanej delikatności.";}, failureEffect:gs=>{gs.resources.scrap-=20; return "Pojemnik był tak ciężki, że podczas przenoszenia uszkodził płytę podłogową. Naprawa będzie kosztowna.";}}
    ]
},
{
    id: 'rand_v_56', type: 'vault', title: "Dzień Żartów", introduction: "Mieszkańcy chcą zorganizować 'Dzień Prima Aprilis' i robić sobie nawzajem nieszkodliwe żarty.", description: "To może być świetna zabawa, ale też może wymknąć się spod kontroli.",
    options:[
        {text:"Zgódź się, ale wyznacz jasne zasady.", effect:gs=>{gs.resources.morale+=8; return "Dzień Żartów był hitem! Wszyscy świetnie się bawili, a dzięki twoim zasadom nikt nie ucierpiał.";}},
        {text:"Zakaż tego. Nie ma miejsca na frywolność w czasach kryzysu.", effect:gs=>{gs.resources.morale-=6; return "Twoja powaga została wyśmiana. Ludzie i tak robili sobie żarty, ale teraz głównie z ciebie.";}},
        {text:"[DYPLOMATA] Weź udział i wkręć całą Kryptę.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=15; return "Twój żart - ogłoszenie o 'inspekcji z centrali Vault-Tec' - był tak dobry, że stał się legendą! Morale poszybowało w górę.";}, failureEffect:gs=>{gs.resources.morale-=10; return "Twój żart był zbyt realistyczny. Wywołałeś prawdziwą panikę, a gdy prawda wyszła na jaw, ludzie byli na ciebie wściekli.";}}
    ]
},
{
        id: 'rand_v_57', type: 'vault', title: "Spór o imię", introduction: "Właśnie urodziło się pierwsze dziecko w Krypcie od ataku. To promyk nadziei! Ale rodzice kłócą się o imię.", description: "Matka chce tradycyjne imię 'Jan', a ojciec postapokaliptyczne 'Rad-Piorun'. Poprosili ciebie o rozstrzygnięcie sporu. Twoja decyzja wpłynie na populację.",
        options:[
            {
                text:"Zaproponuj kompromisowe imię, np. 'Adam'.", 
                effect:gs=>{
                    gs.resources.morale+=5; 
                    gs.resources.population++; 
                    gs.dwellers.push(createDweller(gs.dwellers.length));
                    return "Twoja propozycja została przyjęta. Dziecko dołącza do Krypty, a ty jesteś postrzegany jako mądry sędzia. Populacja wzrosła o 1.";
                }
            },
            {
                text:"Odmów. To nie twoja sprawa.", 
                effect:gs=>{
                    gs.resources.morale-=3; 
                    gs.resources.population++; 
                    gs.dwellers.push(createDweller(gs.dwellers.length));
                    return "Twoja bierność sprawiła, że para jest skłócona, ale dziecko i tak dołącza do społeczności. Populacja wzrosła o 1.";
                }
            },
            {
                text:"[SIŁACZ] Zdecyduj, że dziecko będzie nosić twoje imię.", 
                isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, 
                successEffect:gs=>{
                    gs.resources.morale+=8; 
                    gs.resources.population++; 
                    gs.dwellers.push(createDweller(gs.dwellers.length));
                    return "Twoja bezczelna, ale charyzmatyczna decyzja zadziałała! Rodzice, onieśmieleni, zgodzili się. Masz w Krypcie swojego imiennika. Populacja wzrosła o 1.";
                }, 
                failureEffect:gs=>{
                    gs.resources.morale-=8; 
                    gs.resources.population++; 
                    gs.dwellers.push(createDweller(gs.dwellers.length));
                    return "Twoja propozycja została odebrana jako szczyt arogancji. Rodzice zjednoczyli się w nienawiści do ciebie i nazwali dziecko 'Gbur'. Populacja wzrosła o 1.";
                }
            }]
},
{       
    id: 'rand_v_58', type: 'vault', title: "Pamiętnik", introduction: "Znalazłeś stary pamiętnik jednego z mieszkańców, który zginął podczas ataku.", description: "Możesz go oddać rodzinie, co może przynieść im ukojenie, albo ból. Możesz go też przeczytać w poszukiwaniu tajemnic.",
    options:[
        {text:"Oddaj pamiętnik rodzinie, nie czytając go.", effect:gs=>{gs.resources.morale+=5; return "Rodzina jest ci wdzięczna za ten gest. Pamiętnik pomógł im w żałobie.";}},
        {text:"Zniszcz go. Nie należy grzebać w przeszłości.", effect:gs=>{return "Pamiętnik został spalony. Jego tajemnice umarły wraz z nim.";}},
        {text:"[NAUKOWIEC] Przeczytaj go w poszukiwaniu informacji.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.machines.hydroponics.wydajnosc+=15; return "W pamiętniku były notatki o eksperymentalnej metodzie nawożenia, która poprawiła stan hydroponiki!";}, failureEffect:gs=>{gs.resources.morale-=8; return "W pamiętniku były intymne szczegóły, które wyciekły i spowodowały skandal. Jesteś obwiniany za naruszenie prywatności.";}}
    ]

},
{
    id: 'rand_v_59', type: 'vault', title: "Problem z termostatem", introduction: "W kwaterach mieszkalnych jest za zimno. Mieszkańcy skarżą się, że marzną w nocy.", description: "Podniesienie temperatury będzie kosztować dodatkową energię.",
    options:[
        {text:"Podnieś temperaturę o kilka stopni", cost:{power:10}, effect:gs=>{gs.resources.morale+=6; return "W kwaterach jest teraz ciepło i przytulnie. Mieszkańcy są wdzięczni.";}},
        {text:"Każ im spać w ubraniach.", effect:gs=>{gs.resources.morale-=7; return "Twoja rada została odebrana jako kpina. Ludzie są niewyspani, poirytowani i chorzy.";}},
        {text:"[SIŁACZ] Zorganizuj 'Wspólne Ogrzewanie' - więcej osób w jednym pokoju.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=8; return "Twój dziwaczny pomysł nieoczekiwanie zadziałał! Wspólne noce stały się okazją do integracji i opowiadania historii. Morale wzrosło.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Twój pomysł doprowadził do konfliktów o przestrzeń, chrapanie i prywatność. Ludzie są teraz jeszcze bardziej skłóceni.";}}
    ]
},
{
    id: 'rand_v_60', type: 'vault', title: "Dzień Pamięci o Powierzchni", introduction: "Jeden ze starszych mieszkańców chce zorganizować 'Dzień Pamięci o Powierzchni'.", description: "To może być ciekawa lekcja historii, albo bolesne przypomnienie o tym, co stracono.",
    options:[
        {text:"Zgódź się i zorganizuj spotkanie.", effect:gs=>{gs.resources.morale+=5; return "Opowieści o 'starym świecie' były fascynujące i dały ludziom nową perspektywę.";}},
        {text:"Zakaż tego. Przeszłość jest martwa.", effect:gs=>{gs.resources.morale-=7; return "Twoja decyzja została odebrana jako próba wymazania historii. Ludzie są oburzeni.";}},
        {text:"[DYPLOMATA] Przekształć to w opowieści o przetrwaniu.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=10; return "Twoja interwencja była mistrzowska. Zamiast płakać nad przeszłością, ludzie zaczęli dzielić się historiami o sile i przetrwaniu.";}, failureEffect:gs=>{gs.resources.morale-=10; return "Twoja próba zmiany tematu tylko rozzłościła starszych. Opowieści zamieniły się w festiwal narzekania, co drastycznie obniżyło morale.";}}
    ]
},
{
    id: 'rand_v_61', type: 'vault', title: "Prośba o zwierzę domowe", introduction: "Grupa mieszkańców chce założyć małą hodowlę nie-zmutowanych chomików jako zwierząt domowych.", description: "To może podnieść morale, ale chomiki będą zużywać niewielkie ilości jedzenia i wody.",
    options:[
        {text:"Zgódź się, ale przydziel im ścisły budżet żywnościowy.", effect:gs=>{gs.resources.morale+=8; return "Chomiki stały się ulubieńcami Krypty! Ich obecność ma niesamowicie terapeutyczny wpływ na morale.";}},
        {text:"Odmów. Nie karmimy gryzoni.", effect:gs=>{gs.resources.morale-=6; return "Odmówiłeś. Mieszkańcy są rozczarowani twoim brakiem empatii.";}},
        {text:"[NAUKOWIEC] Zgódź się, ale pod warunkiem prowadzenia badań.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; return "Hodowla dostarcza ci cennych danych na temat wpływu diety Krypty na organizmy żywe. I są urocze.";}, failureEffect:gs=>{gs.resources.food-=15; return "Chomiki rozmnożyły się w niekontrolowany sposób i uciekły, wyjadając dziurę w zapasach żywności.";}}
    ]
},
{
    id: 'rand_v_62', type: 'vault', title: "Przedwojenne Automaty", introduction: "W zapomnianym sektorze rekreacyjnym znaleziono kilka automatów do gier typu 'jednoręki bandyta'.", description: "Są zepsute, ale można je naprawić. To może być źródło rozrywki... i dochodu dla Krypty.",
    options:[
        {text:"Napraw je i udostępnij mieszkańcom", cost:{scrap:25}, effect:gs=>{gs.resources.morale+=5; gs.resources.caps+=7; return "<strong class='good'>ZDOBYCZ: 7 kapsli.</strong> Automaty działają! Mieszkańcy chętnie wrzucają do nich swoje oszczędności, a ty zbierasz zyski.";}},
        {text:"Zostaw je w spokoju.", effect:gs=>{gs.resources.morale-=3; return "Wieść o automatach rozeszła się po Krypcie. Ludzie są rozczarowani, że nie chcesz ich naprawić.";}},
        {text:"[NAUKOWIEC] Zmodyfikuj je, by miały większy 'współczynnik wygranej' dla domu.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.scrap-=10; gs.resources.caps+=10; return "<strong class='good'>ZDOBYCZ: 10 kapsli.</strong> Twoje 'ulepszenia' sprawiły, że automaty są maszynką do robienia pieniędzy. Nikt nic nie zauważył.";}, failureEffect:gs=>{gs.resources.caps-=20; return "Twoje modyfikacje były zbyt oczywiste. Ludzie zauważyli, że automaty oszukują i musiałes im zwrócić pieniądze z nawiązką.";}}
    ]
},
{
    id: 'rand_v_63', type: 'vault', title: "Kryjówka Hazardzisty", introduction: "Podczas inspekcji znaleziono ukrytą skrytkę należącą do jednego z karciarzy.", description: "W środku jest spora suma kapsli i talia znaczonych kart. Możesz je zarekwirować.",
    options:[
        {text:"Zarekwirować wszystko dla dobra Krypty.", effect:gs=>{gs.resources.caps+=15; return "<strong class='good'>ZDOBYCZ: 20 kapsli.</strong> Kapsle trafiły do skarbca. Hazardzista jest wściekły, ale nie może nic zrobić.";}},
        {text:"Zignoruj to. Nie twoja sprawa.", effect:gs=>{gs.resources.morale-=4; return "Hazardzista, czując się bezkarny, ograł kilku mieszkańców do ostatniego kapsla, co spowodowało kłótnie.";}},
        {text:"[DYPLOMATA] Zaszantażuj hazardzistę.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=25; return "<strong class='good'>ZDOBYCZ: 25 kapsli.</strong> 'Albo oddajesz wszystko i jeszcze dokładasz, albo wszyscy dowiedzą się o twoich znaczonych kartach'. Zapłacił bez wahania.";}, failureEffect:gs=>{gs.resources.caps-=20; return "Twoja próba szantażu spaliła na panewce. Hazardzista narobił tyle hałasu, że musiałeś mu oddać część swoich kapsli, żeby się zamknął.";}}
    ]
},
{
    id: 'rand_v_64', type: 'vault', title: "Konkurs na 'Wynalazek Krypty'", introduction: "Były inżynier proponuje konkurs na najbardziej użyteczny wynalazek zrobiony ze złomu.", description: "To może stymulować kreatywność i dać nam nowe, przydatne gadżety. Nagrodą mają być kapsle.",
    options:[
        {text:"Zgódź się i ufunduj nagrodę", cost:{caps:30}, effect:gs=>{gs.resources.scrap+=20; gs.resources.morale+=5; return "<strong class='good'>ZDOBYCZ: 20 złomu.</strong> Jeden z wynalazków okazał się być super-wydajnym narzędziem do odzyskiwania złomu!";}},
        {text:"Odmów. Złom jest zbyt cenny, by go marnować.", effect:gs=>{gs.resources.morale-=5; return "Mieszkańcy są rozczarowani. Uważają, że tłamsisz w nich innowacyjność.";}},
        {text:"[NAUKOWIEC] Zostań jurorem i przywłaszcz sobie najlepsze pomysły.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.machines.powerGenerator.maxEfficiency+=0.05; return "<strong class='good'>BONUS: +5% do maks. efektywności generatora.</strong> 'Udoskonaliłeś' jeden z projektów, tworząc system, który optymalizuje zużycie energii.";}, failureEffect:gs=>{gs.resources.scrap-=25; return "Twoje 'ulepszenia' okazały się katastrofą. Jeden z prototypów wybuchł, niszcząc cenny złom.";}}
    ]
},
{
    id: 'rand_v_65', type: 'vault', title: "Prywatne lekcje strzelania", introduction: "Szef ochrony oferuje prywatne lekcje strzelania dla mieszkańców za drobną opłatą w kapslach.", description: "To podniesie umiejętności obronne, ale też oznacza, że więcej ludzi będzie umiało posługiwać się bronią, co może być niebezpieczne.",
    options:[
        {text:"Pozwól mu, ale pobieraj 'podatek' od jego zarobków.", effect:gs=>{gs.resources.morale+=3; gs.resources.caps+=15; return "<strong class='good'>ZDOBYCZ: 15 kapsli.</strong> Mieszkańcy chętnie płacą za lekcje, a ty zarabiasz na prowizji. Wszyscy są zadowoleni.";}},
        {text:"Zakaż tego. Broń jest tylko dla ochrony.", effect:gs=>{gs.resources.morale-=5; return "Twoja decyzja została odebrana jako próba utrzymania monopolu na siłę. Mieszkańcy czują się bezbronni.";}},
        {text:"[SIŁACZ] Przejmij interes i zaoferuj 'lepsze' lekcje.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; gs.resources.caps+=20; return "<strong class='good'>ZDOBYCZ: 20 kapsli.</strong> Twoje brutalne, ale skuteczne metody treningowe stały się legendarne. Wszyscy chcą uczyć się od ciebie.";}, failureEffect:gs=>{gs.resources.stimpaks-=1; return "Podczas pokazu jeden z mieszkańców przypadkowo postrzelił cię w nogę. Musiałeś zużyć Stimpaka.";}}
    ]
},
{
    id: 'rand_v_66', type: 'vault', title: "System nagłośnieniowy", introduction: "System P.A. może być użyty do odtwarzania muzyki. Jeden z mieszkańców ma kolekcję starych taśm.", description: "Muzyka podniesie morale, ale trzeba stworzyć 'radio', co kosztuje.",
    options:[
        {text:"Zainwestuj w 'Radio Krypta'", cost:{scrap:15}, effect:gs=>{gs.resources.morale+=10; return "Radio jest hitem! Muzyka wypełnia korytarze, a morale rośnie.";}},
        {text:"Zignoruj prośbę. Cisza jest lepsza.", effect:gs=>{gs.resources.morale-=4; return "Mieszkańcy są rozczarowani. Monotonia życia w ciszy staje się przytłaczająca.";}},
        {text:"[DYPLOMATA] Zorganizuj audycję z 'życzeniami za kapsle'.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=8; gs.resources.caps+=10; return "<strong class='good'>ZDOBYCZ: 10 kapsli.</strong> Twoja audycja radiowa to żyła złota! Ludzie płacą za dedykacje i pozdrowienia.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Twoja audycja okazała się nudna i nikt nie chciał płacić za życzenia. Straciłeś tylko czas.";}}
    ]
},
{
    id: 'rand_v_67', type: 'vault', title: "Odkrycie hydroponiczne", introduction: "Jeden z botaników odkrył, że pewna odmiana grzybów rośnie niezwykle szybko, jeśli podlewa się ją Nuka-Colą.", description: "To może być rewolucja w produkcji żywności, ale wymagałoby to poświęcenia cennych kapsli na zakup napojów od handlarzy.",
    options:[
        {text:"Zainwestuj w eksperyment ", cost:{caps:20}, effect:gs=>{gs.resources.food+=10; return "<strong class='good'>ZDOBYCZ: 10 żywności.</strong> Eksperyment się udał! Grzyby urosły w ekspresowym tempie.";}},
        {text:"Odrzuć pomysł. Nie marnujemy kapsli na takie bzdury.", effect:gs=>{gs.resources.morale-=3; return "Botanicy są zawiedzeni. Uważają, że blokujesz postęp naukowy.";}},
        {text:"[NAUKOWIEC] Spróbuj zsyntetyzować składnik Nuka-Coli.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.food+=12; return "<strong class='good'>ZDOBYCZ: 12 żywności.</strong> Udało ci się! Stworzyłeś 'nawóz', który działa jeszcze lepiej niż Nuka-Cola. Produkcja żywności eksplodowała!";}, failureEffect:gs=>{gs.resources.food-=15; return "Twoja synteza była błędna. Stworzyłeś toksynę, która zniszczyła część upraw.";}}
    ]
},
{
    id: 'rand_v_68', type: 'vault', title: "Prywatny detektyw", introduction: "Jeden z mieszkańców, fan przedwojennych kryminałów, ogłosił się 'prywatnym detektywem' i oferuje swoje usługi za kapsle.", description: "Rozwiązuje drobne spory i kradzieże. Możesz go uznać za część systemu prawnego, albo zakazać mu działalności.",
    options:[
        {text:"Uznaj jego działalność i pobieraj licencję ", cost:{caps:10}, effect:gs=>{gs.resources.morale+=5; gs.resources.caps+=15; return "<strong class='good'>ZDOBYCZ: 15 kapsli netto.</strong> 'Agencja Detektywistyczna Krypty' działa prężnie, a ty zarabiasz na licencji i podatkach.";}},
        {text:"Zakaż mu działalności. Tylko ty jesteś prawem.", effect:gs=>{gs.resources.morale-=5; return "Mieszkańcy są niezadowoleni. Uważają, że tłamsisz w nich inicjatywę.";}},
        {text:"[DYPLOMATA] Zatrudnij go jako swojego 'informatora'.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=3; return "Masz teraz oczy i uszy w całej Krypcie. Wiesz o każdym spisku, zanim się zacznie. Twoja władza jest bezpieczniejsza.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Okazało się, że był podwójnym agentem i sprzedawał informacje o tobie twoim przeciwnikom. Twój autorytet ucierpiał.";}}
    ]
},
{
    id: 'rand_v_69', type: 'vault', title: "Turniej szachowy", introduction: "Grupa intelektualistów chce zorganizować wielki turniej szachowy z wpisowym w kapslach.", description: "To pokojowa rozrywka, która może przynieść zyski, ale też zrodzić nowe konflikty.",
    options:[
        {text:"Zgódź się i zapewnij nagrody", cost:{caps:20}, effect:gs=>{gs.resources.morale+=8; return "Turniej był eleganckim i intelektualnym wydarzeniem. Morale wzrosło.";}},
        {text:"Odmów. Nie ma czasu na takie zabawy.", effect:gs=>{gs.resources.morale-=5; return "Intelektualiści są obrażeni. Uważają, że cenisz tylko siłę fizyczną.";}},
        {text:"[NAUKOWIEC] Weź udział i ograj wszystkich.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=20; return "<strong class='good'>ZDOBYCZ: 20 kapsli.</strong> Twoja analityczna wyższość była miażdżąca. Wygrałeś cały turniej i zgarnąłeś pulę nagród.";}, failureEffect:gs=>{gs.resources.caps-=25; return "Przeceniłeś swoje umiejętności. Jeden ze starych techników okazał się być arcymistrzem. Przegrałeś wpisowe i zostałeś upokorzony.";}}
    ]
},
{
    id: 'rand_v_70', type: 'vault', title: "Krypta-Teatr", introduction: "Grupa mieszkańców chce założyć amatorski teatr i wystawiać sztuki.", description: "To może być wspaniała forma kultury, ale wymaga materiałów na scenografię i kostiumy.",
    options:[
        {text:"Zgódź się i sfinansuj pierwszy spektakl", cost:{scrap:15}, effect:gs=>{gs.resources.morale+=10; return "Przedstawienie było hitem! Ludzie śmiali się i płakali. To było to, czego potrzebowali.";}},
        {text:"Odmów. Złom jest potrzebny do napraw.", effect:gs=>{gs.resources.morale-=6; return "Mieszkańcy są rozczarowani. Krypta staje się miejscem bez duszy.";}},
        {text:"[DYPLOMATA] Napisz sztukę propagandową na swoją cześć.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=12; return "Sztuka 'Nadzorca, Który Ocalił Wszystkich' okazała się być wzruszającym hitem. Twoja popularność szybuje w górę.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Sztuka była tak nachalną propagandą, że stała się pośmiewiskiem. Ludzie teraz żartują z twojego ego.";}}
    ]
},
{
    id: 'rand_v_71', type: 'vault', title: "Odkrycie archeologiczne", introduction: "Podczas rozbudowy magazynu, robotnicy natrafili na zapieczętowaną część Krypty z czasów przedwojennych.", description: "To może być skarbnica wiedzy i zasobów, albo grobowiec pełen niebezpieczeństw.",
    options:[
        {text:"Wyślij profesjonalną ekipę zwiadowczą", cost:{caps:20}, effect:gs=>{gs.resources.scrap+=40; return "<strong class='good'>ZDOBYCZ: 40 złomu.</strong> W środku był magazyn z częściami zamiennymi do starych modeli robotów.";}},
        {text:"Zapieczętuj to z powrotem. Lepiej nie ryzykować.", effect:gs=>{return "Tajemnica pozostanie tajemnicą. Bezpieczeństwo jest najważniejsze.";}},
        {text:"[SIŁACZ] Poprowadź ekspedycję osobiście.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.weapons.rifle++; return "<strong class='good'>ZDOBYCZ: 1 Karabin.</strong> W środku była stara zbrojownia ochrony z doskonale zachowanym karabinem bojowym!";}, failureEffect:gs=>{gs.resources.stimpaks-=1; return "W środku były pułapki. Wróciłeś ranny i musiałeś zużyć Stimpaka.";}}
    ]
},
{
    id: 'rand_v_72', type: 'vault', title: "Problem z dystrybucją wody", introduction: "Ciśnienie wody w kwaterach na wyższych poziomach jest bardzo niskie.", description: "Problem leży w starej pompie. Można ją wymienić, albo spróbować zwiększyć moc, ryzykując awarię.",
    options:[
        {text:"Wymień pompę na nową", cost:{scrap:25}, effect:gs=>{return "Nowa pompa działa idealnie. Wszyscy mają równe ciśnienie wody.";}},
        {text:"Zignoruj to. Niech ci z góry noszą wodę w wiadrach.", effect:gs=>{gs.resources.morale-=7; return "Mieszkańcy wyższych poziomów są wściekli. Czują się jak obywatele drugiej kategorii.";}},
        {text:"[NAUKOWIEC] Spróbuj skalibrować starą pompę.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.water+=15; return "<strong class='good'>ZDOBYCZ: 15 wody.</strong> Twoja kalibracja nie tylko wyrównała ciśnienie, ale i zmniejszyła straty wody w systemie!";}, failureEffect:gs=>{gs.resources.water-=30; return "Próba kalibracji zakończyła się pęknięciem rury. Straciliście mnóstwo wody, zanim udało się ją zatamować.";}}
    ]
},
{
    id: 'rand_v_73', type: 'vault', title: "Prywatna klinika", introduction: "Główny medyk chce otworzyć małą, prywatną klinikę, gdzie za kapsle będzie oferował 'dodatkowe' usługi - masaże, porady itp.", description: "To może być źródło dochodu, ale też może prowadzić do nierównego traktowania mieszkańców.",
    options:[
        {text:"Odrzuć pomysł. Opieka medyczna jest dla wszystkich.", effect:gs=>{gs.resources.morale-=4; return "Medyk jest rozczarowany. Uważa, że tłamsisz jego przedsiębiorczość.";}},
        {text:"Zgódź się, ale pobieraj wysoką opłatę licencyjną.", effect:gs=>{gs.resources.caps+=20; return "<strong class='good'>ZDOBYCZ: 20 kapsli.</strong> Klinika działa, a ty zarabiasz na licencji. Bogatsi mieszkańcy są zadowoleni.";}},
        {text:"[DYPLOMATA] Stwórz 'Fundusz Zdrowia', do którego wszyscy się dokładają.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=8; gs.resources.stimpaks++; return "<strong class='good'>ZDOBYCZ: 1 Stimpak.</strong> Twój pomysł na publiczną służbę zdrowia okazał się hitem! Z zebranych składek udało się nawet kupić dodatkowego Stimpaka.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Twój pomysł na 'obowiązkowe składki' został odebrany jako zwykły haracz. Ludzie są wściekli.";}}
    ]
},
{
    id: 'rand_v_74', type: 'vault', title: "Hodowla świecących grzybów", introduction: "Botanicy odkryli odmianę grzybów, która emituje słabe, ale stałe światło.", description: "Można je wykorzystać do oświetlenia korytarzy, co oszczędzi energię, ale ich zarodniki mogą być szkodliwe.",
    options:[
        {text:"Zainwestuj w bezpieczne pojemniki i rozpocznij hodowlę", cost:{scrap:20}, effect:gs=>{gs.resources.power+=10; return "<strong class='good'>BONUS: +10 energii dziennie! (Fabularnie)</strong> Grzyby oświetlają korytarze, odciążając generator.";}},
        {text:"Zakaż hodowli. Zbyt ryzykowne.", effect:gs=>{return "Bezpieczeństwo jest najważniejsze. Pomysł został odrzucony.";}},
        {text:"[NAUKOWIEC] Spróbuj wyizolować gen luminescencji.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.power+=15; return "<strong class='good'>BONUS: +15 energii dziennie! (Fabularnie)</strong> Udało ci się! Stworzyłeś farbę luminescencyjną, która jest w 100% bezpieczna i jeszcze bardziej wydajna!";}, failureEffect:gs=>{gs.resources.morale-=5; return "Eksperyment się nie udał. Zarodniki wydostały się z laboratorium, powodując halucynacje u kilku mieszkańców.";}}
    ]
},
{
    id: 'rand_v_75', type: 'vault', title: "Stary projektor filmowy", introduction: "Znaleziono stary projektor i kilka taśm filmowych. Można zorganizować seans.", description: "To podniesie morale, ale projektor jest stary i zużywa mnóstwo energii.",
    options:[
        {text:"Zorganizuj seans", cost:{power:25}, effect:gs=>{gs.resources.morale+=12; return "Film był hitem! Mieszkańcy dawno nie byli tak zrelaksowani.";}},
        {text:"Zostaw go. Nie stać nas na marnowanie energii.", effect:gs=>{gs.resources.morale-=5; return "Mieszkańcy są rozczarowani. Potrzebowali tej odskoczni od rzeczywistości.";}},
        {text:"[DYPLOMATA] Zorganizuj seans 'biletowany'.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=8; gs.resources.caps+=15; return "<strong class='good'>ZDOBYCZ: 15 kapsli.</strong> Ludzie chętnie zapłacili za bilet na jedyną rozrywkę w Krypcie. Zarobiłeś, a oni i tak byli zadowoleni.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Twój pomysł na bilety został wyśmiany. Ludzie zbojkotowali seans, a ty wyszedłeś na chciwego tyrana.";}}
    ]
},
{
    id: 'rand_v_76', type: 'vault', title: "Plotki o skarbie", introduction: "Po Krypcie krąży plotka, że stary Nadzorca ukrył gdzieś swój prywatny zapas kapsli.", description: "Możesz zorganizować poszukiwania, co może się opłacić, albo wywołać chaos i zniszczenia.",
    options:[
        {text:"Zignoruj to. To tylko głupie plotki.", effect:gs=>{gs.resources.morale-=4; return "Ludzie są rozczarowani. Wierzyli, że skarb istnieje i mógłby im pomóc.";}},
        {text:"Pozwól ludziom szukać na własną rękę.", effect:gs=>{gs.machines.waterPurifier.wydajnosc-=10; return "Poszukiwania przerodziły się w chaos. Ktoś w poszukiwaniu 'skarbu' uszkodził system filtracji wody.";}},
        {text:"[SIŁACZ] Zmuś kilku 'podejrzanych' do wyjawienia prawdy.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=20; return "<strong class='good'>ZDOBYCZ: 20 kapsli.</strong> Okazało się, że to nie była plotka. Jeden z techników wiedział, gdzie Nadzorca trzymał 'czarną kasę'.";}, failureEffect:gs=>{gs.resources.morale-=10; return "Pobiłeś niewinnych ludzi. Skarbu nie było, a ty jesteś teraz postrzegany jako paranoiczny brutal.";}}
    ]
},
{
    id: 'rand_v_77', type: 'vault', title: "Spór o grządki", introduction: "Dwóch rolników kłóci się o najlepsze grządki w hydroponice, co opóźnia sadzenie.", description: "Możesz zainstalować dodatkowe oświetlenie, by rozwiązać problem, ale będzie to kosztować energię.",
    options:[
        {text:"Zainstaluj nowe lampy", cost:{power:25}, effect:gs=>{gs.resources.morale+=5; return "Nowe lampy rozwiązały spór. Obaj rolnicy są zadowoleni.";}},
        {text:"Rozkaż im się pogodzić.", effect:gs=>{gs.resources.food-=15; gs.resources.morale-=4; return "Twoja interwencja tylko pogorszyła sprawę. W akcie buntu posadzili mniej sadzonek.";}},
        {text:"[SIŁACZ] Zagroź, że obaj trafią do czyszczenia filtrów, na pokaz siły.", isClassSpecific: true, classCheck: 'Siłacz', cost:{food:5}, successEffect:gs=>{gs.resources.morale+=3; return "Twoja groźba podziałała. Pracują teraz ramię w ramię ze strachu.";}, failureEffect:gs=>{gs.resources.morale-=6; return "Oskarżyli cię o tyranię. Morale w hydroponice spadło.";}}
    ]
},
{
    id: 'rand_v_78', type: 'vault', title: "Syntetyczna kawa", introduction: "Naukowiec chce stworzyć substytut kawy. Potrzebuje czystej wody do destylacji.", description: "Kawa mogłaby podnieść morale zmęczonych pracowników.",
    options:[
        {text:"Przydziel wodę na eksperyment", cost:{water:15}, effect:gs=>{gs.resources.morale+=10; return "Udało się! 'Krypto-Kawa' jest hitem i podnosi morale na porannych zmianach.";}},
        {text:"Odmów. Woda jest zbyt cenna.", effect:gs=>{gs.resources.morale-=3; return "Naukowiec jest zawiedziony, a mieszkańcy wciąż marzą o kawie.";}},
        {text:"[NAUKOWIEC] Zoptymalizuj proces zużywając mniej wody .", isClassSpecific: true, classCheck: 'Naukowiec', cost:{water:10}, successEffect:gs=>{gs.resources.morale+=12; return "Twój wkład był kluczowy! 'Krypto-Kawa' jest jeszcze lepsza i zużyliście mniej wody.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Twój pomysł doprowadził do powstania napoju o smaku błota.";}}
    ]
},
{
    id: 'rand_v_79', type: 'vault', title: "Test systemu przeciwpożarowego", introduction: "Szef ochrony nalega na pełny test systemu zraszaczy. Zużyje to ogromne ilości wody.", description: "Test zapewni bezpieczeństwo, ale kosztem cennych zasobów.",
    options:[
        {text:"Zgódź się na test", cost:{water:30}, effect:gs=>{gs.resources.morale+=7; return "System działa bez zarzutu. Mieszkańcy czują się bezpieczniej.";}},
        {text:"Przeprowadź tylko suchy test.", effect:gs=>{gs.resources.morale-=5; gs.resources.power-=10; return "Podczas testu 'na sucho' doszło do zwarcia, które uszkodziło generator.";}},
        {text:"[DYPLOMATA] Zorganizuj ćwiczenia jako 'festiwal wodny' .", isClassSpecific: true, classCheck: 'Dyplomata', cost:{water:20}, successEffect:gs=>{gs.resources.morale+=10; return "Genialne! Ludzie świetnie się bawili, a ty przetestowałeś system przy niższym koszcie wody.";}, failureEffect:gs=>{gs.resources.morale-=6; return "Nikt nie dał się nabrać. Uznali to za marnotrawstwo i kpinę.";}}
    ]
},
{
    id: 'rand_v_80', type: 'vault', title: "Hodowla glonów", introduction: "Rolnicy proponują założenie hodowli pożywnych glonów. Wymaga to stałego zasilania.", description: "To nowe źródło jedzenia, ale stały koszt energii.",
    options:[
        {text:"Zainwestuj w hodowlę .", cost:{power:20}, effect:gs=>{gs.resources.food+=10; gs.resources.morale+=2; return "Hodowla glonów działa. Zyskałeś stabilne, choć niesmaczne, źródło pożywienia.";}},
        {text:"Odrzuć pomysł. Energia jest priorytetem.", effect:gs=>{gs.resources.morale-=2; return "Pomysł został odrzucony. Tracisz szansę na zwiększenie produkcji żywności.";}},
        {text:"[NAUKOWIEC] Zoptymalizuj lampy .", isClassSpecific: true, classCheck: 'Naukowiec', cost:{power:10}, successEffect:gs=>{gs.resources.food+=15; return "Twoja optymalizacja zmniejszyła koszt energetyczny, a plony są większe! Świetna inwestycja.";}, failureEffect:gs=>{gs.resources.power-=25; return "Próba optymalizacji spaliła lampy. Straciłeś więcej energii na naprawy.";}}
    ]
},
{
    id: 'rand_v_81', type: 'vault', title: "Sterylizacja narzędzi medycznych", introduction: "Medyk informuje, że autoklaw do sterylizacji narzędzi wymaga uruchomienia pełnego cyklu.", description: "Bez tego rośnie ryzyko infekcji.",
    options:[
        {text:"Uruchom cykl .", cost:{power:28}, effect:gs=>{gs.resources.morale+=5; return "Narzędzia są sterylne. Mieszkańcy czują się bezpieczniej w ambulatorium.";}},
        {text:"Zdezynfekujcie narzędzia chemicznie .", cost:{water:10}, effect:gs=>{gs.resources.stimpaks-=1; gs.resources.morale-=3; return "Prowizoryczna dezynfekcja zniszczyła jednego cennego Stimpaka.";}},
        {text:"[SIŁACZ] Zmuś medyka, by pracował z narzędziami po zwykłym myciu .", isClassSpecific: true, classCheck: 'Siłacz', effect:gs=>{gs.resources.morale-=5; if(Math.random() < 0.2){gs.resources.population--; gs.dwellers.splice(0,1); gs.resources.morale-=15; return "Pacjent zmarł z powodu infekcji. Twoja decyzja kosztowała życie.";} else {return "Oszczędziłeś energię, ale morale personelu medycznego spadło. Na szczęście nikt nie zachorował... tym razem.";}}}
    ]
},
{
    id: 'rand_v_82', type: 'vault', title: "Dzień prania", introduction: "Mieszkańcy skarżą się na brudne kombinezony. Zorganizowanie 'dnia prania' zużyje dużo wody i energii.", description: "Czyste ubrania to wyższe morale.",
    options:[
        {text:"Zorganizuj pranie .", cost:{water:20, power:15}, effect:gs=>{gs.resources.morale+=12; return "Wszyscy mają czyste kombinezony! Morale znacznie wzrosło.";}},
        {text:"Każ im prać ręcznie w zimnej wodzie.", effect:gs=>{gs.resources.morale-=7; return "Twoja decyzja została odebrana jako okrucieństwo.";}},
        {text:"[DYPLOMATA] Ogłoś to 'świętem wspólnoty' .", isClassSpecific: true, classCheck: 'Dyplomata', cost:{water:15, power:10}, successEffect:gs=>{gs.resources.morale+=15; return "Twój entuzjazm zadziałał! Wszyscy pomagali sobie nawzajem, a zużycie zasobów było mniejsze.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Nikt nie dał się nabrać na twoje przemowy. Uznali to za próbę manipulacji.";}}
    ]
},
{
    id: 'rand_v_83', type: 'vault', title: "Konkurs na najczystszą kwaterę", introduction: "Mieszkaniec proponuje konkurs na najczystszą kwaterę, z nagrodą w postaci dodatkowych racji żywnościowych.", description: "To podniesie morale i higienę, ale kosztem jedzenia.",
    options:[
        {text:"Ufunduj nagrodę .", cost:{food:22}, effect:gs=>{gs.resources.morale+=9; return "Konkurs był hitem! Krypta lśni, a zwycięzca jest zachwycony nagrodą.";}},
        {text:"Odmów. Nie marnujemy jedzenia na nagrody.", effect:gs=>{gs.resources.morale-=5; return "Pomysł upadł, a inicjator konkursu jest na ciebie zły.";}},
        {text:"[SIŁACZ] Ogłoś, że przegrany będzie szorował latryny .", isClassSpecific: true, classCheck: 'Siłacz', cost:{water:5}, successEffect:gs=>{gs.resources.morale+=6; return "Motywacja strachem zadziałała! Wszyscy wysprzątali swoje kwatery na błysk.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Twoja groźba wywołała bunt. Nikt nie wziął udziału, a ty jesteś postrzegany jako tyran.";}}
    ]
},
{
    id: 'rand_v_84', type: 'vault', title: "Nawadnianie hydroponiki", introduction: "Rolnik prosi o dodatkowy cykl nawadniania, by zwiększyć wilgotność gleby. Zużyje to dodatkową wodę.", description: "Może to poprawić zbiory, ale nie ma gwarancji.",
    options:[
        {text:"Zgódź się na dodatkowe nawadnianie .", cost:{water:18}, skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; return "To była dobra decyzja! Zbiory będą nieco większe, a rolnicy zadowoleni.";}, failureEffect:gs=>{gs.resources.food-=10; gs.resources.morale-=3; return "Nadmiar wody spowodował rozwój pleśni. Część upraw została zniszczona.";}},
        {text:"Odmów. Trzymamy się harmonogramu.", effect:gs=>{gs.resources.morale-=2; return "Rolnik jest rozczarowany, ale rozumie potrzebę oszczędzania zasobów.";}},
        {text:"[NAUKOWIEC] Oblicz optymalną ilość wody .", isClassSpecific: true, classCheck: 'Naukowiec', cost:{water:10}, successEffect:gs=>{gs.resources.morale+=7; return "Twoje obliczenia były perfekcyjne! Osiągnąłeś lepszy plon przy minimalnym zużyciu wody.";}, failureEffect:gs=>{gs.resources.food-=5; gs.resources.morale-=4; return "Twoje obliczenia były błędne. Zmarnowałeś wodę, a plony były mniejsze.";}}
    ]
},
{
    id: 'rand_v_85', type: 'vault', title: "Podkręcenie reaktora", introduction: "Inżynierowie sugerują 'podkręcenie' reaktora, by naładować zapasowe akumulatory. Zużyje to wodę do chłodzenia.", description: "Więcej energii w zapasie to większe bezpieczeństwo.",
    options:[
        {text:"Zgódź się .", cost:{water:16}, effect:gs=>{gs.resources.power+=20; return "Operacja się udała. Akumulatory są doładowane, co daje nam 20 dodatkowych jednostek energii.";}},
        {text:"Odmów. Zbyt ryzykowne.", effect:gs=>{gs.resources.morale-=3; return "Reaktor pracuje normalnie, ale inżynierowie są rozczarowani brakiem zaufania.";}},
        {text:"[DYPLOMATA] Przekonaj ich, by zrobili to wydajniej .", isClassSpecific: true, classCheck: 'Dyplomata', cost:{water:10}, successEffect:gs=>{gs.resources.power+=20; return "Twoja mowa motywacyjna zadziałała! Pracowali ciężej i zużyli mniej wody do chłodzenia.";}, failureEffect:gs=>{gs.resources.morale-=7; return "Odmówili. Twój pomysł został uznany za próbę manipulacji i wtrącanie się w ich pracę.";}}
    ]
},
{
    id: 'rand_v_86', type: 'vault', title: "Urodziny mieszkańca", introduction: "Jeden z mieszkańców ma urodziny. Inni chcą zorganizować imprezę i upiec ciasto.", description: "To wymaga mąki i cukru z rzadkich zapasów (reprezentowanych jako żywność).",
    options:[
        {text:"Pozwól na imprezę .", cost:{food:12}, effect:gs=>{gs.resources.morale+=10; return "Impreza była skromna, ale wspaniała. To była chwila normalności, której wszyscy potrzebowali.";}},
        {text:"Zakaż imprezy. Nie ma czasu na świętowanie.", effect:gs=>{gs.resources.morale-=8; return "Twoja decyzja zrujnowała solenizantowi dzień i zdemotywowała resztę.";}},
        {text:"[SIŁACZ] Zorganizuj zawody siłowe zamiast imprezy .", isClassSpecific: true, classCheck: 'Siłacz', cost:{food:5}, successEffect:gs=>{gs.resources.morale+=8; return "Zawody były hitem! Zużyliście mniej jedzenia, a wszyscy świetnie się bawili.";}, failureEffect:gs=>{gs.resources.stimpaks-=1; return "Rywalizacja wymknęła się spod kontroli. Dwóch mieszkańców pobiło się tak mocno, że jeden wylądował w ambulatorium.";}}
    ]
},
{
    id: 'rand_v_87', type: 'vault', title: "Symulator treningowy", introduction: "Szef ochrony chce uruchomić stary symulator VR. To świetny trening, ale jest bardzo energochłonny.", description: "Lepsze wyszkolenie to większe bezpieczeństwo.",
    options:[
        {text:"Uruchom symulator .", cost:{power:32}, effect:gs=>{gs.resources.morale+=6; return "Sesja treningowa była sukcesem. Strażnicy czują się pewniej.";}},
        {text:"Odmów. To marnotrawstwo energii.", effect:gs=>{gs.resources.morale-=5; return "Szef ochrony jest zawiedziony. Uważa, że nie doceniasz wagi treningu.";}},
        {text:"[NAUKOWIEC] Zoptymalizuj oprogramowanie symulatora .", isClassSpecific: true, classCheck: 'Naukowiec', cost:{power:20}, successEffect:gs=>{gs.resources.morale+=8; return "Udało ci się! Symulator działa równie dobrze, zużywając znacznie mniej energii.";}, failureEffect:gs=>{gs.resources.power-=10; return "Twoja 'optymalizacja' spowodowała zwarcie. Straciłeś dodatkową energię na naprawy.";}}
    ]
},
{
    id: 'rand_v_88', type: 'vault', title: "Degustacja wody", introduction: "Technik twierdzi, że może poprawić smak wody, dodając minerały. Proces wymaga energii.", description: "Lepsza woda to szczęśliwsi mieszkańcy.",
    options:[
        {text:"Zgódź się na eksperyment .", cost:{power:15}, effect:gs=>{gs.resources.morale+=5; return "Udało się! Woda smakuje teraz znacznie lepiej.";}},
        {text:"Odmów. Woda to woda.", effect:gs=>{gs.resources.morale-=2; return "Mieszkańcy wciąż piją wodę o metalicznym posmaku.";}},
        {text:"[DYPLOMATA] Przekształć to w wydarzenie 'Nowa Woda 2.0' .", isClassSpecific: true, classCheck: 'Dyplomata', cost:{power:10}, successEffect:gs=>{gs.resources.morale+=9; return "Twoja kampania była hitem! Wszyscy są podekscytowani 'nową, ulepszoną wodą' i zużyłeś mniej energii na marketing.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Ludzie uznali to za tanią propagandę, a woda smakuje tak samo.";}}
    ]
},
{
    id: 'rand_v_89', type: 'vault', title: "System alarmowy", introduction: "Technicy chcą przeprowadzić głośny test systemu alarmowego, by sprawdzić jego zasięg. Zużyje to energię.", description: "Głośny alarm obniży morale, ale zapewni bezpieczeństwo.",
    options:[
        {text:"Przeprowadź test .", cost:{power:10}, effect:gs=>{gs.resources.morale-=5; return "Test wypadł pomyślnie, ale hałas zirytował wszystkich.";}},
        {text:"Zaufaj, że działa.", effect:gs=>{gs.resources.morale+=2; return "Postanawiasz nie denerwować mieszkańców. Docenili twoją troskę o ich spokój.";}},
        {text:"[NAUKOWIEC] Przeprowadź cichy test diagnostyczny .", isClassSpecific: true, classCheck: 'Naukowiec', cost:{power:5}, successEffect:gs=>{gs.resources.morale+=3; return "Twój test był cichy i skuteczny. System działa, a nikt nie został poirytowany.";}, failureEffect:gs=>{gs.resources.power-=15; return "Twoja metoda spowodowała zwarcie. Naprawa kosztowała dodatkową energię.";}}
    ]
},
{
    id: 'rand_v_90', type: 'vault', title: "Eksperyment Kulinarny", introduction: "Kucharz chce spróbować stworzyć nowy rodzaj chleba, używając zmutowanych drożdży. To pochłonie trochę żywności.", description: "Jeśli eksperyment się powiedzie, zyskacie nowy, smaczny produkt. Jeśli nie, stracicie cenne składniki.",
    options:[
        {text:"Pozwól mu spróbować .", cost:{food:15}, skillCheck:{}, successEffect:gs=>{gs.resources.morale+=7; return "Chleb jest pyszny! Mieszkańcy są zachwyceni nowością w menu. Kucharz jest z siebie dumny.";}, failureEffect:gs=>{gs.resources.morale-=4; return "Eksperyment się nie udał. Chleb jest twardy jak kamień. Zmarnowałeś jedzenie.";}},
        {text:"Odmów. Trzymajmy się sprawdzonych przepisów.", effect:gs=>{gs.resources.morale-=2; return "Kucharz jest rozczarowany, że nie pozwalasz mu na kreatywność.";}},
        {text:"[NAUKOWIEC] Pomóż mu w analizie drożdży.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.food-=10; gs.resources.morale+=9; return "Twoja wiedza naukowa pozwoliła idealnie dobrać proporcje. Chleb jest nie tylko smaczny, ale i bardziej pożywny. Zużyliście mniej składników.";}, failureEffect:gs=>{gs.resources.morale-=6; return "Twoje naukowe podejście zabiło całą 'magię' gotowania. Chleb nie wyrósł, a ty zostałeś obwiniony o porażkę.";}}
    ]
},
{
    id: 'rand_v_91', type: 'vault', title: "Utrzymanie Czystości w Ambulatorium", introduction: "Główny medyk prosi o dodatkową wodę do sterylizacji podłóg i narzędzi ponad standardową procedurę.", description: "Twierdzi, że zauważył niepokojące kultury bakterii. To może być nadgorliwość, ale lepiej dmuchać na zimne.",
    options:[
        {text:"Zatwierdź dodatkową sterylizację .", cost:{water:15}, effect:gs=>{gs.resources.morale+=5; return "Ambulatorium lśni sterylną czystością. Mieszkańcy czują się bezpieczniej, wiedząc, że dbasz o ich zdrowie.";}},
        {text:"Odmów. Standardowe procedury muszą wystarczyć.", effect:gs=>{gs.resources.morale-=4; return "Medyk jest niezadowolony. Uważa, że lekceważysz jego obawy i narażasz pacjentów.";}},
        {text:"[NAUKOWIEC] Zbadaj próbki bakterii.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{return "Twoja analiza wykazała, że to niegroźne bakterie. Uspokoiłeś medyka i zaoszczędziłeś wodę. Twoja wiedza się przydała.";}, failureEffect:gs=>{gs.resources.population--; gs.dwellers.splice(0,1); return "Twoja analiza była błędna. Bakteria okazała się być zmutowanym szczepem. Jeden z pacjentów zmarł z powodu infekcji.";}}
    ]
},
{
    id: 'rand_v_92', type: 'vault', title: "Konkurs na Największe Warzywo", introduction: "Rolnicy chcą zorganizować konkurs na największe wyhodowane warzywo. To wymaga dodatkowego nawożenia i podlewania.", description: "Rywalizacja może być zabawna, ale zużyje zasoby żywności (jako nawóz) i wody.",
    options:[
        {text:"Zgódź się na konkurs ", cost:{food:15, water:15}, effect:gs=>{gs.resources.morale+=9; return "Konkurs był świetną zabawą! Wyhodowano gigantyczną, zmutowaną marchew, a zwycięzca zyskał sławę w całej Krypcie.";}},
        {text:"Odmów. Zasoby są na jedzenie, nie na zabawę.", effect:gs=>{gs.resources.morale-=5; return "Rolnicy są rozczarowani. Uważają, że nie doceniasz ich ciężkiej pracy.";}},
        {text:"[SIŁACZ] Ogłoś, że nagrodą jest zwolnienie ze sprzątania na tydzień.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.food-=10; gs.resources.water-=10; gs.resources.morale+=11; return "Twoja nagroda była strzałem w dziesiątkę! Rywalizacja była zacięta, a zużyliście mniej zasobów, niż planowano.";}, failureEffect:gs=>{gs.resources.morale-=6; return "Nikt nie chciał ryzykować zasobów dla takiej nagrody. Konkurs się nie odbył.";}}
    ]
},


        
        

        // DOOR EVENTS
        {
    id: 'rand_d_1', type: 'door', title:"Pukanie do Włazu", image:"vault_door_62.jpg", introduction:"Pojedyncza, nieuzbrojona osoba błaga o schronienie.", description:"Wygląda na wyczerpaną, ale na Pustkowiach nigdy nic nie wiadomo.",
    options:[
        {text:"Wpuść ją, ale najpierw poddaj kwarantannie", cost:{food:5, water:5}, effect:gs=>{
            gs.dwellers.push(createDweller(gs.dwellers.length));
            gs.resources.population = gs.dwellers.length; // <<-- KLUCZOWA POPRAWKA
            gs.resources.morale+=5; 
            return "Nowy mieszkaniec dołączył do Krypty. Okazał się porządnym człowiekiem."
        }},
        {text:"Odmów. Nie mamy zasobów na zbyciu.", effect:gs=>{gs.resources.morale-=5; return "Odesłałeś ocalałego na pewną śmierć. Niektórzy mieszkańcy patrzą na ciebie z potępieniem."}},
        {text:"[DYPLOMATA] Przesłuchaj ją przez interkom.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{
            gs.dwellers.push(createDweller(gs.dwellers.length));
            gs.resources.population = gs.dwellers.length; // <<-- KLUCZOWA POPRAWKA
            gs.resources.morale+=7; 
            gs.resources.caps+=25; 
            return "<strong class='good'>ZDOBYCZ: 25 kapsli.</strong> Twoje pytania pozwoliły zweryfikować jej historię. Okazała się być kupcem, który zaoferował resztę kapsli w podzięce.";
        }, failureEffect:gs=>{return "Twoje pytania tylko ją wystraszyły. Uciekła, zanim podjąłeś decyzję."}}
    ]
},
{
    id: 'rand_d_2', type: 'door', title:"Ranny Ghul", image:"vault_door_62.jpg", introduction:"Przy włazie leży ranny ghul. Prosi o jednego Stimpaka.", description:"Ghule bywają nieprzewidywalne. Pomoc mu to ryzyko.",
    options:[
        {text:"Daj mu Stimpaka", cost:{stimpaks:1}, condition:gs=>gs.resources.stimpaks>0, effect:gs=>{const location = EXPEDITION_LOCATIONS[Math.floor(Math.random()*EXPEDITION_LOCATIONS.length)]; gs.resources.morale+=3; return `Ghul z wdzięcznością przyjął pomoc i zdradził lokację schowka w ${location.name}.`}},
        {text:"Zignoruj go. To nie nasz problem.", effect:gs=>{return "Pozostawiasz ghula jego losowi. Po kilku godzinach czujniki przestały wykrywać jego oznaki życia. Nic się nie stało.";}},
        {text:"[NAUKOWIEC] Zbadaj jego ranę.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.stimpaks+=1; return "<strong class='good'>ZDOBYCZ: 1 Stimpak.</strong> Okazało się, że rana jest od rzadkiego owada. Z pobranej próbki udało się zsyntetyzować dodatkowego Stimpaka.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Podczas badania ghul dostał ataku paniki i ugryzł cię. Musiałeś użyć AntyRadu, a on uciekł.";}}
    ]
},
{
    id: 'rand_d_3', type: 'door', title:"Karmazynowa Karawana", image:"vault_door_62.jpg", introduction:"Przy włazie czeka uzbrojona karawana. Ich przywódca, Cios, proponuje transakcję.", condition: gs => !gs.flags.traderKilled[2],
    options:[
        {text:"Handluj z nimi.", effect:gs=>{const post = TRADING_POSTS.find(p=>p.id===2); startTrade(post); return "Rozpoczynasz handel z Karmazynową Karawaną.";}},
        {text:"Odpraw ich.", effect:gs=>{return "Karawana odjechała, niechętnie.";}},
        {text:"[SIŁACZ] Spróbuj ich okraść.", isClassSpecific: true, classCheck:'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=35; gs.resources.weapons.pistol++; gs.resources.morale-=20; gs.flags.traderKilled[2]=true; return "<strong class='good'>ZDOBYCZ: 35 kapsli, 1 pistolet.</strong> Zasadzka powiodła się. Cios i jego ludzie nie żyli, zanim zdążyli zareagować.";}, failureEffect:gs=>{gs.resources.population-=2; gs.dwellers.splice(0,2); gs.resources.caps-=15; gs.resources.morale-=20; return "Cios przewidział Twój ruch. Straciłeś 2 ludzi i musiałeś zapłacić haracz.";}}
    ]
},
{
    id: 'rand_d_4', type: 'door', title:"Bractwo Stali", image:"vault_door_62.jpg", introduction:"Rycerz Bractwa Stali żąda oddania 'zaawansowanych technologii'.", description:"Jego ton nie pozostawia wątpliwości - to nie jest prośba.",
    options:[
        {text:"Oddaj im trochę złomu, by zaspokoić ich żądania", cost:{scrap:20}, condition:gs=>gs.resources.scrap>=20, effect:gs=>{gs.resources.morale-=5; return "Bractwo zabrało złom i odeszło. Mieszkańcy czują się ograbieni, ale bezpieczni.";}},
        {text:"Odmów. Ta Krypta należy do nas.", effect:gs=>{if(gs.resources.weapons.rifle > 0){gs.resources.morale+=10; return "Widok waszych karabinów sprawił, że rycerz przemyślał sprawę i odszedł.";} else {gs.resources.population-=3; gs.resources.power-=15; return "Twoja odmowa była głupotą. Rycerz z łatwością sforsował obronę, zabił 3 osoby i zniszczył część generatora.";}}},
        {text:"[DYPLOMATA] Spróbuj negocjować.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=22; return "<strong class='good'>ZDOBYCZ: 22 kapsli.</strong> Twoja dyplomacja zrobiła wrażenie na rycerzu. Zgodził się zostawić was w spokoju i zostawił 'grant' w kapslach na 'rozwój technologii'.";}, failureEffect:gs=>{gs.resources.morale-=10; return "Twoje próby negocjacji zostały uznane za stratę czasu. Rycerz staje się agresywny.";}}
    ]
},
{
    id: 'rand_d_5', type: 'door', title: "Wędrowny muzyk", image: "vault_door_62.jpg", introduction: "Wędrowiec z gitarą oferuje koncert w zamian za jedzenie i wodę.", description: "Jego muzyka jest piękna. To może być chwila wytchnienia.",
    options: [
        {text:"Zgódź się. Potrzebujemy tego", cost:{food:15, water:15}, effect:gs=>{gs.resources.morale+=15; return "Koncert 'Agitatora' był legendarny. Podniósł wszystkich na duchu.";}},
        {text:"Odpraw go. Nie stać nas na takie luksusy.", effect:gs=>{gs.resources.morale-=5; return "Muzyka ucichła. Mieszkańcy są rozczarowani, że odebrałeś im rzadką chwilę radości.";}},
        {text:"[DYPLOMATA] Spróbuj wynegocjować lepszą cenę.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.food-=5; gs.resources.water-=5; gs.resources.morale+=15; return "Targowałeś się jak prawdziwy kupiec. Muzyk zagrał za symboliczną opłatą, a koncert był wspaniały.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Twoja próba negocjacji obraziła artystę. Stwierdził, że 'nie gra dla skąpców' i odszedł.";}}
    ]
},
{
    id: 'rand_d_6', type: 'door', title: "Ranny szpon śmierci", image: "vault_door_62.jpg", introduction: "Przy włazie leży ranny, młody szpon śmierci.", description: "To jedna z najgroźniejszych bestii, ale umiera. Może to okazja?",
    options:[
        {text:"Dobij go z dystansu i zabierz mięso.", effect:gs=>{gs.resources.food+=12; return "<strong class='good'>ZDOBYCZ: 12 żywności.</strong> To była bezpieczna i mądra decyzja. Zapas jedzenia się przyda.";}},
        {text:"Zostaw go. Niech natura zrobi swoje.", effect:gs=>{gs.resources.morale-=3; return "Zostawiacie bestię na pewną śmierć. Po kilku godzinach przyciągnęła stado zdziczałych psów, które teraz kręcą się w okolicy.";}},
        {text:"[SIŁACZ] Spróbuj mu pomóc.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.flags.hasDeathclawGuardian = true; gs.resources.morale+=15; return "W akcie niewiarygodnej odwagi pomogłeś bestii. Od teraz jest twoim Strażnikiem!";}, failureEffect:gs=>{gs.resources.population--; gs.dwellers.splice(0,1); gs.resources.food+=30; return "To był idiotyczny pomysł. Nawet ranny szpon śmierci zabił jednego z twoich ludzi.";}}
    ]
},
{
    id: 'rand_d_7', type: 'door', title: "Handlarz złomem", image: "vault_door_62.jpg", introduction: "Staruszka z wózkiem pełnym złomu chce handlować.", description: "Oferuje wymianę dużej ilości złomu za trochę jedzenia.",
    options:[
        {text:"Handluj z nią", cost:{food:25}, effect:gs=>{gs.resources.scrap+=40; return "<strong class='good'>ZDOBYCZ: 40 złomu.</strong> Wymiana była uczciwa.";}},
        {text:"Odpraw ją. Jedzenie jest cenniejsze.", effect:gs=>{return "Staruszka wzruszyła ramionami i ruszyła w dalszą drogę. Straciłeś okazję na zdobycie cennego złomu.";}},
        {text:"[SIŁACZ] Zastrasz ją i zabierz złom.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=60; gs.resources.morale-=10; return "<strong class='good'>ZDOBYCZ: 60 złomu.</strong> Staruszka uciekła, zostawiając cały wózek. Masz złom, ale twoi ludzie widzieli, że okradłeś bezbronną staruszkę.";}, failureEffect:gs=>{gs.resources.morale-=5; gs.resources.caps-=20; return "Okazało się, że pod płaszczem staruszka ukrywa shotgun. Wystrzeliła ci pod nogi i zażądała 20 kapsli odszkodowania.";}}
    ]
},
{
    id: 'rand_d_8', type: 'door', title: "Prośba o azyl", image: "vault_door_62.jpg", introduction: "Rodzina - mężczyzna, kobieta i dziecko - błagają o schronienie.", description: "Przyjęcie trzech nowych osób to duże obciążenie dla zapasów, ale odesłanie ich to wyrok śmierci.",
    options:[
        {text:"Wpuść ich. Nie możemy ich tak zostawić.", effect:gs=>{
            gs.dwellers.push(createDweller(gs.dwellers.length), createDweller(gs.dwellers.length+1), createDweller(gs.dwellers.length+2)); 
            gs.resources.population = gs.dwellers.length; // <<-- KLUCZOWA POPRAWKA
            gs.resources.morale+=10; 
            gs.resources.food-=10; 
            return "Przyjęliście rodzinę. To duży koszt, ale morale wzrosło."
        }},
        {text:"Odmów. Krypta jest pełna.", effect:gs=>{gs.resources.morale-=15; return "Patrzyłeś przez kamerę, jak rodzina odchodzi w stronę pustkowi. Twoi ludzie nigdy ci tego nie zapomną."}},
        {text:"[DYPLOMATA] Zaproponuj im zapasy w zamian za informacje.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.food-=15; const location = EXPEDITION_LOCATIONS[Math.floor(Math.random()*EXPEDITION_LOCATIONS.length)]; return `Daliście im zapasy na drogę. W zamian wdzięczny ojciec opowiedział o ukrytym schowku w ${location.name}.`;}, failureEffect:gs=>{gs.resources.morale-=5; return "Twoja propozycja została odebrana jako okrutna. Rodzina odeszła z pogardą."}}
    ]
},
{
    id: 'rand_d_9', type: 'door', title: "Zaginiony pies", image: "vault_door_62.jpg", introduction: "Pod drzwiami Krypty siedzi samotny, wychudzony owczarek niemiecki.", description: "To tylko pies, ale na Pustkowiach nawet zwierzę może być pułapką.",
    options:[
        {text:"Wpuść go i nakarm.", effect:gs=>{gs.resources.morale+=10; gs.resources.food-=5; return "Pies okazał się przyjazny i szybko stał się ulubieńcem całej Krypty. Nazwaliście go Ochłap.";}},
        {text:"Przegoń go.", effect:gs=>{return "Pies spojrzał na ciebie smutno i odszedł. Nic się nie stało, ale jakoś tak... nieswojo.";}},
        {text:"[NAUKOWIEC] Zeskanuj go w poszukiwaniu chipów lub chorób.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=12; return "Skanowanie odkryło pod skórą mały chip z danymi o pobliskim, niewielkim składzie medycznym. Pies jest bezpieczny i przyniósł cenną informację!";}, failureEffect:gs=>{gs.resources.morale-=5; return "Twoje skanery nie są przystosowane do psiej fizjologii. Podczas skanowania przypadkowo go poraziłeś. Uciekł, a ty wyglądasz jak niekompetentny sadysta.";}}
    ]
},
{
    id: 'rand_d_10', type: 'door', title: "Zepsuty Protektron", image: "vault_door_62.jpg", introduction: "Pod drzwiami stoi zepsuty protektron policyjny, powtarzając w kółko fragmenty komunikatów.", description: "Jest niegroźny, ale blokuje wejście. Można go zniszczyć, albo spróbować naprawić.",
    options:[
        {text:"Zniszczcie go i zabierzcie części.", effect:gs=>{gs.resources.scrap+=15; return "<strong class='good'>ZDOBYCZ: 15 złomu.</strong> Robot został zdemontowany. Pozyskaliście trochę złomu.";}},
        {text:"Zostawcie go. W końcu mu się wyczerpie bateria.", effect:gs=>{gs.resources.morale-=3; return "Nie wyczerpała się. Jego ciągły bełkot irytuje strażników przy wejściu.";}},
        {text:"[NAUKOWIEC] Spróbuj go przeprogramować.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.scrap-=10; gs.resources.morale+=5; return "Udało ci się! Przeprogramowałeś protektrona, by służył jako dodatkowy strażnik przy wejściu. Mieszkańcy czują się bezpieczniej.";}, failureEffect:gs=>{gs.resources.power-=20; return "Próba przeprogramowania zakończyła się potężnym zwarciem, które przeciążyło zewnętrzne zasilanie włazu.";}}
    ]
},
{
    id: 'rand_d_11', type: 'door', title: "Dostawa Nuka-Coli", image: "vault_door_62.jpg", introduction: "Entuzjastyczny Ghul w czapce z daszkiem oferuje skrzynkę Nuka-Coli Quantum.", description: "Ta niebieska, radioaktywna lemoniada to rarytas, ale też spore ryzyko. I kosztuje.",
    options:[
        {text:"Kup skrzynkę", cost:{caps:50}, effect:gs=>{gs.resources.morale+=15; return "Nuka-Cola Quantum była hitem! Mieszkańcy byli zachwyceni, a po jej wypiciu czuli się pełni energii.";}},
        {text:"Odmów. To zbyt radioaktywne.", effect:gs=>{return "Ghul wzruszył ramionami, mówiąc 'wasza strata' i odjechał.";}},
        {text:"[SIŁACZ] 'Przekonaj' go, że dostawa jest za darmo.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=10; gs.resources.caps+=20; return "<strong class='good'>ZDOBYCZ: 20 kapsli.</strong> Ghul, widząc twoje mięśnie, szybko zrozumiał 'ofertę'. Zostawił colę i dorzucił kilka kapsli, byleś go puścił wolno.";}, failureEffect:gs=>{return "Ghul okazał się być byłym najemnikiem. Zaśmiał ci się w twarz i odjechał, pokazując ci obraźliwy gest.";}}
    ]
},
{
    id: 'rand_d_12', type: 'door', title: "Deszcz meteorytów", image: "vault_door_62.jpg", introduction: "W nocy był deszcz meteorytów. Kilka małych, dziwnych kamieni spadło niedaleko Krypty.", description: "Mogą zawierać rzadkie minerały... lub być wysoce radioaktywne.",
    options:[
        {text:"Wyślij ekipę w kombinezonach ochronnych", cost:{hazmatSuits:1}, condition:gs=>gs.resources.hazmatSuits>0, effect:gs=>{gs.resources.scrap+=30; return "<strong class='good'>ZDOBYCZ: 30 złomu.</strong> Meteoryty zawierały rzadkie stopy metali! Zdobyliśmy mnóstwo cennego złomu.";}},
        {text:"Zignoruj je. Zbyt niebezpieczne.", effect:gs=>{return "Decydujesz się nie ryzykować. Tajemnicze kamienie pozostają na pustkowiach.";}},
        {text:"[NAUKOWIEC] Wyślij zdalnie sterowanego bota.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.scrap-=5; gs.resources.power+=30; return "<strong class='good'>ZDOBYCZ: 30 energii.</strong> Analiza wykazała, że to ogniwa energetyczne z satelity! Bot je przywiózł.";}, failureEffect:gs=>{gs.resources.scrap-=10; return "Bot został uszkodzony przez nieznane promieniowanie emitowane przez skały. Straciłeś 10 jednostek złomu.";}}
    ]
},
{
    id: 'rand_d_13', type: 'door', title: "Tajemnicza skrzynia", image: "vault_door_62.jpg", introduction: "Dokładnie przed włazem ktoś zostawił dużą, metalową skrzynię z logo Vault-Tec.", description: "To może być zapomniana dostawa zaopatrzenia. Ale równie dobrze może to być bomba-pułapka.",
    options:[
        {text:"Zdetonujcie ją z daleka.", effect:gs=>{return "Wysłany ładunek wybuchowy zniszczył skrzynię. Nigdy nie dowiesz się, co było w środku, ale jesteś bezpieczny.";}},
        {text:"Otwórzcie ją ostrożnie (Ryzykowne).", skillCheck:{}, successEffect:gs=>{gs.resources.food+=10; gs.resources.water+=10; return "<strong class='good'>ZDOBYCZ: 10 żywności, 10 wody.</strong> W środku były zapasy!";}, failureEffect:gs=>{gs.machines.powerGenerator.wydajnosc-=40; return "To była bomba! Eksplozja uszkodziła zewnętrzny pancerz włazu i generatory!";}},
        {text:"[NAUKOWIEC] Przeskanuj skrzynię przed otwarciem.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.stimpaks+=5; return "<strong class='good'>ZDOBYCZ: 5 Stimpaków.</strong> Skaner wykrył, że to pojemnik medyczny. W środku było 5 cennych Stimpaków.";}, failureEffect:gs=>{gs.machines.waterPurifier.wydajnosc-=30; return "Skaner przypadkowo aktywował mechanizm obronny. Skrzynia uwolniła impuls elektromagnetyczny, który uszkodził oczyszczalnię wody.";}}
    ]
},
{
    id: 'rand_d_14', type: 'door', title: "Posłaniec z RNK", image: "vault_door_62.jpg", introduction: "Żołnierz z Republiki Nowej Kalifornii ma propozycję.", description: "RNK proponuje 'ochronę' i włączenie Krypty do Republiki w zamian za regularny 'podatek' w postaci żywności.",
    options:[
        {text:"Odmów. Jesteśmy niezależni.", effect:gs=>{return "Żołnierz skinął głową i odszedł, mówiąc 'pożałujecie tego'. W powietrzu wisi groźba.";}},
        {text:"Zgódź się płacić podatek", cost:{food:30}, effect:gs=>{gs.resources.morale-=10; return "Zgodziłeś się. Co jakiś czas będziesz musiał oddawać część zapasów. Mieszkańcy nie są zadowoleni.";}},
        {text:"[DYPLOMATA] Spróbuj wynegocjować status partnera handlowego.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; gs.resources.caps+=20; return "<strong class='good'>ZDOBYCZ: 20 kapsli.</strong> Twoja dyplomacja zaimponowała posłańcowi. Zamiast podatku, RNK zaproponowało umowę handlową i zapłaciło z góry.";}, failureEffect:gs=>{gs.resources.food-=40; return "Twoje negocjacje zostały uznane za próbę oszustwa. Żołnierz zażądał podwójnego podatku jako kary.";}}
    ]
},
{
    id: 'rand_d_15', type: 'door', title: "Prośba o wodę", image:"vault_door_62.jpg", introduction: "Przez interkom odzywa się kobieta, która twierdzi, że jej mała osada umiera z pragnienia.", description: "Jej głos brzmi desperacko. To może być pułapka, ale jeśli mówi prawdę, skazujesz ludzi na śmierć.",
    options:[
        {text:"Daj im trochę wody", cost:{water:20}, effect:gs=>{gs.resources.morale+=5; return "Wysłaliście wodę. Kilka dni później znaleźliście przy włazie mały woreczek z nasionami w podzięce.";}},
        {text:"Odmów. Woda jest tylko dla nas.", effect:gs=>{gs.resources.morale-=8; return "Odmówiłeś. Twoi ludzie słyszeli jej błagania. Wielu z nich nie może spojrzeć ci w oczy.";}},
        {text:"[SIŁACZ] Wyjdź i 'przesłuchaj' ją.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.water-=10; gs.resources.caps+=20; return "<strong class='good'>ZDOBYCZ: 20 kapsli.</strong> Okazało się, że to była zwiadowczyni karawany. Twoja postawa tak jej zaimponowała, że zapłaciła za wodę.";}, failureEffect:gs=>{gs.resources.morale-=5; return "To była zasadzka! Czekała na ciebie grupka bandytów. Udało wam się odeprzeć atak, ale straciliście amunicję i nerwy.";}}
    ]
},
{
    id: 'rand_d_16', type: 'door', title: "Dziwny sygnał radiowy", image:"vault_door_62.jpg", introduction: "Komunikator odebrał słaby, powtarzający się sygnał - to przedwojenny kod SOS.", description: "Wzmocnienie go zużyje dużo energii i może przyciągnąć niechcianą uwagę.",
    options:[
        {text:"Zignoruj sygnał.", effect:gs=>{return "Sygnał ucichł na zawsze. Nigdy nie dowiesz się, kto go wysyłał.";}},
        {text:"Wzmocnij sygnał za wszelką cenę", cost:{power:30}, skillCheck:{}, successEffect:gs=>{const location = EXPEDITION_LOCATIONS[Math.floor(Math.random()*EXPEDITION_LOCATIONS.length)]; return `Udało się! Namierzyliście źródło sygnału - to automatyczny nadajnik z rozbitego transportu wojskowego. Jego koordynaty w ${location.name} zostały dodane do map.`;}, failureEffect:gs=>{gs.resources.morale-=5; return "Wzmocnienie sygnału przyciągnęło uwagę grupy bandytów. Musieliście odpierać ich próbny atak przez całą noc.";}},
        {text:"[NAUKOWIEC] Spróbuj przefiltrować i oczyścić sygnał.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=40; return "<strong class='good'>ZDOBYCZ: 40 złomu.</strong> Udało ci się odfiltrować szum. Sygnał zawierał schematy techniczne starego robota wojskowego. Możesz go rozebrać na cenne części!";}, failureEffect:gs=>{gs.machines.powerGenerator.wydajnosc-=10; return "Próba filtrowania spowodowała sprzężenie zwrotne, które uszkodziło konsolę i przeciążyło generator.";}}
    ]
},
{
    id: 'rand_d_17', type: 'door', title: "Wędrowny kaznodzieja", image:"vault_door_62.jpg", introduction: "Przed włazem stoi mężczyzna w łachmanach, głoszący kazania o 'końcu świata'.", description: "Chce wejść, by 'nawrócić niewiernych'. Jest nieuzbrojony, ale jego słowa są niepokojące.",
    options:[
        {text:"Odpraw go grzecznie, ale stanowczo.", effect:gs=>{return "Kaznodzieja odszedł, obiecując, że 'atom osądzi wasze dusze'. Trochę niepokojące, ale problem z głowy.";}},
        {text:"Wpuść go. Co może pójść nie tak?", effect:gs=>{gs.resources.morale-=15; return "Jego fanatyczne kazania podzieliły mieszkańców i zasiały ziarno niezgody. Pozbycie się go zajęło kilka dni.";}},
        {text:"[DYPLOMATA] Podejmij z nim dyskusję teologiczną.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; return "W publicznej debacie przez interkom obnażyłeś wszystkie luki w jego wierzeniach. Odszedł zawstydzony.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Twoje argumenty tylko go rozzłościły. Nazwał cię 'niewiernym', a kilku mieszkańców... zaczęło mu wierzyć.";}}
    ]
},
{
    id: 'rand_d_18', type: 'door', title: "Stado Brahminów", image:"vault_door_62.jpg", introduction: "Wielkie stado dwugłowych krów, brahminów, pasie się spokojnie niedaleko wejścia.", description: "To ogromna ilość potencjalnego jedzenia. Ale ich właściciel może być w pobliżu.",
    options:[
        {text:"Zignoruj je. Zbyt ryzykowne.", effect:gs=>{return "Stado odeszło. Straciłeś wielką szansę na zdobycie jedzenia.";}},
        {text:"Zapoluj na jednego, samotnego osobnika.", skillCheck:{}, successEffect:gs=>{gs.resources.food+=10; return "<strong class='good'>ZDOBYCZ: 10 żywności.</strong> Polowanie się udało! Macie zapas mięsa na wiele dni.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Spłoszyłeś stado, które w panice zniszczyło zewnętrzne czujniki Krypty.";}},
        {text:"[SIŁACZ] Spróbuj schwytać i oswoić jednego brahmina.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.food+=15; gs.resources.morale+=5; return "Udało ci się! Krypta ma teraz własnego brahmina, który daje stały, niewielki dopływ świeżego mleka (fabularnie).";}, failureEffect:gs=>{gs.resources.population--; gs.dwellers.splice(0,1); return "Brahmin okazał się silniejszy niż myślałeś. W panice stratował jednego z twoich ludzi.";}}
    ]
},
{
    id: 'rand_d_19', type: 'door', title: "Uciekinier", image:"vault_door_62.jpg", introduction: "Do włazu dobiega zakrwawiony mężczyzna w kajdanach. Krzyczy, że uciekł z obozu bandytów.", description: "Chwilę za nim widać światła pojazdu. Jeśli mu pomożesz, ściągniesz na siebie gniew bandytów.",
    options:[
        {text:"Wpuść go i przygotuj się do obrony.", cost:{scrap:10}, effect:gs=>{gs.resources.population++; gs.dwellers.push(createDweller(gs.dwellers.length)); gs.resources.weapons.pistol++; return "<strong class='good'>ZDOBYCZ: 1 pistolet.</strong> Bandyci, widząc ufortyfikowane wejście, odpuścili. Uciekinier dołączył do was.";}},
        {text:"Nie otwieraj. To nie nasza walka.", effect:gs=>{gs.resources.morale-=10; return "Patrzyliście przez kamery, jak bandyci dopadają i brutalnie mordują uciekiniera tuż przed waszym włazem.";}},
        {text:"[SIŁACZ] Zrób zasadzkę na bandytów.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=30; gs.resources.weapons.shotgun++; return "<strong class='good'>ZDOBYCZ: 30 kapsli, 1 strzelba.</strong> Twoja zasadzka była perfekcyjna. Zaskoczeni bandyci zostali zmasakrowani.";}, failureEffect:gs=>{gs.resources.population--; gs.dwellers.splice(0,1); gs.resources.morale-=10; return "Bandyci byli liczniejsi. Odparliście atak, ale straciliście jednego człowieka.";}}
    ]
},
{
    id: 'rand_d_20', type: 'door', title: "Ranny Najemnik", image:"vault_door_62.jpg", introduction: "Przed włazem leży ranny najemnik. Proponuje cenną informację w zamian za jednego Stimpaka.", description: "Może blefować, ale może też mieć informacje warte o wiele więcej.",
    options:[
        {text:"Zgódź się i podaj Stimpaka", cost:{stimpaks:1}, condition:gs=>gs.resources.stimpaks>0, effect:gs=>{gs.resources.weapons.shotgun++; return "<strong class='good'>ZDOBYCZ: 1 strzelba.</strong> Najemnik dotrzymał słowa. Podał ci koordynaty małego schowka z bronią.";}},
        {text:"Odmów. Nie handlujemy z najemnikami.", effect:gs=>{gs.resources.morale-=4; return "Najemnik odszedł, rzucając przekleństwa. Niektórzy mieszkańcy uważają, że straciłeś dobrą okazję.";}},
        {text:"[SIŁACZ] Wyjdź i 'wyciągnij' z niego informacje.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.weapons.shotgun++; gs.resources.caps+=20; return "<strong class='good'>ZDOBYCZ: 1 strzelba, 20 kapsli.</strong> Twoja 'perswazja' zadziałała. Najemnik oddał wszystko, co miał.";}, failureEffect:gs=>{gs.resources.population--; gs.dwellers.splice(0,1); return "Najemnik tylko udawał rannego. To była zasadzka. Straciłeś jednego strażnika w krótkiej strzelaninie.";}}
    ]
},
{
    id: 'rand_d_21', type: 'door', title: "Prospektor", image:"vault_door_62.jpg", introduction: "Stary prospektor twierdzi, że znalazł w okolicy żyłę cennego złomu.", description: "Oferuje sprzedaż mapy za kapsle. To może być oszustwo, albo żyła złota.",
    options:[
        {text:"Kup mapę", cost:{caps:30}, skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=40; return "<strong class='good'>ZDOBYCZ: 40 złomu.</strong> Mapa była prawdziwa! Wysłana ekipa wróciła z wózkiem pełnym złomu.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Mapa była fałszywa. Straciłeś 30 kapsli i zaufanie ludzi, którzy poszli na próżno.";}},
        {text:"Odpraw go. Nie ufamy obcym.", effect:gs=>{return "Prospektor wzruszył ramionami i odszedł. Być może właśnie odrzuciłeś fortunę.";}},
        {text:"[DYPLOMATA] Spróbuj wynegocjować lepszą cenę.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.caps-=15; gs.resources.scrap+=70; return "<strong class='good'>ZDOBYCZ: 70 złomu za pół ceny!</strong> Twoje umiejętności targowania się znów się przydały.";}, failureEffect:gs=>{gs.resources.caps-=40; return "Twoje targowanie się tak go zirytowało, że podbił cenę. Ostatecznie przepłaciłeś za mapę, która okazała się bezwartościowa.";}}
    ]
},
{
    id: 'rand_d_22', type: 'door', title: "Zmutowane Rośliny", image:"vault_door_62.jpg", introduction: "Tuż przy wejściu do Krypty wyrosły dziwne, mięsożerne rośliny.", description: "Ich pnącza blokują zewnętrzne czujniki. Są niebezpieczne, ale ich biomasa może być użyteczna.",
    options:[
        {text:"Wypal je miotaczem ognia", cost:{power:10}, effect:gs=>{return "Rośliny zostały spopielone. Czujniki znów działają."}},
        {text:"Poczekaj, aż same uschną.", effect:gs=>{if(Math.random()<0.3){return "Miałeś szczęście. Gwałtowna burza piaskowa zniszczyła rośliny. Problem rozwiązał się sam.";} else {gs.machines.powerGenerator.wydajnosc-=15; gs.resources.morale-=4; return "Nie uschły. Ich korzenie wrosły w pancerz Krypty i uszkodziły zewnętrzne okablowanie generatora.";}}},
        {text:"[NAUKOWIEC] Zbierz próbki i zbadaj je.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.food+=11; return "<strong class='good'>ZDOBYCZ: 11 żywności.</strong> Odkryłeś, że bulwy tych roślin po obróbce są jadalne i pożywne!";}, failureEffect:gs=>{gs.population--; gs.dwellers.splice(0,1); return "Podczas pobierania próbek roślina wystrzeliła toksyczne zarodniki. Jeden z twoich ludzi zginął.";}}
    ]
},
{
    id: 'rand_d_23', type: 'door', title: "Dziecko z Pustkowi", image:"vault_door_62.jpg", introduction: "Przed włazem siedzi małe, brudne dziecko. Wygląda na zagubione. Jest samo.", description: "To może być pułapka. Ale jeśli nie, to skazujesz dziecko na pewną śmierć.",
    options:[
        {text:"Wpuść je i zaopiekuj się nim.", skillCheck:{}, successEffect:gs=>{gs.resources.population++; gs.dwellers.push(createDweller(gs.dwellers.length)); gs.resources.morale+=15; return "Okazało się, że to tylko zagubione dziecko. Zaopiekowanie się nim podniosło morale.";}, failureEffect:gs=>{gs.resources.morale-=10; gs.resources.food-=20; return "To była pułapka. Gdy otworzyłeś właz, dziecko odwróciło uwagę strażników, a ukryci bandyci ukradli skrzynię z jedzeniem.";}},
        {text:"Zignoruj je. Zbyt duże ryzyko.", effect:gs=>{gs.resources.morale-=15; return "Dziecko siedziało pod drzwiami przez cały dzień, po czym zniknęło w nocy. Twoi ludzie są załamani twoim okrucieństwem.";}},
        {text:"[DYPLOMATA] Spróbuj z nim porozmawiać przez interkom.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.population++; gs.dwellers.push(createDweller(gs.dwellers.length)); gs.resources.caps+=11; return "<strong class='good'>ZDOBYCZ: 11 kapsli.</strong> Udało ci się uspokoić dziecko. Okazało się, że to syn bogatego kupca, który zaoferował nagrodę!";}, failureEffect:gs=>{gs.resources.morale-=10; return "Twoje próby rozmowy tylko je bardziej przestraszyły. Uciekło w głąb pustkowi, a ty zostałeś z poczuciem winy.";}}
    ]
},
{
    id: 'rand_d_24', type: 'door', title: "Mistrzyni tatuażu", image:"vault_door_62.jpg", introduction: "Wędrowna artystka oferuje robienie tatuaży mieszkańcom Krypty.", description: "Twierdzi, że jej tatuaże 'przynoszą szczęście'. To może podnieść morale, ale istnieje ryzyko infekcji.",
    options:[
        {text:"Zgódź się, ale zapewnij sterylne warunki", cost:{stimpaks:1}, condition:gs=>gs.resources.stimpaks>0, effect:gs=>{gs.resources.morale+=10; return "Tatuaże są hitem! Dzięki sterylnym warunkom nikt nie zachorował, a morale poszybowało w górę.";}},
        {text:"Odpraw ją. Nie potrzebujemy takich rozrywek.", effect:gs=>{gs.resources.morale-=5; return "Mieszkańcy są rozczarowani. Straciłeś okazję na łatwe podniesienie morale.";}},
        {text:"[DYPLOMATA] Przekonaj ją, by zrobiła ci darmowy tatuaż jako reklamę.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=12; return "Twoja charyzma zadziałała! Dostałeś darmowy tatuaż, a artystka, zachwycona reklamą, dała zniżkę reszcie.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Twoja propozycja została odebrana jako arogancja. Artystka odeszła obrażona, a mieszkańcy są na ciebie źli.";}}
    ]
},
{
    id: 'rand_d_25', type: 'door', title: "Kolekcjoner książek", image:"vault_door_62.jpg", introduction: "Ekscentryczny starzec z wózkiem pełnym książek chce się wymienić.", description: "Oferuje rzadkie, przedwojenne podręczniki techniczne w zamian za jedzenie.",
    options:[
        {text:"Wymień się", cost:{food:20}, effect:gs=>{gs.machines.waterPurifier.maxEfficiency+=0.1; return "<strong class='good'>BONUS: +10% do maks. efektywności oczyszczalnika wody.</strong> W jednej z książek były schematy ulepszeń!";}},
        {text:"Odpraw go. Książki nas nie nakarmią.", effect:gs=>{return "Starzec odszedł, mamrocząc coś o 'ignorantach'. Straciłeś szansę na zdobycie cennej wiedzy.";}},
        {text:"[NAUKOWIEC] Skopiuj książki używając terminala.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.machines.waterPurifier.maxEfficiency+=0.1; gs.machines.hydroponics.maxEfficiency+=0.1; return "<strong class='good'>BONUS: +10% do efektywności wody I żywności!</strong> Przekonałeś go, by pozwolił ci zeskanować książki!";}, failureEffect:gs=>{gs.resources.power-=20; return "Próba szybkiego skanowania przeciążyła terminal i spowodowała spadek mocy. Starzec, wystraszony, uciekł.";}}
    ]
},
{
    id: 'rand_d_26', type: 'door', title: "Zdziczałe Ghule", image:"vault_door_62.jpg", introduction: "Niewielka horda zdziczałych ghuli dobija się do włazu.", description: "Nie są w stanie sforsować drzwi, ale ich ciągła obecność i wycie przeraża mieszkańców.",
    options:[
        {text:"Użyj wieżyczek obronnych, by je odstraszyć", cost:{power:15}, effect:gs=>{gs.resources.morale+=3; return "Ghule zostały przepędzone. Mieszkańcy czują się bezpieczniej.";}},
        {text:"Poczekaj, aż same sobie pójdą.", effect:gs=>{gs.resources.morale-=8; return "Nie poszły sobie. Ich wycie przez całą noc doprowadzało mieszkańców do szału. Nikt nie spał, morale drastycznie spadło.";}},
        {text:"[SIŁACZ] Wyjdź i osobiście je przepędź.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=7; return "Twój brutalny pokaz siły nie tylko przepędził ghule, ale i zaimponował mieszkańcom. Jesteś ich obrońcą.";}, failureEffect:gs=>{gs.resources.population--; gs.dwellers.splice(0,1); return "Ghuli było więcej, niż się wydawało. Jeden z twoich strażników zginął, zanim udało wam się je odeprzeć.";}}
    ]
},
{
    id: 'rand_d_27', type: 'door', title: "Dzieci Atomu", image:"vault_door_62.jpg", introduction: "Grupa pielgrzymów z Dziećmi Atomu prosi o możliwość pomodlenia się przy waszym reaktorze.", description: "Twierdzą, że chcą tylko 'poczuć blask Atomu'. Są pokojowo nastawieni, ale ich fanatyzm jest niepokojący.",
    options:[
        {text:"Odpraw ich. Reaktor to nie miejsce kultu.", effect:gs=>{gs.resources.morale-=3; return "Dzieci Atomu odeszły, ale niektórzy mieszkańcy uważają, że byłeś zbyt nietolerancyjny.";}},
        {text:"Pozwól im wejść pod ścisłą eskortą.", skillCheck:{}, successEffect:gs=>{gs.resources.morale+=5; gs.resources.caps+=13; return "<strong class='good'>ZDOBYCZ: 13 kapsli.</strong> Pielgrzymi byli tak wdzięczni, że zostawili hojny datek w kapslach. Wizyta przebiegła spokojnie.";}, failureEffect:gs=>{gs.machines.powerGenerator.wydajnosc-=25; return "Jeden z fanatyków rzucił się na reaktor, próbując go 'objąć'. Spowodował poważną awarię, zanim ochrona go obezwładniła.";}},
        {text:"[DYPLOMATA] Sprzedaj im 'błogosławioną' wodę z chłodzenia reaktora.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=20; return "<strong class='good'>ZDOBYCZ: 20 kapsli.</strong> Twój zmysł handlowy jest niesamowity! Dzieci Atomu z radością zapłaciły za butelki z lekko radioaktywną wodą.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Próba oszustwa została odkryta. Dzieci Atomu ogłosiły waszą Kryptę 'siedliskiem herezji' i teraz regularnie was nękają.";}}
    ]
},
{
    id: 'rand_d_28', type: 'door', title: "Prośba o schronienie dla Ghula", image:"vault_door_62.jpg", introduction:"Przed włazem stoi przytomny, dobrze ubrany Ghul. Twierdzi, że jest kupcem, a jego karawana została zniszczona.", description: "Prosi o schronienie. Wielu mieszkańców boi się Ghuli i nie chce go wpuścić.",
    options:[
        {text:"Wpuść go, ale umieść w izolatce.", effect:gs=>{gs.resources.morale-=5; return "Ghul jest bezpieczny, ale traktowanie go jak więźnia obniżyło morale i uraziło gościa.";}},
        {text:"Odmów. Nie wpuszczamy Ghuli.", effect:gs=>{gs.resources.morale-=8; return "Odesłałeś go na pewną śmierć. Twoi ludzie są podzieleni - jedni cię popierają, inni potępiają.";}},
        {text:"[DYPLOMATA] Wpuść go i zorganizuj spotkanie z mieszkańcami.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=10; gs.resources.caps+=10; return "<strong class='good'>ZDOBYCZ: 10 kapsli.</strong> Twoja mowa o tolerancji i historia Ghula poruszyły mieszkańców. Został przyjęty ciepło, a w podzięce podzielił się resztką swoich kapsli.";}, failureEffect:gs=>{gs.resources.morale-=12; return "Spotkanie przerodziło się w ksenofobiczną awanturę. Ghul został obrażony i odszedł, a Krypta jest bardziej podzielona niż kiedykolwiek.";}}
    ]
},
{
    id: 'rand_d_29', type: 'door', title: "Uchodźcy z innej Krypty", image: "vault_door_62.jpg", introduction: "Grupa ludzi w kombinezonach z numerem innej Krypty prosi o azyl. Twierdzą, że ich Krypta uległa awarii.", description: "Przyjęcie tak dużej grupy to ogromne obciążenie dla zapasów. Ale to mieszkańcy Krypt, tacy jak wy.",
    options:[
        {text:"Przyjmij ich, ale wprowadź surowe racjonowanie.", effect:gs=>{gs.resources.population+=5; gs.dwellers.push(createDweller(gs.dwellers.length), createDweller(gs.dwellers.length+1), createDweller(gs.dwellers.length+2), createDweller(gs.dwellers.length+3), createDweller(gs.dwellers.length+4)); gs.resources.morale-=10; return "Przyjąłeś 5 nowych mieszkańców. To ogromne obciążenie, a racjonowanie obniżyło morale wszystkich.";}},
        {text:"Odmów. Nie damy rady ich utrzymać.", effect:gs=>{gs.resources.morale-=10; return "Skazałeś innych mieszkańców Krypt na śmierć. Twoi ludzie nigdy ci tego nie zapomną.";}},
        {text:"[DYPLOMATA] Zaproponuj im tymczasowe schronienie w zamian za ich zapasy.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.population+=5; gs.dwellers.push(createDweller(gs.dwellers.length), createDweller(gs.dwellers.length+1), createDweller(gs.dwellers.length+2), createDweller(gs.dwellers.length+3), createDweller(gs.dwellers.length+4)); gs.resources.food+=10; gs.resources.water+=15; return "<strong class='good'>ZDOBYCZ: 15 żywności, 15 wody.</strong> To była mistrzowska umowa! Przyjąłeś uchodźców, a oni oddali wam swoje ostatnie zapasy.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Twoja propozycja została odebrana jako okrutna. Uchodźcy odeszli z pogardą, a twoi ludzie są zniesmaczeni twoim brakiem współczucia.";}}
    ]
},
{
    id: 'rand_d_30', type: 'door', title: "Zdesperowany ojciec", image:"vault_door_62.jpg", introduction:"Mężczyzna błaga o lekarstwa dla swojego chorego dziecka. Twierdzi, że ma tylko kilka kapsli.", description: "Wygląda na uczciwego, ale na Pustkowiach każdy jest zdesperowany. Lekarstwa są na wagę złota.",
    options:[
        {text:"Sprzedaj mu jednego Stimpaka po zaniżonej cenie", cost:{stimpaks:1}, condition:gs=>gs.resources.stimpaks>0, effect:gs=>{gs.resources.caps+=10; gs.resources.morale+=3; return "Pomogłeś mu, nie tracąc przy tym zbyt wiele. To był dobry, choć kosztowny uczynek.";}},
        {text:"Odmów. Nie prowadzimy apteki.", effect:gs=>{gs.resources.morale-=5; return "Mężczyzna odszedł ze łzami w oczach. Twoja odmowa została odebrana jako brak serca.";}},
        {text:"[DYPLOMATA] Daj mu ziołowy substytut i wmów, że to cudowne lekarstwo.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=18; gs.resources.morale+=5; return "<strong class='good'>ZDOBYCZ: 18 kapsli.</strong> Twoje placebo zadziałało! Dziecko wyzdrowiało (prawdopodobnie samo), a ojciec zapłacił ci ostatnimi kapslami, wdzięczny za 'cud'.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Twoje oszustwo się nie udało. Dziecko nie wyzdrowiało, a wieść o tym, że sprzedajesz fałszywe leki, rozniosła się po okolicy.";}}
    ]
},
{
    id: 'rand_d_31', type: 'door', title: "Tajemniczy Wojownik", image:"vault_door_62.jpg", introduction: "Przed włazem stoi samotny wojownik na zmutowanym koniu. Ma długie, białe włosy i dwa miecze na plecach.", description: "Przez interkom przedstawia się jako 'Gerard z Reven'. Nie prosi o wejście. Chce tylko jedno - wody dla swojego wierzchowca.",
    options:[
        {text:"Daj mu wodę", cost:{water:15}, effect:gs=>{gs.resources.morale+=5; return "Gerard skinął głową w podzięce, napoił konia i odjechał w ciszy. Twoi ludzie są pod wrażeniem tajemniczego gościa i twojego gestu.";}},
        {text:"Odmów. Woda jest zbyt cenna.", effect:gs=>{gs.resources.morale-=3; return "Wojownik spojrzał na właz, po czym bez słowa odjechał. Pozostało dziwne uczucie niepokoju.";}},
        {text:"[SIŁACZ] Wyjdź i rzuć mu wyzwanie.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.weapons.rifle++; return "<strong class='good'>ZDOBYCZ: 1 Karabin.</strong> Gerard, rozbawiony twoją odwagą, rzucił ci stary karabin, mówiąc 'będzie ci bardziej potrzebny niż mnie'. Odjechał z szacunkiem w głosie.";}, failureEffect:gs=>{gs.resources.morale-=10; return "Ledwo zdążyłeś wyjść, a on już był przy tobie. Nie dobył miecza, ale jego szybkość cię przeraziła. Obezwładnił cię i odszedł, zostawiając cię upokorzonego na oczach strażników.";}}
    ]
},
{
    id: 'rand_d_32', type: 'door', title: "Wiedźmak z Reven: Kontrakt", image:"vault_door_62.jpg", introduction: "Tajemniczy Ghul, Gerard z Reven, wrócił. Tym razem ma ofertę.", description: "'Słyszałem, że macie problem ze Szponem Śmierci, który was pilnuje. Bestie bywają... niestabilne. Mogę się go pozbyć. Dyskretnie. Za odpowiednią opłatą.'",
    condition: gs => gs.flags.hasDeathclawGuardian, // To zadanie pojawi się tylko, jeśli masz Strażnika
    options:[
        {text:"Zatrudnij go. Pozbądź się bestii", cost:{caps:50}, condition:gs=>gs.resources.caps>=50, effect:gs=>{gs.flags.hasDeathclawGuardian=false; gs.resources.morale-=10; return "Wiedźmak wykonał swoją pracę. Szpon Śmierci nie żyje. Straciłeś potężnego sojusznika i sporo kapsli, ale niektórzy mieszkańcy odetchnęli z ulgą.";}},
        {text:"Odmów. To nasz Strażnik, nie potwór.", effect:gs=>{gs.resources.morale+=5; return "Wiedźmak wzruszył ramionami. 'Wasz wybór'. Odjechał. Twoja lojalność wobec bestii zaimponowała niektórym mieszkańcom.";}},
        {text:"[SIŁACZ] Spróbuj go przekonać, by nauczył was walczyć z mutantami.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.caps-=30; return "Zgodził się. Za drobną opłatą przeprowadził dla twoich strażników krótki, ale niezwykle cenny trening. Czują się pewniej.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Zaśmiał się. 'Nie jestem nauczycielem, Nadzorco'. Twoja próba została odebrana jako naiwność.";}}
    ]
},
{
    id: 'rand_d_33', type: 'door', title: "Zagubiona przesyłka", image:"vault_door_62.jpg", introduction:"Przed włazem leży solidna, metalowa walizka z logo Karmazynowej Karawany. Wygląda na to, że wypadła z ich transportu.", description: "W środku mogą być cenne towary... albo nadajnik GPS, który sprowadzi ich z powrotem.",
    options:[
        {text:"Zostaw ją w spokoju. Nie nasza sprawa.", effect:gs=>{return "Po kilku godzinach wrócił mały patrol Karawany i zabrał walizkę. Zauważyli, że ich obserwowaliście, ale nic nie zrobili. Uniknąłeś kłopotów.";}},
        {text:"Otwórz ją.", skillCheck:{}, successEffect:gs=>{gs.resources.caps+=20; return "<strong class='good'>ZDOBYCZ: 10 kapsli.</strong> W środku była gotówka! To zapłata za jakiś towar. Co za szczęście!";}, failureEffect:gs=>{gs.resources.morale-=5; gs.resources.caps-=20; return "W środku był nadajnik. Po godzinie wróciła wściekła ekipa z Karawany i zażądała 20 kapsli 'odszkodowania za próbę kradzieży'.";}},
        {text:"[NAUKOWIEC] Przeskanuj ją w poszukiwaniu nadajników.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=20; return "<strong class='good'>ZDOBYCZ: 10 kapsli.</strong> Skaner nie wykrył żadnych nadajników. Otworzyłeś walizkę i znalazłeś gotówkę!";}, failureEffect:gs=>{return "Skaner wykrył aktywny nadajnik. Zostawiłeś walizkę w spokoju, wiedząc, że to pułapka. Dobra decyzja.";}}
    ]
},
{
    id: 'rand_d_34', type: 'door', title: "Uciekinier z Enklawy", image:"vault_door_62.jpg", introduction:"Przed włazem stoi mężczyzna w resztkach zaawansowanego pancerza. Twierdzi, że jest dezerterem z Enklawy.", description: "Oferuje wiedzę o technologii w zamian za azyl. Ale jeśli Enklawa go szuka, ściągniesz na siebie potężnego wroga.",
    options:[
        {text:"Wpuść go i wysłuchaj.", effect:gs=>{gs.machines.powerGenerator.maxEfficiency+=0.1; gs.resources.morale-=5; return "<strong class='good'>BONUS: +10% do maks. efektywności generatora.</strong> Mówił prawdę! Jego wiedza pozwoliła zoptymalizować reaktor. Ale teraz żyjecie w strachu przed Enklawą.";}},
        {text:"Odmów. Nie zadzieramy z Enklawą.", effect:gs=>{return "Dezerter splunął na ziemię i odszedł. 'Głupcy', wyszeptał. Uniknąłeś ryzyka, ale straciłeś szansę.";}},
        {text:"[SIŁACZ] Obezwładnij go i zabierz mu pancerz.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=40; return "<strong class='good'>ZDOBYCZ: 40 złomu.</strong> Pancerz był zbyt uszkodzony, by go nosić, ale udało ci się odzyskać z niego mnóstwo zaawansowanych części!";}, failureEffect:gs=>{gs.resources.population--; gs.dwellers.splice(0,1); return "Był szybszy. Jego ukryte ostrze w rękawicy zabiło jednego z twoich ludzi, zanim udało wam się go zastrzelić.";}}
    ]
},
{
    id: 'rand_d_35', type: 'door', title: "Problem z brahminem", image:"vault_door_62.jpg", introduction:"Jeden z brahminów przechodzącej karawany utknął w rozpadlinie niedaleko Krypty.", description: "Handlarz oferuje nagrodę za pomoc w jego wyciągnięciu. To ciężka praca, ale i okazja do zarobku.",
    options:[
        {text:"Pomóż im, używając sprzętu", cost:{scrap:10}, effect:gs=>{gs.resources.caps+=20; return "<strong class='good'>ZDOBYCZ: 20 kapsli.</strong> Wasz sprzęt pomógł wyciągnąć zwierzę. Handlarz sowicie was wynagrodził.";}},
        {text:"Zignoruj ich. To nie nasz problem.", effect:gs=>{return "Handlarze poradzili sobie sami po kilku godzinach, ale zapamiętali waszą obojętność.";}},
        {text:"[SIŁACZ] Wyciągnij brahmina siłą mięśni.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=20; return "<strong class='good'>ZDOBYCZ: 20 kapsli.</strong> Handlarz był pod takim wrażeniem twojej siły, że zapłacił ci podwójnie!";}, failureEffect:gs=>{gs.resources.stimpaks-=1; return "Brahmin, panikując, kopnął cię i złamał ci żebro. Musiałeś użyć Stimpaka. Handlarz dał ci tylko kilka kapsli z litości.";}}
    ]
},
{
    id: 'rand_d_36', type: 'door', title: "Dostawca wody", image:"vault_door_62.jpg", introduction:"Przed włazem stoi handlarz z cysterną pełną oczyszczonej wody.", description: "Oferuje sprzedaż dużej ilości wody po okazyjnej cenie. To zbyt piękne, by było prawdziwe.",
    options:[
        {text:"Kup wodę", cost:{caps:25}, skillCheck:{}, successEffect:gs=>{gs.resources.water+=60; return "<strong class='good'>ZDOBYCZ: 60 wody.</strong> Woda jest czysta! To była niesamowita okazja.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Woda była lekko napromieniowana. Musieliście ją przefiltrować, co zajęło czas i zirytowało mieszkańców.";}},
        {text:"Odpraw go. Nie ufamy takim okazjom.", effect:gs=>{return "Handlarz odjechał. Być może właśnie zrezygnowałeś z najlepszego interesu od lat.";}},
        {text:"[NAUKOWIEC] Poproś o próbkę do analizy.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.water+=60; gs.resources.caps-=15; return "<strong class='good'>ZDOBYCZ: 60 wody.</strong> Twoja szybka analiza potwierdziła, że woda jest czysta. Wynegocjowałeś niższą cenę za 'konsultację naukową'.";}, failureEffect:gs=>{return "Twoje instrumenty wykryły śladowe ilości toksyn. Handlarz, zdemaskowany, szybko odjechał.";}}
    ]
},
{
    id: 'rand_d_37', type: 'door', title: "Mapa skarbów", image:"vault_door_62.jpg", introduction:"Umierający z pragnienia wędrowiec oferuje mapę prowadzącą do 'skarbu' w zamian za wodę.", description: "Jego historia brzmi jak z bajki, ale mapa wygląda na autentyczną. Może warto zaryzykować?",
    options:[
        {text:"Daj mu wodę i weź mapę", cost:{water:10}, skillCheck:{}, successEffect:gs=>{const location = EXPEDITION_LOCATIONS[Math.floor(Math.random()*EXPEDITION_LOCATIONS.length)]; return `Mapa jest prawdziwa! Prowadzi do małego schowka z zapasami w ${location.name}.`;}, failureEffect:gs=>{gs.resources.morale-=3; return "Mapa okazała się być dziecinnym rysunkiem. Straciłeś wodę i zostałeś oszukany.";}},
        {text:"Odmów. To na pewno oszustwo.", effect:gs=>{gs.resources.morale-=5; return "Wędrowiec umarł pod waszymi drzwiami. Niezależnie od tego, czy miał mapę, jego śmierć ciąży na waszym sumieniu.";}},
        {text:"[DYPLOMATA] Przekonaj go, by dał ci mapę za obietnicę pomocy.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{const location = EXPEDITION_LOCATIONS[Math.floor(Math.random()*EXPEDITION_LOCATIONS.length)]; return `Zaufał ci. Dał ci mapę, a ty dałeś mu wodę. Mapa prowadzi do schowka w ${location.name}.`;}, failureEffect:gs=>{return "Nie dał się nabrać na twoje gładkie słówka. Nazwał cię hieną i odszedł.";}}
    ]
},
{
    id: 'rand_d_38', type: 'door', title: "Mechanik Robotów", image:"vault_door_62.jpg", introduction: "Wędrowna mechanik oferuje ulepszenie waszych systemów obronnych.", description: "Jej usługi są drogie, ale twierdzi, że jej praca jest najlepsza na Pustkowiach.",
    options:[
        {text:"Zatrudnij ją do ulepszenia obrony", cost:{caps:40}, effect:gs=>{gs.resources.morale+=5; return "Wieżyczki obronne zostały wzmocnione. Mieszkańcy czują się o wiele bezpieczniej.";}},
        {text:"Odpraw ją. Nie stać nas.", effect:gs=>{return "Mechanik odeszła. Straciłeś okazję na wzmocnienie Krypty.";}},
        {text:"[NAUKOWIEC] Porozmawiaj z nią 'jak technik z technikiem'.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.caps-=20; gs.machines.powerGenerator.maxEfficiency+=0.05; return "<strong class='good'>BONUS: +5% do maks. efektywności generatora.</strong> Zaimponowałeś jej swoją wiedzą! Wymieniliście się schematami i dała ci zniżkę na optymalizację reaktora.";}, failureEffect:gs=>{gs.resources.scrap-=20; return "Twoja wiedza okazała się przestarzała. Próbując jej zaimponować, spaliłeś kilka cennych części.";}}
    ]
},
{
    id: 'rand_d_39', type: 'door', title: "Prośba o schronienie przed burzą", image:"vault_door_62.jpg", introduction: "Mała grupa ocalałych prosi o schronienie na jedną noc przed nadciągającą burzą radioaktywną.", description: "To akt miłosierdzia, ale każdy obcy w Krypcie to ryzyko. Nie proszą o zapasy.",
    options:[
        {text:"Wpuść ich na jedną noc.", effect:gs=>{gs.resources.morale+=7; return "Ocalali byli wdzięczni. Przeczekali burzę i odeszli o świcie, zostawiając w podzięce kilka ziół leczniczych.";}},
        {text:"Odmów. Drzwi Krypty pozostają zamknięte.", effect:gs=>{gs.resources.morale-=8; return "Skazałeś ich na śmierć w radioaktywnej burzy. Twoi ludzie są przerażeni twoim brakiem człowieczeństwa.";}},
        {text:"[SIŁACZ] Zaoferuj im miejsce w zewnętrznej śluzie.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=3; return "To twardy, ale sprawiedliwy kompromis. Ocalali przetrwali burzę w śluzie, a ty nie naraziłeś bezpieczeństwa Krypty.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Burza była silniejsza niż myśleliście. Śluza nie wytrzymała. Rano znaleźliście tylko zwłoki.";}}
    ]
},
{
    id: 'rand_d_40', type: 'door', title: "Zgubiony robot", image:"vault_door_62.jpg", introduction: "Pod drzwiami stoi samotny Pan Złota Rączka. Odtwarza w kółko: 'Zgubiłem mojego pana.'.", description: "Wydaje się być zaprogramowany na poszukiwanie swojego przedwojennego właściciela. Może mieć cenne komponenty.",
    options:[
        {text:"Zdemontuj go na części.", effect:gs=>{gs.resources.scrap+=30; return "<strong class='good'>ZDOBYCZ: 30 złomu.</strong> To było smutne, ale praktyczne. Odzyskałeś z niego mnóstwo wysokiej jakości części.";}},
        {text:"Zignoruj go. W końcu pójdzie sobie.", effect:gs=>{return "Robot stał pod drzwiami przez cały dzień, po czym ruszył w dalszą drogę, kontynuując swoje beznadziejne poszukiwania.";}},
        {text:"[NAUKOWIEC] Spróbuj uzyskać dostęp do jego pamięci.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{const location = EXPEDITION_LOCATIONS[Math.floor(Math.random()*EXPEDITION_LOCATIONS.length)]; return `Udało ci się! W jego pamięci były zapisane koordynaty ostatniej znanej lokalizacji jego pana - małego bunkra w ${location.name}.`;}, failureEffect:gs=>{gs.resources.power-=15; return "Próba hackowania uruchomiła protokół obronny. Robot poraził cię prądem i uszkodził zewnętrzne zasilanie włazu.";}}
    ]
},
{
    id: 'rand_d_41', type: 'door', title: "Wiadomość od innej Krypty", image:"vault_door_62.jpg", introduction: "Posłaniec z pobliskiej Krypty 77 przynosi wiadomość. Ich Krypta jest w kryzysie i proponują sojusz.", description: "Sojusz oznacza wzajemną pomoc, ale też wzajemne problemy. To poważna decyzja polityczna.",
    options:[
        {text:"Zgódź się na sojusz.", effect:gs=>{gs.resources.morale+=5; return "Nawiązałeś sojusz z Kryptą 77. To daje poczucie bezpieczeństwa, ale ich problemy są teraz także twoimi.";}},
        {text:"Odrzuć propozycję. Jesteśmy samowystarczalni.", effect:gs=>{return "Odrzuciłeś ofertę. Posłaniec odszedł zawiedziony. Zostaliście sami.";}},
        {text:"[DYPLOMATA] Wynegocjuj pakt handlowy zamiast sojuszu.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=20; return "<strong class='good'>ZDOBYCZ: 20 kapsli.</strong> Twoje negocjacje były mistrzowskie! Zamiast ryzykować sojuszem, podpisałeś lukratywną umowę handlową.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Twoja próba uniknięcia sojuszu została odebrana jako arogancja. Krypta 77 jest teraz waszym wrogim sąsiadem.";}}
    ]
},
{
    id: 'rand_d_42', type: 'door', title: "Stado Radstags", image:"vault_door_62.jpg", introduction: "W okolicy pojawiło się duże stado napromieniowanych jeleni - Radstags.", description: "To ogromna ilość mięsa, ale są szybkie i niebezpieczne w grupie.",
    options:[
        {text:"Zorganizuj polowanie z użyciem broni palnej.", effect:gs=>{gs.resources.food+=10; return "<strong class='good'>ZDOBYCZ: 10 żywności.</strong> Polowanie było skuteczne. Macie zapas mięsa na wiele tygodni.";}},
        {text:"Zostaw je w spokoju. Zbyt niebezpieczne.", effect:gs=>{return "Stado odeszło. Uniknąłeś ryzyka, ale straciłeś okazję na wielką zdobycz.";}},
        {text:"[SIŁACZ] Zastaw pułapki i zapędź je w wąwóz.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.food+=15; return "<strong class='good'>ZDOBYCZ: 15 żywności.</strong> Twój plan był genialny w swojej brutalnej prostocie. Upolowaliście prawie całe stado!";}, failureEffect:gs=>{gs.resources.population--; gs.dwellers.splice(0,1); return "Pułapki nie wytrzymały naporu stada. Jeden z twoich myśliwych został stratowany na śmierć.";}}
    ]
},
{
    id: 'rand_d_43', type: 'door', title: "Prośba o narzędzia", image:"vault_door_62.jpg", introduction: "Przechodzący mechanik ma awarię wózka. Prosi o pożyczenie zestawu narzędzi.", description: "Obiecuje oddać je następnego dnia i dorzucić kilka kapsli w podzięce. Ale na Pustkowiach obietnice są tanie.",
    options:[
        {text:"Pożycz mu narzędzia", cost:{scrap:10}, skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=10; gs.resources.caps+=10; return "<strong class='good'>ZDOBYCZ: 10 kapsli.</strong> Mechanik dotrzymał słowa! Zwrócił narzędzia i sowicie zapłacił za pomoc.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Mechanik nigdy nie wrócił. Straciłeś cenny zestaw narzędzi i zostałeś oszukany.";}},
        {text:"Odmów. Nie pożyczamy naszych rzeczy.", effect:gs=>{return "Mechanik odszedł, mamrocząc pod nosem. Nic się nie stało.";}},
        {text:"[NAUKOWIEC] Zaoferuj naprawę na miejscu za opłatą.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.caps+=15; return "<strong class='good'>ZDOBYCZ: 15 kapsli.</strong> Twoje umiejętności zrobiły na nim wrażenie. Zapłacił ci za naprawę więcej, niż prosiłeś.";}, failureEffect:gs=>{gs.resources.scrap-=10; return "Próbując naprawić jego dziwny silnik, przypadkowo go zepsułeś jeszcze bardziej. Musiałeś mu oddać części ze swoich zapasów jako odszkodowanie.";}}
    ]
},
{
    id: 'rand_d_44', type: 'door', title: "Tajemniczy Ogród", image:"vault_door_62.jpg", introduction: "Zwiadowca odkrył niedaleko Krypty mały, ukryty ogród pełen nie-zmutowanych owoców i warzyw.", description: "Wygląda jak cud, ale jest strzeżony przez dziwne, automatyczne wieżyczki. To może być pułapka.",
    options:[
        {text:"Zignoruj to. Zbyt piękne, by było prawdziwe.", effect:gs=>{return "Ogród pozostaje nietknięty. Być może to była największa szansa w historii waszej Krypty.";}},
        {text:"Wyślij uzbrojoną ekipę, by przebiła się przez obronę.", skillCheck:{}, successEffect:gs=>{gs.resources.food+=20; return "<strong class='good'>ZDOBYCZ: 20 żywności.</strong> Udało się! Zniszczyliście wieżyczki i zebraliście wszystkie plony. Macie jedzenia na wiele tygodni!";}, failureEffect:gs=>{gs.resources.population-=2; gs.dwellers.splice(0,2); return "Wieżyczki były potężniejsze, niż się wydawało. Straciliście dwóch ludzi, zanim udało wam się wycofać.";}},
        {text:"[NAUKOWIEC] Spróbuj zhakować wieżyczki.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.food+=20; gs.resources.scrap+=30; return "<strong class='good'>ZDOBYCZ: 20 żywności, 30 złomu.</strong> Twój geniusz ocalił dzień! Wyłączyłeś wieżyczki, zebraliście plony, a nawet wymontowałeś z nich cenne części.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Próba hakowania uruchomiła protokół samozniszczenia. Ogród i wieżyczki wyleciały w powietrze. Straciłeś wszystko.";}}
    ]
},
{
    id: 'rand_d_45', type: 'door', title: "Prośba o schronienie dla Ghula", image:"vault_door_62.jpg", introduction:"Przed włazem stoi przytomny, dobrze ubrany Ghul. Twierdzi, że jest kupcem, a jego karawana została zniszczona.", description: "Prosi o schronienie. Wielu mieszkańców boi się Ghuli i nie chce go wpuścić.",
    options:[
        {text:"Wpuść go, ale umieść w izolatce.", effect:gs=>{gs.resources.morale-=5; return "Ghul jest bezpieczny, ale traktowanie go jak więźnia obniżyło morale i uraziło gościa.";}},
        {text:"Odmów. Nie wpuszczamy Ghuli.", effect:gs=>{gs.resources.morale-=8; return "Odesłałeś go na pewną śmierć. Twoi ludzie są podzieleni - jedni cię popierają, inni potępiają.";}},
        {text:"[DYPLOMATA] Wpuść go i zorganizuj spotkanie z mieszkańcami.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=10; gs.resources.caps+=18; return "<strong class='good'>ZDOBYCZ: 18 kapsli.</strong> Twoja mowa o tolerancji i historia Ghula poruszyły mieszkańców. Został przyjęty ciepło, a w podzięce podzielił się resztką swoich kapsli.";}, failureEffect:gs=>{gs.resources.morale-=12; return "Spotkanie przerodziło się w ksenofobiczną awanturę. Ghul został obrażony i odszedł, a Krypta jest bardziej podzielona niż kiedykolwiek.";}}
    ]
},
{
    id: 'rand_d_62', type: 'door', title: "Złomiarz z ofertą", image:"vault_door_62.jpg", introduction: "Przed włazem stoi obładowany złomem handlarz. Nie chce kapsli.", description: "Proponuje wymianę dużej ilości wysokiej jakości złomu na trochę czystej wody.",
    options:[
        {text:"Wymień się", cost:{water:25}, effect:gs=>{gs.resources.scrap+=50; return "<strong class='good'>ZDOBYCZ: 50 złomu.</strong> To była uczciwa wymiana. Woda za metal.";}},
        {text:"Odpraw go. Woda jest cenniejsza.", effect:gs=>{return "Handlarz odszedł. Straciłeś okazję na zdobycie dużej ilości złomu.";}},
        {text:"[SIŁACZ] 'Przekonaj' go do lepszej ceny.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.water-=10; gs.resources.scrap+=50; return "<strong class='good'>ZDOBYCZ: 50 złomu.</strong> Twoja 'negocjacja' zadziałała. Oddałeś tylko trochę wody za cały jego towar.";}, failureEffect:gs=>{gs.resources.morale-=5; gs.resources.scrap+=20; return "Myślał, że chcesz go okraść i rzucił w ciebie kilkoma ciężkimi częściami, po czym uciekł. Zebrałeś trochę złomu z ziemi, ale czujesz się upokorzony.";}}
    ]
},
{
    id: 'rand_d_63', type: 'door', title: "Prośba o części zamienne", image:"vault_door_62.jpg", introduction: "Kobieta-mechanik prosi o pożyczenie kilku specjalistycznych narzędzi i części.", description: "Twierdzi, że jej wóz się zepsuł. Obiecuje zwrócić wszystko z nawiązką w postaci innego złomu. To ryzykowne.",
    options:[
        {text:"Pożycz jej sprzęt", cost:{scrap:15}, skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=25; return "<strong class='good'>ZDOBYCZ: 10 złomu netto.</strong> Kobieta dotrzymała słowa! Zwróciła pożyczone części i dołożyła sporo od siebie.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Nigdy nie wróciła. Straciłeś 15 jednostek cennego złomu.";}},
        {text:"Odmów. Nie pożyczamy naszych rzeczy.", effect:gs=>{return "Mechanik odeszła, mamrocząc pod nosem. Nic się nie stało.";}},
        {text:"[NAUKOWIEC] Zaoferuj naprawę na miejscu za złom.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=40; return "<strong class='good'>ZDOBYCZ: 40 złomu.</strong> Twoje umiejętności zrobiły na niej wrażenie. Zapłaciła ci za naprawę wszystkim złomem, jaki miała przy sobie.";}, failureEffect:gs=>{gs.resources.scrap-=20; return "Próbując naprawić jej dziwny silnik, przypadkowo go zepsułeś jeszcze bardziej. Musiałeś jej oddać części ze swoich zapasów jako odszkodowanie.";}}
    ]
},
{
    id: 'rand_d_64', type: 'door', title: "Wrak Vertibird", image:"vault_door_62.jpg", introduction: "Zwiadowca donosi o wraku Vertibirda, który rozbił się niedaleko Krypty.", description: "To skarbnica zaawansowanego złomu, ale wrak może być napromieniowany lub strzeżony przez padlinożerców.",
    options:[
        {text:"Wyślij ekipę w kombinezonach ochronnych", cost:{hazmatSuits:1}, condition:gs=>gs.resources.hazmatSuits>0, effect:gs=>{gs.resources.scrap+=30; return "<strong class='good'>ZDOBYCZ: 30 złomu.</strong> Ekipa wróciła z mnóstwem zaawansowanych technologicznie części!";}},
        {text:"Zignoruj to. Zbyt niebezpieczne.", effect:gs=>{return "Wrak pozostaje na pustkowiach. Ktoś inny z pewnością skorzysta z tej okazji.";}},
        {text:"[SIŁACZ] Poprowadź ekipę i odeprzyj padlinożerców.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=50; return "<strong class='good'>ZDOBYCZ: 50 złomu.</strong> Twoja siła i taktyka pozwoliły wam przepędzić konkurencję i zabrać wszystko, co cenne.";}, failureEffect:gs=>{gs.resources.population--; gs.dwellers.splice(0,1); gs.resources.scrap+=20; return "Padlinożercy byli lepiej uzbrojeni. Straciłeś jednego człowieka, ale udało wam się uciec z garścią złomu.";}}
    ]
},
{
    id: 'rand_d_65', type: 'door', title: "Konkurs Złomiarzy", image:"vault_door_62.jpg", introduction: "Grupa złomiarzy rozbiła obóz niedaleko. Ogłosili konkurs na 'najdziwniejszy przedwojenny artefakt'.", description: "Nagrodą jest ogromna sterta złomu. Możesz wziąć udział, ale to wymaga poświęcenia jednego z twoich 'skarbów'.",
    options:[
        {text:"Odmów udziału. Nie bawimy się w takie rzeczy.", effect:gs=>{return "Konkurs odbył się bez was. Ktoś inny wygrał górę złomu.";}},
        {text:"Wystaw w konkursie starą zabawkę", cost:{scrap:5}, skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=50; return "<strong class='good'>ZDOBYCZ: 45 złomu netto.</strong> Twoja stara zabawka 'Pan Przytulanka' rozczuliła sędziów! Wygrałeś główną nagrodę!";}, failureEffect:gs=>{gs.resources.morale-=3; return "Twoja zabawka została wyśmiana. Przegrałeś i straciłeś cenny (choć mały) artefakt.";}},
        {text:"[DYPLOMATA] Spróbuj przekonać sędziów słowami.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=50; return "<strong class='good'>ZDOBYCZ: 50 złomu.</strong> Nie miałeś artefaktu, ale opowiedziałeś tak poruszającą (i zmyśloną) historię o losach swojej Krypty, że sędziowie przyznali ci nagrodę specjalną.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Twoje przemowy zostały uznane za próbę oszustwa. Zostałeś zdyskwalifikowany i wyśmiany.";}}
    ]
},
{
    id: 'rand_d_66', type: 'door', title: "Prośba o materiały budowlane", image:"vault_door_62.jpg", introduction:"Grupa osadników prosi o sprzedaż dużej ilości złomu na budowę umocnień.", description: "Oferują w zamian dużą ilość jedzenia. To dobra wymiana, ale złom jest bardzo cenny.",
    options:[
        {text:"Zgódź się na wymianę", cost:{scrap:40}, condition:gs=>gs.resources.scrap>=40, effect:gs=>{gs.resources.food+=10; return "<strong class='good'>ZDOBYCZ: 10 żywności.</strong> Umowa dobita. Obie strony są zadowolone.";}},
        {text:"Odmów. Złom jest nam potrzebny.", effect:gs=>{return "Osadnicy odeszli zawiedzeni. Być może straciłeś potencjalnych sojuszników.";}},
        {text:"[DYPLOMATA] Wynegocjuj lepsze warunki.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.scrap-=40; gs.resources.food+=80; return "<strong class='good'>ZDOBYCZ: 80 żywności.</strong> Twoje umiejętności targowania się wycisnęły z nich ostatnie zapasy. To był genialny interes.";}, failureEffect:gs=>{gs.resources.scrap-=40; gs.resources.food+=40; return "Twoje negocjacje były zbyt agresywne. Obrażeni, zaoferowali ci znacznie gorsze warunki, a ty, by nie wyjść na głupca, musiałeś je przyjąć.";}}
    ]
},
{
    id: 'rand_d_67', type: 'door', title: "Zardzewiały Wartownik", image:"vault_door_62.jpg", introduction:"W piaskach niedaleko wejścia odkopał się stary, przedwojenny robot wartowniczy. Jest nieaktywny.", description: "To góra cennego złomu. Ale próba demontażu może go przypadkowo aktywować.",
    options:[
        {text:"Zostaw go w spokoju.", effect:gs=>{return "Robot powoli znów zapada się w piasek. Bezpieczeństwo jest najważniejsze.";}},
        {text:"Spróbuj go zdemontować (Ryzykowne).", skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=40; return "<strong class='good'>ZDOBYCZ: 40 złomu.</strong> Udało się! Zdemontowaliście go bez problemu. To prawdziwa żyła złota!";}, failureEffect:gs=>{gs.resources.population--; gs.dwellers.splice(0,1); return "Robot się aktywował! Jego działka maszynowe zabiły jednego z twoich ludzi, zanim udało wam się go zniszczyć.";}},
        {text:"[NAUKOWIEC] Spróbuj go bezpiecznie dezaktywować.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=40; return "<strong class='good'>ZDOBYCZ: 40 złomu.</strong> Twoja wiedza o robotyce pozwoliła ci bezpiecznie odciąć jego źródło zasilania. Cały złom jest twój.";}, failureEffect:gs=>{gs.resources.scrap-=15; return "Próbując go dezaktywować, przypadkowo uruchomiłeś jego system obronny - impuls EMP, który usmażył część twoich narzędzi.";}}
    ]
},
{
    id: 'rand_d_68', type: 'door', title: "Handlarz bronią", image:"vault_door_62.jpg", introduction:"Tajemniczy handlarz oferuje wymianę - jeden sprawny pistolet za ogromną ilość złomu.", description: "Twierdzi, że potrzebuje złomu do tworzenia amunicji. To dziwna propozycja.",
    options:[
        {text:"Wymień się", cost:{weapons:{pistol:1}}, condition:gs=>gs.resources.weapons.pistol>0, effect:gs=>{gs.resources.scrap+=50; return "<strong class='good'>ZDOBYCZ: 50 złomu.</strong> Dziwna, ale opłacalna transakcja.";}},
        {text:"Odpraw go. Broń jest cenniejsza.", effect:gs=>{return "Handlarz wzruszył ramionami i zniknął w mroku.";}},
        {text:"[SIŁACZ] 'Zaproponuj', że weźmiesz złom i zatrzymasz pistolet.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=50; return "<strong class='good'>ZDOBYCZ: 50 złomu.</strong> Twoja postawa go onieśmieliła. Zostawił złom i uciekł, byle tylko zachować życie.";}, failureEffect:gs=>{gs.resources.weapons.pistol=0; return "To był bardzo zły pomysł. Handlarz okazał się być szybszy. Zanim się zorientowałeś, rozbroił cię i zabrał wszystkie twoje pistolety jako rekompensatę.";}}
    ]
},
{
    id: 'rand_d_69', type: 'door', title: "Prośba o schronienie dla Super Mutanta", image:"vault_door_62.jpg", introduction:"Przed włazem stoi... Super Mutant. Jest inteligentny i spokojny. Twierdzi, że został wygnany ze swojej grupy.", description: "Prosi o schronienie. To niewyobrażalne ryzyko, ale jest sam i wygląda na przygnębionego.",
    options:[
        {text:"Odmów. Absolutnie nie ma mowy.", effect:gs=>{gs.resources.morale-=5; return "Odmówiłeś. Super Mutant odszedł w milczeniu. Twoi ludzie są przerażeni, ale niektórzy czują, że odmówiłeś komuś w potrzebie.";}},
        {text:"Zaryzykuj i wpuść go do śluzy.", skillCheck:{}, successEffect:gs=>{gs.resources.morale+=10; gs.resources.scrap+=30; return "<strong class='good'>ZDOBYCZ: 30 złomu.</strong> Okazał się być mechanikiem! W podzięce za schronienie, naprawił kilka drobnych usterek w systemach zewnętrznych.";}, failureEffect:gs=>{gs.resources.morale-=10; return "To była pułapka. Gdy otworzyłeś śluzę, z ukrycia wyskoczyła reszta jego grupy. Udało wam się odeprzeć atak, ale straciliście amunicję i nerwy.";}},
        {text:"[SIŁACZ] Wyjdź i zmierz się z nim.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=8; return "Twoja siła zaimponowała mu. 'Jesteś silny', powiedział. 'Szanuję to'. Odszedł, zostawiając was w spokoju.";}, failureEffect:gs=>{gs.resources.morale-=10; return "Rzucił w ciebie kawałkiem betonu wielkości twojej głowy. Ledwo zdążyłeś uciec z powrotem do Krypty. Jesteś pośmiewiskiem strażników.";}}
    ]
},
{
    id: 'rand_d_70', type: 'door', title: "Zardzewiały Pan Śmiałek", image:"vault_door_62.jpg", introduction:"Na zewnątrz stoi stary, zardzewiały Pan Śmiałek, powtarzający antykomunistyczne hasła.", description: "Jest reliktem przeszłości i potencjalnym źródłem części, ale jego reaktor fuzyjny może być niestabilny.",
    options:[
        {text:"Zniszcz go z dystansu.", effect:gs=>{gs.resources.scrap+=20; return "<strong class='good'>ZDOBYCZ: 20 złomu.</strong> Bezpiecznie go zniszczyliście i zebraliście to, co zostało.";}},
        {text:"Zostaw go. To zbyt niebezpieczne.", effect:gs=>{return "Robot przez kilka godzin wykrzykiwał hasła, po czym jego bateria ostatecznie padła. Zapadła cisza.";}},
        {text:"[NAUKOWIEC] Spróbuj wyciągnąć jego rdzeń fuzyjny.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.power+=25; return "<strong class='good'>ZDOBYCZ: 50 energii.</strong> Twoja precyzja się opłaciła! Bezpiecznie wyciągnąłeś nienaruszony rdzeń fuzyjny.";}, failureEffect:gs=>{gs.resources.population--; gs.dwellers.splice(0,1); return "Rdzeń był niestabilny. Wybuchł, zabijając jednego z techników, którzy ci pomagali.";}}
    ]
},
{
    id: 'rand_d_71', type: 'door', title: "Prośba o złom", image:"vault_door_62.jpg", introduction:"Wędrowiec prosi o kilka kawałków złomu. Twierdzi, że musi naprawić swój oczyszczalnik wody.", description: "Wygląda na uczciwego, ale na Pustkowiach każdy kłamie, by przetrwać.",
    options:[
        {text:"Daj mu trochę złomu", cost:{scrap:15}, effect:gs=>{gs.resources.morale+=5; return "Mężczyzna był niewiarygodnie wdzięczny. Twój gest dobroci podniósł morale załogi.";}},
        {text:"Odmów. Złom jest zbyt cenny.", effect:gs=>{gs.resources.morale-=3; return "Odmówiłeś. Mężczyzna odszedł zawiedziony. Nic wielkiego się nie stało, ale pozostał niesmak.";}},
        {text:"[DYPLOMATA] Zaproponuj wymianę - złom za informacje.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.scrap-=10; const location = EXPEDITION_LOCATIONS[Math.floor(Math.random()*EXPEDITION_LOCATIONS.length)]; return `Wymiana była udana. W zamian za 10 jednostek złomu, wędrowiec opowiedział ci o ukrytym schowku w ${location.name}.`;}, failureEffect:gs=>{gs.resources.morale-=5; return "Twoja próba targu została odebrana jako okrucieństwo. 'Chcesz handlować, gdy umieram z pragnienia?'. Odszedł z pogardą.";}}
    ]
},
{
    id: 'rand_d_72', type: 'door', title: "Artysta-złomiarz", image:"vault_door_62.jpg", introduction:"Przed włazem stoi artysta, który tworzy rzeźby ze złomu. Chce kupić od was trochę 'surowca'.", description: "Oferuje w zamian jedzenie. To nietypowa propozycja.",
    options:[
        {text:"Sprzedaj mu złom", cost:{scrap:30}, effect:gs=>{gs.resources.food+=10; return "<strong class='good'>ZDOBYCZ: 10 żywności.</strong> Dziwny, ale opłacalny interes. Artysta odszedł zadowolony ze swoim 'płótnem'.";}},
        {text:"Odpraw go. Nie mamy złomu na zbyciu.", effect:gs=>{return "Artysta odszedł w poszukiwaniu innego źródła inspiracji.";}},
        {text:"[DYPLOMATA] Zostań jego mecenasem.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.scrap-=20; gs.resources.morale+=10; return "Zgodziłeś się. W zamian za złom, artysta stworzył przed Kryptą imponującą rzeźbę 'Duch Przetrwania'. Podniosła morale i stała się waszym symbolem.";}, failureEffect:gs=>{gs.resources.scrap-=20; gs.resources.morale-=5; return "Rzeźba okazała się być... okropna. Wygląda jak kupa złomu i jest pośmiewiskiem całej okolicy.";}}
    ]
},
{
    id: 'rand_d_73', type: 'door', title: "Konwój z Vertibirdem", image:"vault_door_62.jpg", introduction:"Nisko nad ziemią przelatuje Vertibird eskortowany przez dwa mniejsze statki. Wygląda na transport ważnego ładunku.", description: "Możecie spróbować go zestrzelić, ryzykując potężny odwet, albo pozwolić mu lecieć dalej.",
    options:[
        {text:"Nie ryzykuj. Pozwól im lecieć.", effect:gs=>{return "Konwój przeleciał i zniknął za horyzontem. Uniknąłeś potencjalnie śmiertelnego konfliktu.";}},
        {text:"Zestrzelcie go! (Ryzykowne)", condition: gs => gs.resources.weapons.rifle > 0, skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=40; gs.resources.power+=20; return "<strong class='good'>ZDOBYCZ: 40 złomu, 20 energii.</strong> Udało się! Z wraku Vertibirda odzyskaliście masę zaawansowanego złomu i kilka ogniw fuzyjnych!";}, failureEffect:gs=>{gs.resources.population-=3; gs.dwellers.splice(0,3); gs.resources.morale-=20; return "Eskorta okazała się być zbyt silna. Zanim zestrzeliliście Vertibird, ich działka zdziesiątkowały waszych ludzi. Straty są ogromne.";}},
        {text:"[NAUKOWIEC] Użyj EMP, by zakłócić ich systemy.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=50; gs.resources.power+=20; return "<strong class='good'>ZDOBYCZ: 50 złomu, 20 energii.</strong> Twój impuls zmusił jeden ze statków eskorty do awaryjnego lądowania! Z jego wraku odzyskaliście cenne części.";}, failureEffect:gs=>{gs.machines.powerGenerator.wydajnosc-=25; return "Twój impuls EMP był źle skalibrowany. Spowodował sprzężenie zwrotne, które uszkodziło wasz własny generator.";}}
    ]
},
{
    id: 'rand_d_74', type: 'door', title: "Prośba o schronienie dla Robota", image:"vault_door_62.jpg", introduction:"Przed włazem stoi inteligentny robot typu Assaultron. Twierdzi, że jej obwody moralne nakazują jej opuścić jej okrutnych panów - bandytów.", description: "Prosi o azyl. To zaawansowana maszyna bojowa, ale wpuszczenie jej do środka to ogromne ryzyko.",
    options:[
        {text:"Odmów. Nie ufamy maszynom.", effect:gs=>{return "Robot ukłonił się i odszedł. 'Rozumiem. Logiczne'.";}},
        {text:"Zgódź się, ale najpierw ją rozbrój.", skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=40; return "<strong class='good'>ZDOBYCZ: 40 złomu.</strong> Zgodziła się. Jej broń plazmowa i pancerz dostarczyły wam mnóstwo zaawansowanego złomu.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Próba rozbrojenia została zinterpretowana jako akt agresji. Robot zaatakował, a potem uciekł. Musieliście naprawić uszkodzenia włazu.";}},
        {text:"[NAUKOWIEC] Zaproponuj jej diagnostykę i 'ulepszenie'.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=50; return "<strong class='good'>ZDOBYCZ: 50 złomu.</strong> Zgodziła się. Podczas 'diagnostyki' bezpiecznie wymontowałeś jej najcenniejsze komponenty bojowe, zanim ją wpuściłeś.";}, failureEffect:gs=>{gs.resources.caps-=30; return "Okazało się, że jej oprogramowanie jest bardziej zaawansowane. Zablokowała twoje próby, a potem zażądała 'rekompensaty' w kapslach za stratę czasu.";}}
    ]
},
{
    id: 'rand_d_75', type: 'door', title: "Wędrowny lekarz", image:"vault_door_62.jpg", introduction: "Wędrowny lekarz prosi o trochę czystej wody do przemycia ran pacjenta.", description: "Wygląda na uczciwego, a pomoc może się opłacić.",
    options:[
        {text:"Daj mu wodę", cost:{water:14}, effect:gs=>{gs.resources.morale+=5; return "Lekarz podziękował i odszedł. Twoi ludzie docenili twój gest miłosierdzia.";}},
        {text:"Odmów. Nie mamy wody na zbyciu.", effect:gs=>{gs.resources.morale-=5; return "Odmówiłeś pomocy. Twoi ludzie kwestionują twoje człowieczeństwo.";}},
        {text:"[NAUKOWIEC] Zaoferuj sterylizację jego narzędzi", isClassSpecific: true, classCheck: 'Naukowiec', cost:{power:10}, skillCheck:{}, successEffect:gs=>{gs.resources.morale+=7; return "Zaimponowałeś mu. W zamian za pomoc obiecał rozpowiedzieć o waszej dobroci.";}, failureEffect:gs=>{gs.resources.power-=15; return "Przeciążyłeś system. Straciłeś dodatkową energię, a lekarz odszedł zniesmaczony.";}}
    ]
},
{
    id: 'rand_d_76', type: 'door', title: "Prośba o zasilanie radia", image:"vault_door_62.jpg", introduction: "Grupa osadników prosi o podłączenie radia do waszej sieci, by wysłać wiadomość.", description: "To chwilowe obciążenie dla reaktora, ale może zyskacie ich przychylność.",
    options:[
        {text:"Pozwól im się podłączyć", cost:{power:19}, effect:gs=>{gs.resources.morale+=4; return "Osadnicy byli wdzięczni. Pomoc sąsiedzka podniosła morale.";}},
        {text:"Odmów. Nasza energia jest dla nas.", effect:gs=>{gs.resources.morale-=3; return "Osadnicy odeszli, mamrocząc coś o waszym egoizmie.";}},
        {text:"[DYPLOMATA] Sprzedaj im energię po zawyżonej cenie", isClassSpecific: true, classCheck: 'Dyplomata', cost:{power:19}, skillCheck:{}, successEffect:gs=>{gs.resources.caps+=22; return "Twoje zdolności negocjacyjne przyniosły zysk! Zarobiłeś 22 kapsli.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Przesadziłeś z ceną. Obrażeni, odeszli i rozpowiedzieli w okolicy, że jesteście chciwi.";}}
    ]
},
{
    id: 'rand_d_77', type: 'door', title: "Głodujący zwiadowca", image:"vault_door_62.jpg", introduction: "Samotny zwiadowca prosi o trochę jedzenia, by mógł kontynuować misję.", description: "Jego mundur wygląda na profesjonalny, ale jest brudny i zniszczony.",
    options:[
        {text:"Daj mu jedzenie", cost:{food:13}, effect:gs=>{gs.resources.morale+=4; return "Zwiadowca podziękował i obiecał, że jego frakcja zapamięta ten gest.";}},
        {text:"Odpraw go. Nie karmimy obcych.", effect:gs=>{gs.resources.morale-=4; return "Odesłałeś go o głodzie. Mieszkańcy są zniesmaczeni twoim brakiem empatii.";}},
        {text:"[SIŁACZ] 'Przesłuchaj' go, by dowiedzieć się dla kogo pracuje", isClassSpecific: true, classCheck: 'Siłacz', cost:{food:5}, skillCheck:{}, successEffect:gs=>{gs.resources.morale+=2; return "Okazało się, że pracuje dla Karmazynowej Karawany. Twoja demonstracja siły zyskała ich respekt.";}, failureEffect:gs=>{gs.resources.morale-=6; return "Był twardszy niż myślałeś. Nie zdradził nic, a twoja brutalność przeraziła twoich ludzi.";}}
    ]
},
{
    id: 'rand_d_78', type: 'door', title: "Naprawa pompy wodnej", image:"vault_door_62.jpg", introduction: "Mała karawana ma problem z pompą wodną. Proszą o energię do spawarki.", description: "Pomoc im może zaowocować dobrą reputacją w okolicy.",
    options:[
        {text:"Użycz im energii", cost:{power:21}, effect:gs=>{gs.resources.scrap+=10; gs.resources.morale+=3; return "W podzięce karawana zostawiła wam 10 jednostek złomu. Pomoc się opłaciła.";}},
        {text:"Odmów. Nie stać nas na to.", effect:gs=>{gs.resources.morale-=2; return "Karawana poradziła sobie inaczej, ale zapamiętała waszą niegościnność.";}},
        {text:"[NAUKOWIEC] Zaoferuj naprawę w zamian za zapłatę", isClassSpecific: true, classCheck: 'Naukowiec', cost:{power:10}, skillCheck:{}, successEffect:gs=>{gs.resources.caps+=12; return "Twoje umiejętności zrobiły na nich wrażenie. Zapłacili ci 12 kapsli za naprawę!";}, failureEffect:gs=>{gs.resources.scrap-=15; return "Próbując naprawić ich dziwny silnik, przypadkowo go zepsułeś. Musiałeś dać im części ze swoich zapasów.";}}
    ]
},
{
    id: 'rand_d_79', type: 'door', title: "Spragniona karawana brahminów", image:"vault_door_62.jpg", introduction: "Pasterz brahminów prosi o wodę dla swoich zwierząt.", description: "To duża ilość wody, ale brahminy są cenne na pustkowiach.",
    options:[
        {text:"Daj im wodę", cost:{water:26}, effect:gs=>{gs.resources.morale+=4; return "Wdzięczny pasterz obiecał, że jego karawana będzie was omijać szerokim łukiem... w dobrym tego słowa znaczeniu.";}},
        {text:"Odmów. Nie stać nas na pojenie krów.", effect:gs=>{gs.resources.morale-=4; return "Pasterz odszedł zrezygnowany. Twoi ludzie patrzą na ciebie z potępieniem.";}},
        {text:"[DYPLOMATA] Wynegocjuj symboliczną opłatę", isClassSpecific: true, classCheck: 'Dyplomata', cost:{water:20}, skillCheck:{}, successEffect:gs=>{gs.resources.caps+=10; return "Twoje negocjacje się opłaciły! Zyskałeś 10 kapsli i zużyłeś mniej wody.";}, failureEffect:gs=>{gs.resources.morale-=3; return "Twoje negocjacje go zniechęciły. Odszedł, uważając was za biurokratów.";}}
    ]
},
{
    id: 'rand_d_80', type: 'door', title: "Wymiana handlowa", image:"vault_door_62.jpg", introduction: "Handlarz oferuje wymianę: jedzenie za energię do jego mobilnej lodówki, której generator padł.", description: "To prosta, uczciwa wymiana.",
    options:[
        {text:"Zgódź się na wymianę", cost:{power:17}, effect:gs=>{gs.resources.food+=15; return "Dobra wymiana. Zyskałeś 15 jednostek jedzenia za spory koszt energetyczny.";}},
        {text:"Odmów. Oszczędzamy energię.", effect:gs=>{return "Handlarz poszedł szukać energii gdzie indziej.";}},
        {text:"[SIŁACZ] 'Zaproponuj' lepsze warunki", isClassSpecific: true, classCheck: 'Siłacz', cost:{power:17}, skillCheck:{}, successEffect:gs=>{gs.resources.food+=10; return "Twoja 'perswazja' zadziałała. Dostałeś więcej jedzenia za tę samą cenę.";}, failureEffect:gs=>{gs.resources.morale-=5; return "Handlarz tylko się zaśmiał i odjechał. Twoja reputacja brutala rośnie w okolicy.";}}
    ]
},
{
    id: 'rand_d_81', type: 'door', title: "Uczony z Pustkowi", image:"vault_door_62.jpg", introduction: "Uczony prosi o wodę do swoich eksperymentów chemicznych.", description: "Twierdzi, że pracuje nad nowym rodzajem oczyszczania wody. Wygląda na ekscentryka.",
    options:[
        {text:"Daj mu wodę", cost:{water:11}, effect:gs=>{gs.resources.morale+=2; return "Uczony podziękował i odszedł. Mieszkańcy docenili wsparcie dla nauki.";}},
        {text:"Odpraw go. Nie sponsorujemy dziwaków.", effect:gs=>{gs.resources.morale-=3; return "Uczony odszedł, mamrocząc o 'krótkowzroczności'.";}},
        {text:"[NAUKOWIEC] Zaproś go do laboratorium", isClassSpecific: true, classCheck: 'Naukowiec', cost:{water:11}, skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=10; return "Wasze połączone umysły dokonały przełomu! Opracowaliście nowy schemat, który dał wam 10 złomu.";}, failureEffect:gs=>{gs.machines.waterPurifier.wydajnosc-=15; return "Jego metody były zbyt chaotyczne. Eksperyment skończył się małą eksplozją, która uszkodziła pompę.";}}
    ]
},
{
    id: 'rand_d_82', type: 'door', title: "Awaria oświetlenia", image:"vault_door_62.jpg", introduction: "Grupa podróżników rozbiła obóz niedaleko. Ich reflektory, odstraszające drapieżniki, zepsuły się. Proszą o energię.", description: "Pomoc im to gest dobrej woli, który może zostać zapamiętany.",
    options:[
        {text:"Użycz im energii", cost:{power:24}, effect:gs=>{gs.resources.morale+=5; return "Podróżnicy byli wdzięczni. Rano odjechali, opowiadając o 'pomocnych ludziach z Krypty 62'.";}},
        {text:"Odmów. Muszą radzić sobie sami.", effect:gs=>{gs.resources.morale-=7; return "W nocy słyszeliście krzyki. Rano po obozie nie było śladu, tylko ślady krwi. Mieszkańcy są przerażeni.";}},
        {text:"[DYPLOMATA] Zaoferuj pomoc w zamian za przysługę", isClassSpecific: true, classCheck: 'Dyplomata', cost:{power:24}, skillCheck:{}, successEffect:gs=>{gs.resources.morale+=3; return "Zgodzili się. Zyskałeś 'dług wdzięczności' u wpływowej grupy na Pustkowiach.";}, failureEffect:gs=>{gs.resources.morale-=4; return "Wyśmiali cię. 'Na pustkowiach nie ma przyszłości'. Odeszli, by stawić czoła nocy samotnie.";}}
    ]
},
{
    id: 'rand_d_83', type: 'door', title: "Głodujący pielgrzymi", image:"vault_door_62.jpg", introduction: "Grupa pielgrzymów, zmierzająca do świętego miejsca, prosi o jedzenie.", description: "Wyglądają na biednych, ale ich wiara jest silna.",
    options:[
        {text:"Daj im jedzenie", cost:{food:20}, effect:gs=>{gs.resources.morale+=7; return "Pielgrzymi pobłogosławili waszą Kryptę. Twój gest miłosierdzia podniósł morale.";}},
        {text:"Odmów.", effect:gs=>{gs.resources.morale-=5; return "Odmówiłeś jedzenia głodnym. Nawet najtwardsi strażnicy patrzą na ciebie z dezaprobatą.";}},
        {text:"[SIŁACZ] Zaoferuj im pracę w zamian za jedzenie", isClassSpecific: true, classCheck: 'Siłacz', cost:{food:20}, skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=5; return "Zgodzili się. W zamian za jedzenie, wykonali ciężką pracę, odzyskując 5 złomu.";}, failureEffect:gs=>{gs.resources.morale-=6; return "Odmówili. 'Nasza praca jest dla boga'. Odeszli, a ty zostałeś uznany za bezdusznego wyzyskiwacza.";}}
    ]
},
{
    id: 'rand_d_84', type: 'door', title: "Zepsuty filtr wody", image:"vault_door_62.jpg", introduction: "Samotna kobieta ma zepsuty filtr do wody. Prosi o trochę waszej czystej wody.", description: "Wygląda na zaradną, ale zdesperowaną.",
    options:[
        {text:"Daj jej wodę", cost:{water:10}, effect:gs=>{gs.resources.morale+=2; return "Wróciła następnego dnia. W podzięce dała wam kilka przydatnych ziół.";}},
        {text:"Odmów. Woda jest na wagę złota.", effect:gs=>{return "Kobieta wzruszyła ramionami i odeszła w poszukiwaniu innego źródła.";}},
        {text:"[NAUKOWIEC] Zaoferuj naprawę filtra", isClassSpecific: true, classCheck: 'Naukowiec', cost:{water:5}, skillCheck:{}, successEffect:gs=>{gs.resources.scrap+=10; return "Naprawiłeś filtr, a w zamian mogłeś zatrzymać kilka komponentów. Zyskałeś 10 złomu.";}, failureEffect:gs=>{gs.resources.scrap-=10; return "Filtr okazał się zbyt skomplikowany. Straciłeś czas i części warte 10 złomu.";}}
    ]
},
{
    id: 'rand_d_85', type: 'door', title: "Awaryjne ładowanie", image:"vault_door_62.jpg", introduction: "Mały pojazd zwiadowczy zatrzymał się przed Kryptą. Kierowca prosi o energię do naładowania akumulatora.", description: "Twierdzi, że zabłądził.",
    options:[
        {text:"Naładuj jego pojazd", cost:{power:29}, effect:gs=>{gs.resources.morale+=2; return `W podzięce zwiadowca podzielił się informacją o pobliskim źródle wody.`;}},
        {text:"Odmów. Nie ufamy obcym.", effect:gs=>{return "Zwiadowca musiał czekać na pomoc ze swojej bazy. Zapamiętają waszą niegościnność.";}},
        {text:"[DYPLOMATA] Przesłuchaj go, by dowiedzieć się więcej", isClassSpecific: true, classCheck: 'Dyplomata', cost:{power:29}, skillCheck:{}, successEffect:gs=>{gs.resources.caps+=20; return "Okazało się, że to kurier. Twoja rozmowa sprawiła, że zapłacił za 'usługę ratunkową' 20 kapsli.";}, failureEffect:gs=>{gs.resources.morale-=4; return "Twoje pytania go zdenerwowały. Po naładowaniu odjechał, rzucając przekleństwa.";}}
    ]
},
{
    id: 'rand_d_86', type: 'door', title: "Zapasy na zimę", image:"vault_door_62.jpg", introduction: "Osada w pobliżu robi zapasy na zimę. Chcą kupić od was dużą partię jedzenia.", description: "Oferują dobrą cenę, ale to uszczupli wasze rezerwy.",
    options:[
        {text:"Sprzedaj im jedzenie", cost:{food:30}, effect:gs=>{gs.resources.caps+=10; return "Dobry interes. Zarobiłeś 10 kapsli, a osadnicy są wam wdzięczni.";}},
        {text:"Odmów. Sami potrzebujemy zapasów.", effect:gs=>{gs.resources.morale-=3; return "Odmówiłeś. Osadnicy będą musieli szukać jedzenia gdzie indziej.";}},
        {text:"[SIŁACZ] Zaoferuj 'ochronę' w zamian za przyszłe zbiory", isClassSpecific: true, classCheck: 'Siłacz', cost:{food:10}, skillCheck:{}, successEffect:gs=>{return "Zgodzili się. To początek waszego małego imperium. W zamian za jedzenie i ochronę, będą wam oddawać część zbiorów.";}, failureEffect:gs=>{gs.resources.morale-=6; return "Wyśmiali cię. 'Nie potrzebujemy gangsterów'. Odeszli, a twoi ludzie są zażenowani.";}}
    ]
},
{
    id: 'rand_d_87', type: 'door', title: "Prośba o zasilenie wieży radiowej", image:"vault_door_62.jpg", introduction: "Grupa techników próbuje naprawić starą wieżę radiową. Potrzebują impulsu energii, by ją uruchomić.", description: "Jeśli im się uda, może to poprawić komunikację w regionie.",
    options:[
        {text:"Dostarcz impuls energetyczny", cost:{power:31}, effect:gs=>{gs.resources.morale+=6; return "Wieża ożyła! Komunikacja w regionie jest teraz łatwiejsza.";}},
        {text:"Odmów. Zbyt duże ryzyko.", effect:gs=>{return "Technicy porzucili projekt. Wieża pozostaje milcząca.";}},
        {text:"[NAUKOWIEC] Pomóż im skalibrować cewki", isClassSpecific: true, classCheck: 'Naukowiec', cost:{power:15}, skillCheck:{}, successEffect:gs=>{gs.resources.morale+=8; return "Twoja wiedza była kluczowa! Zużyliście o połowę mniej energii, a wieża działa perfekcyjnie!";}, failureEffect:gs=>{gs.resources.power-=20; return "Twoja 'pomoc' spaliła kluczowy przekaźnik. Straciłeś dodatkową energię i ich zaufanie.";}}
    ]
},
{
    id: 'rand_d_88', type: 'door', title: "Głodni podróżnicy", image:"vault_door_62.jpg", introduction: "Niewielka grupa podróżników prosi o jedzenie. Zostali niedawno obrabowani.", description: "Wyglądają na porządnych ludzi w tarapatach.",
    options:[
        {text:"Daj im trochę jedzenia", cost:{food:16}, effect:gs=>{gs.resources.morale+=5; return "Byli niewiarygodnie wdzięczni. Twój gest człowieczeństwa został zauważony przez twoich ludzi.";}},
        {text:"Odmów. Każdy dba o siebie.", effect:gs=>{gs.resources.morale-=6; return "Odesłałeś głodnych ludzi. To źle wpłynęło na morale.";}},
        {text:"[DYPLOMATA] Wysłuchaj ich historii i zaoferuj skromną pomoc", isClassSpecific: true, classCheck: 'Dyplomata', cost:{food:8}, skillCheck:{}, successEffect:gs=>{gs.resources.morale+=7; return "Twoja empatia zrobiła na nich wrażenie. Z wdzięcznością przyjęli nawet niewielką pomoc.";}, failureEffect:gs=>{gs.resources.morale-=4; return "Twoje słowa brzmiały fałszywie. Poczuli się protekcjonalnie potraktowani i odeszli z niesmakiem.";}}
    ]
},
{
    id: 'rand_d_89', type: 'door', title: "Wymiana wody za informacje", image:"vault_door_62.jpg", introduction: "Doświadczony zwiadowca oferuje informacje o ruchach bandytów w zamian za wodę.", description: "Wiedza to potęga, ale woda to życie.",
    options:[
        {text:"Zgódź się na wymianę", cost:{water:22}, effect:gs=>{gs.resources.morale+=4; return "Informacje były cenne. Wiesz teraz, których szlaków unikać. To zwiększyło poczucie bezpieczeństwa.";}},
        {text:"Odmów. Nie ufamy szpiegom.", effect:gs=>{gs.resources.morale-=2; return "Zwiadowca odszedł. Pozostajesz w nieświadomości co do zagrożeń w okolicy.";}},
        {text:"[SIŁACZ] 'Wyciągnij' z niego informacje siłą", isClassSpecific: true, classCheck: 'Siłacz', cost:{power:5}, skillCheck:{}, successEffect:gs=>{gs.resources.morale+=2; return "Złamał się. Wyjawił wszystko, co wiedział, a ty nie straciłeś ani kropli wody.";}, failureEffect:gs=>{gs.resources.morale-=7; return "Okazało się, że był częścią zasadzki. Jego towarzysze zaatakowali, gdy otworzyłeś właz. Odparliście ich, ale z trudem.";}}
    ]
},
{
    id: 'rand_d_90', type: 'door', title: "Spragniony Wędrowiec", image:"vault_door_62.jpg", introduction: "Przez interkom odzywa się mężczyzna. Jego głos jest słaby. Błaga o trochę wody.", description: "Twierdzi, że jego manierka jest pusta od dwóch dni. Wygląda na samotnego i nieuzbrojonego.",
    options:[
        {text:"Daj mu wodę przez podajnik", cost:{water:10}, effect:gs=>{gs.resources.morale+=4; return "Wędrowiec wypił wodę, podziękował i ruszył w dalszą drogę. Twój gest miłosierdzia został doceniony przez strażników.";}},
        {text:"Odmów. Nie stać nas na jałmużnę.", effect:gs=>{gs.resources.morale-=4; return "Odesłałeś go na pewną śmierć. Ten czyn będzie ciążył na twoim sumieniu.";}},
        {text:"[DYPLOMATA] Zaoferuj wodę w zamian za jakąś historię.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.water-=5; gs.resources.morale+=6; return "Opowiedział fascynującą historię o upadku pobliskiej osady. Mieszkańcy słuchali z zapartym tchem. Dałeś mu mniej wody, ale dałeś też chwilę uwagi.";}, failureEffect:gs=>{gs.resources.morale-=6; return "Twoja propozycja została odebrana jako okrucieństwo. 'Umieram z pragnienia, a ty chcesz bajek?'. Odszedł z pogardą.";}}
    ]
},
{
    id: 'rand_d_91', type: 'door', title: "Głodny Prospektor", image:"vault_door_62.jpg", introduction: "Stary prospektor oferuje kilka bezwartościowych, błyszczących kamieni w zamian za jedzenie.", description: "Jest wyraźnie głodny. Kamienie są bezużyteczne, więc to w zasadzie darowizna.",
    options:[
        {text:"Daj mu trochę jedzenia", cost:{food:12}, effect:gs=>{gs.resources.morale+=4; return "Prospektor był niezwykle wdzięczny. Odszedł, zostawiając ci bezużyteczne, ale ładne kamienie. Mieszkańcy docenili twój gest.";}},
        {text:"Odmów. Nie prowadzimy działalności charytatywnej.", effect:gs=>{gs.resources.morale-=5; return "Odprawiłeś głodnego starca. Nawet najtwardsi mieszkańcy uważają, że to było zbyt surowe.";}},
        {text:"[SIŁACZ] Powiedz, że weźmiesz kamienie i dasz mu resztki.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.food-=5; gs.resources.morale+=2; return "Twoja 'oferta' została przyjęta. Dałeś mu najgorsze jedzenie, ale dla niego to i tak była uczta. Zaoszczędziłeś lepsze zasoby.";}, failureEffect:gs=>{gs.resources.morale-=6; return "Prospektor splunął ci pod nogi, nazwał hieną i odszedł. Twoi ludzie są zażenowani twoim skąpstwem.";}}
    ]
},
{
    id: 'rand_d_92', type: 'door', title: "Zbiegowie", image:"vault_door_62.jpg", introduction: "Dwójka zbiegów, wyglądających na byłych niewolników, prosi o jedzenie i wodę.", description: "Są wyczerpani i przerażeni. Pomoc im może ściągnąć na was uwagę ich byłych panów.",
    options:[
        {text:"Daj im zapasy i wskaż bezpieczną drogę", cost:{food:10, water:10}, effect:gs=>{gs.resources.morale+=7; return "Pomogłeś im uciec. Twój akt odwagi i współczucia zaimponował mieszkańcom.";}},
        {text:"Odmów. Nie mieszamy się w takie sprawy.", effect:gs=>{gs.resources.morale-=7; return "Patrzyliście, jak odchodzą w nieznane. Wasza bierność jest przytłaczająca.";}},
        {text:"[DYPLOMATA] Przesłuchaj ich, by dowiedzieć się, skąd uciekli.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.food-=5; gs.resources.water-=5; return "Zdobyłeś cenne informacje o pobliskim obozie bandytów. Ta wiedza może się przydać w przyszłości. Dałeś im też skromne zapasy.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Byli zbyt przerażeni, by mówić. Twoje naciskanie tylko pogorszyło sprawę. Odeszli, bojąc się ciebie tak samo jak swoich oprawców.";}}
    ]
},
{
    id: 'rand_d_93', type: 'door', title: "Wymiana Receptur", image:"vault_door_62.jpg", introduction: "Wędrowny kucharz oferuje wymianę: jego tajna receptura na gulasz z mutaszczura za kilka świeżych warzyw z waszej hydroponiki.", description: "Receptura może wzbogacić wasze menu.",
    options:[
        {text:"Wymień się", cost:{food:10}, effect:gs=>{gs.resources.morale+=6; return "Gulasz jest zaskakująco dobry! Mieszkańcy mają nowy ulubiony posiłek, a morale wzrosło.";}},
        {text:"Odmów. Nie jemy mutaszczurów.", effect:gs=>{return "Kucharz wzruszył ramionami. 'Wasza strata'. I poszedł dalej.";}},
        {text:"[DYPLOMATA] Spróbuj zdobyć przepis za darmo, komplementując jego sztukę.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=8; return "Twój potok komplementów tak mu schlebił, że podzielił się przepisem za darmo! Jesteś mistrzem dyplomacji.";}, failureEffect:gs=>{gs.resources.morale-=4; return "Przejrzał twój tani podstęp. Nazwał cię lizusem i odszedł obrażony.";}}
    ]
},
{
    id: 'rand_d_94', type: 'door', title: "Tajemnicze Nasiona", image:"vault_door_62.jpg", introduction: "Tajemnicza, zakapturzona postać oferuje sprzedaż 'magicznych nasion', które rzekomo nie potrzebują dużo wody.", description: "To brzmi jak oczywiste oszustwo, ale co jeśli...",
    options:[
        {text:"Zaryzykuj i kup nasiona", cost:{food:10}, skillCheck:{}, successEffect:gs=>{return "Nasiona rzeczywiście wyrosły na dziwne, ale jadalne pnącza, które wymagają mało wody! To przełom dla waszej hydroponiki!";}, failureEffect:gs=>{gs.resources.morale-=4; return "Z nasion nic nie wyrosło. Zostałeś oszukany i straciłeś jedzenie.";}},
        {text:"Odpraw oszusta.", effect:gs=>{return "Postać zniknęła w mroku tak samo tajemniczo, jak się pojawiła.";}},
        {text:"[NAUKOWIEC] Zbadaj jedno nasiono przed zakupem.", isClassSpecific: true, classCheck: 'Naukowiec', skillCheck:{}, successEffect:gs=>{return "Twoja analiza wykazała, że nasiona mają niezwykłą zdolność do absorpcji wilgoci z powietrza. Kupiłeś je, wiedząc, że to dobra inwestycja.";}, failureEffect:gs=>{return "Analiza wykazała, że to zwykłe, pomalowane kamyki. Zdemaskowałeś oszusta, który szybko uciekł.";}}
    ]
},
{
    id: 'rand_d_95', type: 'door', title: "Utracony patrol", image:"vault_door_62.jpg", introduction: "Ranny żołnierz Bractwa Stali doczołgał się do waszych drzwi. Jego patrol wpadł w zasadzkę.", description: "Prosi o jedzenie i wodę, by móc wrócić do swoich. Pomoc mu może być odczytana jako sprzymierzenie się z Bractwem.",
    options:[
        {text:"Udziel mu pomocy", cost:{food:10, water:10}, effect:gs=>{gs.resources.morale+=5; return "Żołnierz podziękował i obiecał, że Bractwo zapamięta ten gest. Pomoc rannemu to zawsze dobry uczynek.";}},
        {text:"Odmów. Nie mieszamy się w sprawy Bractwa.", effect:gs=>{gs.resources.morale-=5; return "Żołnierz odszedł, rzucając wam gniewne spojrzenie. Bractwo Stali ma długą pamięć.";}},
        {text:"[SIŁACZ] Opatrz go, ale w zamian za jego pistolet laserowy.", isClassSpecific: true, classCheck: 'Siłacz', skillCheck:{}, successEffect:gs=>{gs.resources.food-=10; gs.resources.water-=10; gs.resources.scrap+=20; return "<strong class='good'>ZDOBYCZ: 20 złomu.</strong> Zgodził się. Pistolet był uszkodzony, ale odzyskałeś z niego 20 jednostek zaawansowanego złomu.";}, failureEffect:gs=>{gs.resources.stimpaks-=1; return "Próbował cię oszukać. Doszło do szarpaniny, w której zostałeś ranny. Musiałeś użyć Stimpaka.";}}
    ]
},
{
    id: 'rand_d_96', type: 'door', title: "Prośba o ostatni posiłek", image:"vault_door_62.jpg", introduction: "Stary, umierający człowiek prosi o jeden, porządny, ciepły posiłek przed śmiercią.", description: "Jego prośba jest prosta, ale wzruszająca. To test waszego człowieczeństwa.",
    options:[
        {text:"Spełnij jego życzenie", cost:{food:10}, effect:gs=>{gs.resources.morale+=10; return "Starzec zjadł posiłek, podziękował i umarł w spokoju. Twój gest miłosierdzia został zapamiętany przez wszystkich.";}},
        {text:"Odmów. Nie marnujemy jedzenia na umierających.", effect:gs=>{gs.resources.morale-=10; return "Twoja bezduszna decyzja wstrząsnęła Kryptą. Ludzie patrzą na ciebie z odrazą.";}},
        {text:"[DYPLOMATA] Usiądź z nim i opowiedz mu o najlepszych posiłkach sprzed wojny.", isClassSpecific: true, classCheck: 'Dyplomata', skillCheck:{}, successEffect:gs=>{gs.resources.morale+=12; return "Twoje opowieści były tak barwne i sugestywne, że starzec umarł z uśmiechem na twarzy, 'najedzony' twoimi historiami. Podniosłeś morale, nie zużywając zasobów.";}, failureEffect:gs=>{gs.resources.morale-=8; return "Starzec, słuchając o pysznościach, których nigdy nie zje, tylko bardziej się załamał. Twoje słowa były torturą, nie pocieszeniem.";}}
    ]
}






]
          

    RANDOM_VAULT_EVENTS = ALL_RANDOM_EVENTS.filter(e => e.type === 'vault');
    RANDOM_DOOR_EVENTS = ALL_RANDOM_EVENTS.filter(e => e.type === 'door');
    CLASS_SPECIFIC_EVENTS = ALL_RANDOM_EVENTS.filter(e => e.isClassSpecific);
    
EXPEDITION_LOCATIONS = [
    // --- LOKACJE NISKIEGO RYZYKA (podstawowe zasoby) ---
    { id: 1, name: "Opuszczona stacja Red Rocket", x: 25, y: 35, risk: "Niskie", duration: [5, 7], lootChanceModifier: 1.0, durationModifier: 1.0, loot: {
        good: gs => { gs.resources.scrap += 20; gs.resources.caps += 10; return { desc: "20 złomu i 10 kapsli." }; },
        mediocre: gs => { gs.resources.scrap += 15; return { desc: "trochę przydatnego złomu (15 jedn.)." }; },
        bad: gs => { gs.resources.caps += 5; return { desc: "kilka kapsli i zardzewiałą puszkę." }; },
        nothing: gs => { return { desc: "absolutnie nic wartościowego." }; }
    }},
    { id: 10, name: "Samotna farma", x: 45, y: 20, risk: "Niskie", duration: [6, 8], lootChanceModifier: 1.1, durationModifier: 0.9, loot: {
        good: gs => { gs.resources.food += 30; gs.resources.water += 10; return { desc: "worki z warzywami (30 żywności) i 10 jedn. wody." }; },
        mediocre: gs => { gs.resources.food += 20; return { desc: "kilka worków z ziarnem (20 żywności)." }; },
        bad: gs => { gs.resources.food += 5; return { desc: "kilku zmutowanych melonów." }; },
        nothing: gs => { return { desc: "wyschniętej ziemi i niczego więcej." }; }
    }},

    // --- LOKACJE ŚREDNIEGO RYZYKA (lepsze zasoby, szansa na pistolet/jeden Stimpak) ---
    { id: 2, name: "Super-Duper Mart", x: 48, y: 55, risk: "Średnie", duration: [6, 9], lootChanceModifier: 1.2, durationModifier: 1.0, loot: {
        good: gs => { gs.resources.food += 40; gs.resources.caps += 20; return { desc: "dużą ilość jedzenia w puszkach (40 jedn.) i 20 kapsli." }; },
        mediocre: gs => { gs.resources.food += 25; return { desc: "kilka puszek fasoli (25 jedn.)." }; },
        bad: gs => { gs.resources.food += 10; return { desc: "jedną, wgniecioną puszkę psiej karmy." }; },
        nothing: gs => { return { desc: "pustych półek i niczego więcej." }; }
    }},
    { id: 3, name: "Szkoła w Springvale", x: 65, y: 28, risk: "Średnie", duration: [7, 10], lootChanceModifier: 1.0, durationModifier: 1.1, loot: {
        good: gs => { gs.resources.stimpaks += 1; gs.resources.scrap += 10; return { desc: "jeden cenny Stimpak i 10 złomu." }; },
        mediocre: gs => { gs.resources.scrap += 20; return { desc: "trochę złomu z szafek szkolnych (20 jedn.)." }; },
        bad: gs => { gs.resources.scrap += 5; return { desc: "kilka spalonych książek." }; },
        nothing: gs => { return { desc: "wszędobylskiego kurzu i zapomnienia." }; }
    }},

    // --- LOKACJE WYSOKIEGO RYZYKA (bardzo dobre zasoby, broń, Stimpaki) ---
    { id: 4, name: "Gniazdo radskorpionów", x: 88, y: 75, risk: "Wysokie", duration: [8, 12], lootChanceModifier: 1.2, durationModifier: 1.2, loot: {
        good: gs => { gs.resources.weapons.pistol++; gs.resources.caps += 30; return { desc: "pistolet 10mm i 30 kapsli przy zwłokach poszukiwacza przygód." }; },
        mediocre: gs => { gs.resources.food += 20; return { desc: "kilka jaj radskorpiona (20 jedn. jedzenia)." }; },
        bad: gs => { return { desc: "tylko jadowity kolec i masę strachu." }; },
        nothing: gs => { return { desc: "śladów walki, ale żadnych łupów." }; }
    }},
    { id: 5, name: "Szpital Our Lady of Hope", x: 38, y: 70, risk: "Wysokie", duration: [9, 13], lootChanceModifier: 1.4, durationModifier: 1.1, loot: {
        good: gs => { gs.resources.stimpaks += 3; return { desc: "całe pudełko Stimpaków! To prawdziwy skarb (3 jedn.)." }; },
        mediocre: gs => { gs.resources.stimpaks += 1; return { desc: "jednego, cennego Stimpaka." }; },
        bad: gs => { gs.resources.scrap += 10; return { desc: "puste opakowania po lekach i bandaże." }; },
        nothing: gs => { return { desc: "ciszy opuszczonych sal operacyjnych." }; }
    }},
    { id: 7, name: "Posterunek Gwardii Narodowej", x: 78, y: 50, risk: "Wysokie", duration: [11, 15], lootChanceModifier: 1.3, durationModifier: 1.2, loot: {
        good: gs => { gs.resources.weapons.rifle++; return { desc: "doskonale zachowany karabin bojowy." }; },
        mediocre: gs => { gs.resources.weapons.pistol++; return { desc: "pistolet 10mm i dwa magazynki." }; },
        bad: gs => { gs.resources.scrap += 15; return { desc: "trochę zardzewiałego złomu i stare hełmy." }; },
        nothing: gs => { return { desc: "pustych skrzyń po amunicji." }; }
    }},
    { id: 9, name: "Obóz Bandytów", x: 60, y: 80, risk: "Wysokie", duration: [8, 11], lootChanceModifier: 1.2, durationModifier: 0.9, loot: {
        good: gs => { gs.resources.caps += 80; gs.resources.weapons.shotgun++; return { desc: "strzelbę i 80 kapsli z haraczy." }; },
        mediocre: gs => { gs.resources.caps += 40; return { desc: "sakiewkę z 40 kapslami." }; },
        bad: gs => { gs.resources.food += 10; return { desc: "resztki jedzenia z ogniska (10 jedn.)." }; },
        nothing: gs => { return { desc: "oprócz smrodu i brudu - niczego." }; }
    }},

    // --- LOKACJE BARDZO WYSOKIEGO RYZYKA (najlepsze nagrody w grze, wymagają skafandrów) ---
    { id: 6, name: "Radioaktywny Krater", x: 12, y: 85, risk: "Bardzo Wysokie", duration: [10, 14], lootChanceModifier: 1.5, durationModifier: 1.3, hazmatRequired: true, loot: {
        good: gs => { gs.resources.power += 40; return { desc: "kilka nietkniętych ogniw termojądrowych (+40 energii)." }; },
        mediocre: gs => { gs.resources.scrap += 25; return { desc: "napromieniowane, ale cenne części metalowe (25 złomu)." }; },
        bad: gs => { gs.resources.scrap += 10; return { desc: "bezwartościowy, stopiony metal (10 złomu)." }; },
        nothing: gs => { return { desc: "tylko wysokiej dawki promieniowania i niczego więcej." }; }
    }},
    { id: 8, name: "Zatopiona Siedziba Vault-Tec", x: 22, y: 60, risk: "Bardzo Wysokie", duration: [12, 16], lootChanceModifier: 1.4, durationModifier: 1.4, hazmatRequired: true, loot: {
        good: gs => { gs.resources.hazmatSuits += 2; return { desc: "dwa prototypowe skafandry ochronne! Inwestycja się zwróciła z nawiązką." }; },
        mediocre: gs => { gs.resources.caps += 75; return { desc: "sejf z 75 kapslami." }; },
        bad: gs => { gs.resources.caps += 20; return { desc: "kilka kapsli na dnie zalanego biurka." }; },
        nothing: gs => { return { desc: "zalanych wodą terminali i niczego więcej." }; }
    }},
];


TRADING_POSTS = [
    {
        id: 2, name: "Karmazynowa Karawana", defense: 9999,
        description: "Legendarni handlarze. Mają najlepszy towar, ale atak na nich to samobójstwo.",
        wares: [ // TO CO KUPUJESZ (DROGO)
            { name: "Karabin Bojowy", type: "weapon", key: "rifle", amount: 1, price: 150 },
            { name: "Stimpak", type: "resource", key: "stimpaks", amount: 1, price: 50 },
            { name: "Energia (x10)", type: "resource", key: "power", amount: 10, price: 15 },
            { name: "Woda (x10)", type: "resource", key: "water", amount: 10, price: 15 },
            { name: "Żywność (x10)", type: "resource", key: "food", amount: 10, price: 15 },
            { name: "Złom (x10)", type: "resource", key: "scrap", amount: 10, price: 15 }
        ],
        willBuy: [ // TO CO SPRZEDAJESZ (TANIO)
            { name: "Energia (x10)", key: "power", amount: 10, price: 5 },
            { name: "Woda (x10)", key: "water", amount: 10, price: 5 },
            { name: "Żywność (x10)", key: "food", amount: 10, price: 5 },
            { name: "Złom (x10)", key: "scrap", amount: 10, price: 5 }
        ],
        loot: { success: gs => ({desc: ""}), failure: gs => ({desc: ""}) }
    },
    {
        id: 5, name: "Krypta 22 (Rolnicza)", defense: 60,
        description: "Krypta-ogród. Toną w jedzeniu, ale desperacko potrzebują części do maszyn.",
        wares: [
            { name: "Żywność (x20)", type: "resource", key: "food", amount: 20, price: 30 },
            { name: "Woda (x20)", type: "resource", key: "water", amount: 20, price: 30 }
        ],
        willBuy: [ 
            { name: "Złom (x20)", key: "scrap", amount: 20, price: 10 },
            { name: "Energia (x20)", key: "power", amount: 20, price: 10 }
        ],
        loot: {
            success: gs => { gs.resources.food += 30; gs.resources.morale -= 10; return { desc: "Zwycięstwo! Spiżarnie Krypty 22 są nasze. ZDOBYCZ: 30 żywności." }; },
            failure: gs => { gs.resources.population -= 1; if (gs.dwellers.length > 1) gs.dwellers.splice(0, 1); gs.resources.morale -= 10; return { desc: "Porażka. Ich ogrodnicy walczyli jak fanatycy. Straciliśmy 1 osobę." }; }
        }
    },
    {
        id: 6, name: "Krypta 34 (Militarna)", defense: 180,
        description: "Pełna broni, ale ich systemy ledwo działają. Chętnie kupią energię.",
        wares: [
            { name: "Strzelba", type: "weapon", key: "shotgun", amount: 1, price: 110 },
            { name: "Amunicja (x10 złomu)", type: "resource", key: "scrap", amount: 10, price: 5 }
        ],
        willBuy: [ 
            { name: "Energia (x30)", key: "power", amount: 30, price: 15 },
            { name: "Żywność (x30)", key: "food", amount: 30, price: 15 }
        ],
        loot: {
            success: gs => { gs.resources.weapons.rifle += 1; gs.resources.weapons.shotgun += 1; gs.resources.morale -= 10; return { desc: "Zbrojownia zdobyta! ZDOBYCZ: 1 Karabin, 1 Strzelba." }; },
            failure: gs => { gs.resources.population -= 2; if (gs.dwellers.length > 2) gs.dwellers.splice(0, 2); return { desc: "Zostaliśmy zmiażdżeni przez ich wyszkolonych strażników. Straciliśmy 2 ludzi." }; }
        }
    },
    {
        id: 7, name: "Krypta 81 (Medyczna)", defense: 70,
        description: "Przyjazna społeczność z doskonałym zapleczem medycznym. Potrzebują czystej wody.",
        wares: [
            { name: "Stimpak", type: "resource", key: "stimpaks", amount: 1, price: 50 },
            { name: "Bandaże (x5 złomu)", type: "resource", key: "scrap", amount: 5, price: 3 }
        ],
        willBuy: [ 
            { name: "Woda (x20)", key: "water", amount: 20, price: 10 },
            { name: "Żywność (x20)", key: "food", amount: 20, price: 10 }
        ],
        loot: {
            success: gs => { gs.resources.stimpaks += 2; gs.resources.scrap += 20; gs.resources.morale -= 10; return { desc: "Włamaliśmy się do ich ambulatorium! ZDOBYCZ: 2 Stimpaki, 20 złomu." }; },
            failure: gs => { gs.resources.morale -= 15; gs.resources.caps -= 30; return { desc: "Zostaliśmy odparci. Musieliśmy zapłacić 30 kapsli, by pozwolili nam odejść w spokoju." }; }
        }
    },
    {
        id: 11, name: "Krypta 15 (Socjologiczna)", defense: 50,
        description: "Mieszkańcy cenią wiedzę i komfort psychiczny ponad wszystko.",
        wares: [
            { name: "Książka sprzed wojny (+2 morale)", type: "resource", key: "morale", amount: 2, price: 3},
            { name: "Czysty kombinezon (+5 morale)", type: "resource", key: "morale", amount: 5, price: 10}
        ],
        willBuy: [ 
            { name: "Stimpak", key: "stimpaks", amount: 1, price: 30 },
            { name: "Energia (x40)", key: "power", amount: 40, price: 20 }
        ],
        loot: {
            success: gs => { gs.resources.caps += 15; gs.resources.morale -= 10; return { desc: "Ich biblioteka nie miała obrony. ZDOBYCZ: Cenne dane warte 15 kapsli." }; },
            failure: gs => { gs.resources.morale -= 20; return { desc: "Porażka. Użyli swojej wiedzy psychologicznej, by zdemoralizować naszych ludzi."}; }
        }
    },
    {
        id: 12, name: "Krypta 76 (Odbudowa)", defense: 120,
        description: "Ci ludzie są zdeterminowani, by odbudować Amerykę. Dobrze zorganizowani i uzbrojeni.",
        wares: [
            { name: "Zestaw narzędzi (x30 złomu)", type: "resource", key: "scrap", amount: 30, price: 15 },
            { name: "Pistolet", type: "weapon", key: "pistol", amount: 1, price: 90 }
        ],
        willBuy: [ 
            { name: "Żywność (x10)", key: "food", amount: 10, price: 5 },
            { name: "Woda (x10)", key: "water", amount: 10, price: 5 }
        ],
        loot: {
            success: gs => { gs.resources.scrap += 30; gs.resources.morale -= 10; return { desc: "Ich magazyn budowlany stoi otworem! ZDOBYCZ: 30 jednostek złomu." }; },
            failure: gs => { gs.resources.population -= 2; if (gs.dwellers.length > 2) gs.dwellers.splice(0, 2); return { desc: "Byli zbyt dobrze zorganizowani. Straciliśmy 2 ludzi w starciu z ich milicją." }; }
        }
    },
    {
        id: 13, name: "Krypta 95 (Rehabilitacyjna)", defense: 85,
        description: "Krypta pełna niestabilnych mieszkańców i chemikaliów. Są nieprzewidywalni.",
        wares: [
            { name: "Psycho (-5 morale)", type: "resource", key: "morale", amount: -5, price: 5 },
            { name: "Jet (-10 żywności)", type: "resource", key: "food", amount: -10, price: 10 }
        ],
        willBuy: [ 
            { name: "Woda (x10)", key: "water", amount: 10, price: 5 },
            { name: "Stimpak", key: "stimpaks", amount: 1, price: 30 }
        ],
        loot: {
            success: gs => { gs.resources.stimpaks += 2; gs.resources.scrap += 15; gs.resources.morale -= 10; return { desc: "Ich laboratorium chemiczne jest nasze! ZDOBYCZ: 2 Stimpaki, 15 złomu." }; },
            failure: gs => { gs.resources.morale -= 20; return { desc: "Porażka. Wypuścili na nas chmurę halucynogennego gazu. Nasi ludzie uciekli w panice."}; }
        }
    }
];

    ENDINGS = {
    Upadek: {isPositive:false, title:"ZAKOŃCZENIE: UPADEK", description:"Morale sięgnęło dna. Mieszkańcy mieli dość twoich rządów, głodu i strachu. Tłum wdarł się do biura Nadzorcy i pozbawił cię władzy w brutalny sposób. Krypta 62 upadła w wewnętrznym konflikcie."},
    LojalnyZastepca: {isPositive:true, title:"ZAKOŃCZENIE: LOJALNY ZASTĘPCA", description:"Nadzorca wyzdrowiał. Nigdy nie dowiedział się o twojej roli w ataku, a ty lojalnie oddałeś mu władzę. Wróciłeś na stanowisko Zastępcy, żyjąc w ciągłym strachu, że prawda kiedyś wyjdzie na jaw. Przetrwałeś, ale czyim kosztem?"},
    Zdrada: {isPositive:false, title:"ZAKOŃCZENIE: ZDRADA", description:"Zabiłeś Nadzorcę, ale twój brat ujawnił prawdę. Mieszkańcy, dowiedziawszy się o twoim spisku, osądzili cię jako zdrajcę. Zostałeś skazany na wygnanie. Wrota Krypty 62 zamknęły się za tobą na zawsze."},
    KrwawyNadzorca: {
        isPositive:true, 
        title:"ZAKOŃCZENIE: KRWAWY NADZORCA", 
        description: (gs) => {
            if (gs.flags.brotherKilledByDeathclaw) {
                return "Uciszyłeś brata i pozbyłeś się starego Nadzorcy. Twój przerażający 'strażnik' okazał się użytecznym narzędziem do rozwiązywania problemów. Rządzisz Kryptą 62, a mieszkańcy, bojąc się zarówno ciebie, jak i twojej bestii, nigdy nie kwestionują twoich decyzji.";
            }
            if (gs.flags.brotherFramed) {
                return "Uciszyłeś brata i pozbyłeś się starego Nadzorcy. Twoja historia o zdradzie Adama i heroicznej samoobronie została przyjęta bez zastrzeżeń. Rządzisz Kryptą 62 jako bohater, który ocalił ją przed wewnętrznym wrogiem. Nikt nie zna strasznej prawdy.";
            }
            if (gs.flags.brotherKilledByPlayer && gs.player.characterClass === 'Naukowiec') {
                return "Uciszyłeś brata i pozbyłeś się starego Nadzorcy. Jego 'nagły zawał serca' nie wzbudził podejrzeń. Rządzisz Kryptą 62 w sposób chłodny i wyrachowany. Twoja tajemnica jest bezpieczna, pogrzebana sześć stóp pod ziemią.";
            }
            if (gs.flags.brotherBlackmailed) {
                return "Uciszyłeś brata, nie przelewając jego krwi. Pozbyłeś się starego Nadzorcy. Adam wciąż żyje, ale jest tylko cieniem człowieka, złamanym przez twój szantaż. Rządzisz Kryptą 62, a twoja największa broń to nie pistolet, a tajemnica, którą trzymasz w garści.";
            }
            return "Uciszyłeś brata i pozbyłeś się starego Nadzorcy. Twoja tajemnica jest bezpieczna. Zostałeś nowym, stałym Nadzorcą Krypty 62. Ludzie Ci ufają, nie znając mrocznej prawdy, na której zbudowałeś swoją władzę.";
        }
    },
    Glod: {isPositive:false, title:"ZAKOŃCZENIE: GŁÓD", description:"Wrota spiżarni otwierają się, ukazując pustkę. Ostatnie krople wody wyparowały. Cisza, która wkrótce zapanuje w korytarzach, będzie twoim jedynym, tragicznym dziedzictwem. Umarłeś w ciemności z głodu i wyczerpania."},
    Tyran: {isPositive:true, title:"ZAKOŃCZENIE: TYRAN", description:"Krew twojego brata, Nadzorcy i handlarzy spłynęła na twoje ręce. Krypta 62 przetrwała, ale stała się postrachem okolicy, a ty jej bezwzględnym władcą, znienawidzonym i budzącym strach we własnych ludziach."},
    Wstyd: {isPositive:false, title:"ZAKOŃCZENIE: WSTYD", description:"W przypływie wyrzutów sumienia, przyznałeś się do wszystkiego. Do spisku, do zdrady, do morderstw. Zostałeś aresztowany i zamknięty w celi. Nie mogąc znieść ciężaru swoich win, odebrałeś sobie życie. Pętla zaciśnięta na szyi była twoim ostatnim aktem w tej historii."},
    Pustelnik: {isPositive:false, title:"ZAKOŃCZENIE: PUSTELNIK", description:"Wygnany z Krypty, błąkałeś się po Pustkowiach. Promieniowanie wypaliło Twoje ciało i umysł. Po latach stałeś się tym, czym gardziłeś - bezmyślnym, zdeformowanym ghulem. Twoja Krypta jest już tylko odległym, bolesnym wspomnieniem."},
    AwariaSystemu: {isPositive:false, title:"ZAKOŃCZENIE: AWARIA SYSTEMU", description:"Cisza. Przerażająca, nienaturalna cisza. Jeden z kluczowych systemów podtrzymywania życia uległ całkowitej awarii. Kaskada błędów przeciążyła pozostałe. W ciągu kilku godzin Krypta 62 stała się metalowym grobowcem. Twoje rządy kończą się nie w wyniku buntu, a przez ciche, nieubłagane umieranie technologii."}
};
</script>
</body>
</html>